// Generated by CoffeeScript 1.3.3
(function() {
  var Bling, defineProperty, extend, inherit, isType, log, _ref, _type,
    __slice = [].slice,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  log = function() {
    var a;
    a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
    try {
      return console.log.apply(console, a);
    } catch (_error) {}
    return alert(a.join(", "));
  };

  if ((_ref = Object.keys) == null) {
    Object.keys = function(o) {
      var k, _results;
      _results = [];
      for (k in o) {
        _results.push(k);
      }
      return _results;
    };
  }

  extend = function(a, b) {
    var k, v;
    if (!b) {
      return a;
    }
    for (k in b) {
      v = b[k];
      if (v != null) {
        a[k] = v;
      }
    }
    return a;
  };

  defineProperty = function(o, name, opts) {
    Object.defineProperty(o, name, extend({
      configurable: true,
      enumerable: true
    }, opts));
    return o;
  };

  isType = function(T, o) {
    if (!(o != null)) {
      return T === o || T === "null" || T === "undefined";
    } else {
      return o.constructor === T || o.constructor.name === T || Object.prototype.toString.apply(o) === ("[object " + T + "]") || isType(T, o.__proto__);
    }
  };

  inherit = function(parent, obj) {
    if (typeof parent === "function") {
      parent = parent.prototype;
    }
    obj.__proto__ = parent;
    return obj;
  };

  _type = (function() {
    var base, cache, lookup, order, register, _extend;
    cache = {};
    base = {
      name: 'unknown',
      match: function(o) {
        return true;
      }
    };
    order = [];
    register = function(name, data) {
      if (!(name in cache)) {
        order.unshift(name);
      }
      return cache[data.name = name] = base !== data ? inherit(base, data) : data;
    };
    _extend = function(name, data) {
      var k, _ref1, _results;
      if (typeof name === "string") {
        if ((_ref1 = cache[name]) == null) {
          cache[name] = register(name, {});
        }
        return cache[name] = extend(cache[name], data);
      } else if (typeof name === "object") {
        _results = [];
        for (k in name) {
          _results.push(_extend(k, name[k]));
        }
        return _results;
      }
    };
    lookup = function(obj) {
      var name, _i, _len, _ref1;
      for (_i = 0, _len = order.length; _i < _len; _i++) {
        name = order[_i];
        if ((_ref1 = cache[name]) != null ? _ref1.match.call(obj, obj) : void 0) {
          return cache[name];
        }
      }
    };
    register("unknown", base);
    register("object", {
      match: function() {
        return typeof this === "object";
      }
    });
    register("error", {
      match: function() {
        return isType('Error', this);
      }
    });
    register("regexp", {
      match: function() {
        return isType('RegExp', this);
      }
    });
    register("string", {
      match: function() {
        return typeof this === "string" || isType(String, this);
      }
    });
    register("number", {
      match: function() {
        return isType(Number, this);
      }
    });
    register("bool", {
      match: function() {
        var _ref1;
        return typeof this === "boolean" || ((_ref1 = String(this)) === "true" || _ref1 === "false");
      }
    });
    register("array", {
      match: function() {
        return (typeof Array.isArray === "function" ? Array.isArray(this) : void 0) || isType(Array, this);
      }
    });
    register("function", {
      match: function() {
        return typeof this === "function";
      }
    });
    register("global", {
      match: function() {
        return typeof this === "object" && 'setInterval' in this;
      }
    });
    register("undefined", {
      match: function(x) {
        return x === void 0;
      }
    });
    register("null", {
      match: function(x) {
        return x === null;
      }
    });
    return extend((function(o) {
      return lookup(o).name;
    }), {
      register: register,
      lookup: lookup,
      extend: _extend,
      is: function(t, o) {
        var _ref1;
        return (_ref1 = cache[t]) != null ? _ref1.match.call(o, o) : void 0;
      }
    });
  })();

  Bling = (function() {
    var default_context, done, filt, pipes, qu;

    pipes = {};

    Bling.pipe = function(name, args) {
      var func, p, _i, _len;
      p = (pipes[name] || (pipes[name] = []));
      if (!args) {
        return {
          prepend: function(obj) {
            p.unshift(obj);
            return obj;
          },
          append: function(obj) {
            p.push(obj);
            return obj;
          }
        };
      }
      for (_i = 0, _len = p.length; _i < _len; _i++) {
        func = p[_i];
        args = func.call(this, args);
      }
      return args;
    };

    Bling.pipe("bling-init").prepend(function(args) {
      var context, selector;
      selector = args[0], context = args[1];
      return inherit(Bling, inherit({
        selector: selector,
        context: context
      }, _type.lookup(selector).array(selector, context)));
    });

    default_context = typeof document !== "undefined" && document !== null ? document : {};

    function Bling(selector, context) {
      if (context == null) {
        context = default_context;
      }
      return Bling.pipe("bling-init", [selector, context]);
    }

    Bling.plugin = function(opts, constructor) {
      var key, plugin, _fn,
        _this = this;
      if (!(constructor != null)) {
        constructor = opts;
        opts = {};
      }
      if ("depends" in opts) {
        return this.depends(opts.depends, function() {
          return _this.plugin({
            provides: opts.provides
          }, constructor);
        });
      }
      try {
        if ((plugin = constructor != null ? constructor.call(this, this) : void 0)) {
          extend(this, plugin != null ? plugin.$ : void 0);
          ['$', 'name'].forEach(function(k) {
            return delete plugin[k];
          });
          extend(this.prototype, plugin);
          _fn = function(key) {
            return _this[key] || (_this[key] = function() {
              var a;
              a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              return _this.prototype[key].apply($(a[0]), a.slice(1));
            });
          };
          for (key in plugin) {
            _fn(key);
          }
          if (opts.provides != null) {
            this.provide(opts.provides);
          }
        }
      } catch (error) {
        log("failed to load plugin: " + this.name + " '" + error.message + "'");
        throw error;
      }
      return this;
    };

    qu = [];

    done = {};

    filt = function(n) {
      return ((typeof n) === "string" ? n.split(/, */) : n).filter(function(x) {
        return !(x in done);
      });
    };

    Bling.depends = function(needs, f) {
      if ((needs = filt(needs)).length === 0) {
        f();
      } else {
        qu.push(function(need) {
          var i;
          return ((i = needs.indexOf(need)) > -1 ? needs.splice(i, 1) : void 0) && needs.length === 0 && f;
        });
      }
      return f;
    };

    Bling.provide = function(needs) {
      var f, i, need, _i, _len, _ref1;
      _ref1 = filt(needs);
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        need = _ref1[_i];
        done[need] = i = 0;
        while (i < qu.length) {
          if ((f = qu[i](need))) {
            qu.splice(i, 1);
            f();
          } else {
            i++;
          }
        }
      }
      return null;
    };

    Bling.provides = function(needs, f) {
      return function() {
        var a, r;
        a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        r = f.apply(null, a);
        Bling.provide(needs);
        return r;
      };
    };

    _type.extend({
      unknown: {
        array: function(o) {
          return [o];
        }
      },
      "null": {
        array: function(o) {
          return [];
        }
      },
      undefined: {
        array: function(o) {
          return [];
        }
      },
      array: {
        array: function(o) {
          return o;
        }
      },
      number: {
        array: function(o) {
          return Bling.extend(new Array(o), {
            length: 0
          });
        }
      }
    });

    _type.register("bling", {
      match: function(o) {
        return o && isType(Bling, o);
      },
      array: function(o) {
        return o.toArray();
      },
      hash: function(o) {
        return o.map(Bling.hash).sum();
      },
      string: function(o) {
        return Bling.symbol + "([" + o.map(function(x) {
          return $.type.lookup(x).string(x);
        }).join(", ") + "])";
      },
      repr: function(o) {
        return Bling.symbol + "([" + o.map(function(x) {
          return $.type.lookup(x).repr(x);
        }).join(", ") + "])";
      }
    });

    return Bling;

  })();

  Bling.prototype = [];

  Bling.prototype.constructor = Bling;

  (function($) {
    var glob;
    $.global = glob = typeof window !== "undefined" && window !== null ? window : global;
    $.plugin({
      provides: "type"
    }, function() {
      return {
        $: {
          inherit: inherit,
          extend: extend,
          defineProperty: defineProperty,
          isType: isType,
          type: _type,
          is: _type.is,
          isSimple: function(o) {
            var _ref1;
            return (_ref1 = _type(o)) === "string" || _ref1 === "number" || _ref1 === "bool";
          },
          isEmpty: function(o) {
            return o === "" || o === null || o === (void 0);
          }
        }
      };
    });
    $.plugin({
      provides: "symbol",
      depends: "type"
    }, function() {
      var cache, symbol;
      symbol = null;
      cache = {};
      glob.Bling = $;
      if (typeof module !== "undefined" && module !== null) {
        module.exports = {
          $: Bling,
          Bling: Bling
        };
      }
      $.type.extend("bling", {
        string: function(o) {
          return symbol + "([" + o.map($.toString).join(", ") + "])";
        }
      });
      defineProperty($, "symbol", {
        set: function(v) {
          glob[symbol] = cache[symbol];
          cache[symbol = v] = glob[v];
          return glob[v] = Bling;
        },
        get: function() {
          return symbol;
        }
      });
      return {
        $: {
          symbol: "$"
        }
      };
    });
    $.plugin(function() {
      var oldClone, _base, _base1, _base2, _base3;
      (_base = String.prototype).trimLeft || (_base.trimLeft = function() {
        return this.replace(/^\s+/, "");
      });
      (_base1 = String.prototype).split || (_base1.split = function(sep) {
        var a, i, j;
        a = [];
        i = 0;
        while ((j = this.indexOf(sep, i)) > -1) {
          a.push(this.substring(i, j));
          i = j + 1;
        }
        return a;
      });
      (_base2 = String.prototype).lastIndexOf || (_base2.lastIndexOf = function(s, c, i) {
        var j;
        if (i == null) {
          i = -1;
        }
        j = -1;
        while ((i = s.indexOf(c, i + 1)) > -1) {
          j = i;
        }
        return j;
      });
      (_base3 = Array.prototype).join || (_base3.join = function(sep) {
        var n, s;
        if (sep == null) {
          sep = '';
        }
        n = this.length;
        if (n === 0) {
          return "";
        }
        s = this[n - 1];
        while (--n > 0) {
          s = this[n - 1] + sep + s;
        }
        return s;
      });
      if (typeof Event !== "undefined" && Event !== null) {
        Event.prototype.preventAll = function() {
          this.preventDefault();
          this.stopPropagation();
          return this.cancelBubble = true;
        };
      }
      if (typeof Element !== "undefined" && Element !== null) {
        Element.prototype.matchesSelector = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.matchesSelector;
        if (Element.prototype.cloneNode.length === 0) {
          oldClone = Element.prototype.cloneNode;
          Element.prototype.cloneNode = function(deep) {
            var i, n, _i, _len, _ref1;
            if (deep == null) {
              deep = false;
            }
            n = oldClone.call(this);
            if (deep) {
              _ref1 = this.childNodes;
              for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
                i = _ref1[_i];
                n.appendChild(i.cloneNode(true));
              }
            }
            return n;
          };
        }
      }
      return {};
    });
    $.plugin({
      provides: "core",
      depends: "type"
    }, function() {
      var index;
      defineProperty($, "now", {
        get: function() {
          return +(new Date);
        }
      });
      index = function(i, o) {
        while (i < 0) {
          i += o.length;
        }
        return Math.min(i, o.length);
      };
      return {
        $: {
          log: log,
          assert: function(c, m) {
            if (m == null) {
              m = "";
            }
            if (!c) {
              throw new Error("assertion failed: " + m);
            }
          },
          coalesce: function() {
            var a;
            a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            return $(a).coalesce();
          }
        },
        eq: function(i) {
          return $([this[index(i, this)]]);
        },
        each: function(f) {
          var t, _i, _len;
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            t = this[_i];
            f.call(t, t);
          }
          return this;
        },
        map: function(f) {
          var t;
          return $((function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = this.length; _i < _len; _i++) {
              t = this[_i];
              _results.push(f.call(t, t));
            }
            return _results;
          }).call(this));
        },
        reduce: function(f, a) {
          var i, n, x, _i;
          i = 0;
          n = this.length;
          if (!(a != null)) {
            a = this[i++];
          }
          for (x = _i = i; _i < n; x = _i += 1) {
            a = f.call(this[x], a, this[x]);
          }
          return a;
        },
        union: function(other, strict) {
          var ret, x, _i, _j, _len, _len1;
          if (strict == null) {
            strict = true;
          }
          ret = $();
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            x = this[_i];
            if (!ret.contains(x, strict)) {
              ret.push(x);
            }
          }
          for (_j = 0, _len1 = other.length; _j < _len1; _j++) {
            x = other[_j];
            if (!ret.contains(x, strict)) {
              ret.push(x);
            }
          }
          return ret;
        },
        distinct: function(strict) {
          if (strict == null) {
            strict = true;
          }
          return this.union(this, strict);
        },
        intersect: function(other) {
          var x;
          return $((function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = this.length; _i < _len; _i++) {
              x = this[_i];
              if (__indexOf.call(other, x) >= 0) {
                _results.push(x);
              }
            }
            return _results;
          }).call(this));
        },
        contains: function(item, strict) {
          var t;
          if (strict == null) {
            strict = true;
          }
          return ((function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = this.length; _i < _len; _i++) {
              t = this[_i];
              _results.push((strict && t === item) || (!strict && t === item));
            }
            return _results;
          }).call(this)).reduce((function(a, x) {
            return a || x;
          }), false);
        },
        count: function(item, strict) {
          var t;
          if (strict == null) {
            strict = true;
          }
          return $((function() {
            var _i, _len, _results;
            _results = [];
            for (_i = 0, _len = this.length; _i < _len; _i++) {
              t = this[_i];
              if ((item === void 0) || (strict && t === item) || (!strict && t === item)) {
                _results.push(1);
              }
            }
            return _results;
          }).call(this)).sum();
        },
        coalesce: function() {
          var i, _i, _len, _ref1;
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            i = this[_i];
            if ((_ref1 = $.type(i)) === "array" || _ref1 === "bling") {
              i = $(i).coalesce();
            }
            if (i != null) {
              return i;
            }
          }
          return null;
        },
        swap: function(i, j) {
          var _ref1;
          i = index(i, this);
          j = index(j, this);
          if (i !== j) {
            _ref1 = [this[j], this[i]], this[i] = _ref1[0], this[j] = _ref1[1];
          }
          return this;
        },
        shuffle: function() {
          var i;
          i = this.length - 1;
          while (i >= 0) {
            this.swap(--i, Math.floor(Math.random() * i));
          }
          return this;
        },
        select: (function() {
          var getter, select;
          getter = function(prop) {
            return function() {
              var v;
              if ($.is("function", v = this[prop])) {
                return $.bound(this, v);
              } else {
                return v;
              }
            };
          };
          return select = function(p) {
            var i;
            if ((i = p.indexOf('.')) > -1) {
              return this.select(p.substr(0, i)).select(p.substr(i + 1));
            } else {
              return this.map(getter(p));
            }
          };
        })(),
        or: function(x) {
          var i, _i, _ref1;
          for (i = _i = 0, _ref1 = this.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
            this[i] || (this[i] = x);
          }
          return this;
        },
        zap: function(p, v) {
          var head, i, tail;
          i = p.lastIndexOf(".");
          if (i > 0) {
            head = p.substr(0, i);
            tail = p.substr(i + 1);
            this.select(head).zap(tail, v);
            return this;
          }
          switch ($.type(v)) {
            case "array":
            case "bling":
              this.each(function() {
                return this[p] = v[++i % v.length];
              });
              break;
            case "function":
              this.zap(p, this.select(p).map(v));
              break;
            default:
              this.each(function() {
                return this[p] = v;
              });
          }
          return this;
        },
        clean: function(prop) {
          return this.each(function() {
            return delete this[prop];
          });
        },
        take: function(n) {
          var end, i;
          if (n == null) {
            n = 1;
          }
          end = Math.min(n, this.length);
          return $((function() {
            var _i, _results;
            _results = [];
            for (i = _i = 0; 0 <= end ? _i < end : _i > end; i = 0 <= end ? ++_i : --_i) {
              _results.push(this[i]);
            }
            return _results;
          }).call(this));
        },
        skip: function(n) {
          var i, start;
          if (n == null) {
            n = 0;
          }
          start = Math.max(0, n | 0);
          return $((function() {
            var _i, _ref1, _results;
            _results = [];
            for (i = _i = start, _ref1 = this.length; start <= _ref1 ? _i < _ref1 : _i > _ref1; i = start <= _ref1 ? ++_i : --_i) {
              _results.push(this[i]);
            }
            return _results;
          }).call(this));
        },
        first: function(n) {
          if (n == null) {
            n = 1;
          }
          if (n === 1) {
            return this[0];
          } else {
            return this.take(n);
          }
        },
        last: function(n) {
          if (n == null) {
            n = 1;
          }
          if (n === 1) {
            return this[this.length - 1];
          } else {
            return this.skip(this.length - n);
          }
        },
        slice: function(start, end) {
          var i;
          if (start == null) {
            start = 0;
          }
          if (end == null) {
            end = this.length;
          }
          start = index(start, this);
          end = index(end, this);
          return $((function() {
            var _i, _results;
            _results = [];
            for (i = _i = start; start <= end ? _i < end : _i > end; i = start <= end ? ++_i : --_i) {
              _results.push(this[i]);
            }
            return _results;
          }).call(this));
        },
        extend: function(b) {
          var i, _i, _len;
          for (_i = 0, _len = b.length; _i < _len; _i++) {
            i = b[_i];
            this.push(i);
          }
          return this;
        },
        push: function(b) {
          Array.prototype.push.call(this, b);
          return this;
        },
        filter: function(f) {
          var g;
          g = (function() {
            switch ($.type(f)) {
              case "string":
                return function(x) {
                  return x.matchesSelector(f);
                };
              case "regexp":
                return function(x) {
                  return f.test(x);
                };
              case "function":
                return f;
              default:
                throw new Error("unsupported type passed to filter: " + ($.type(f)));
            }
          })();
          return $(Array.prototype.filter.call(this, g));
        },
        matches: function(expr) {
          return this.select('matchesSelector').call(expr);
        },
        querySelectorAll: function(expr) {
          return this.filter("*").reduce(function(a, i) {
            return a.extend(i.querySelectorAll(expr));
          }, $());
        },
        weave: function(b) {
          var c, i, _i, _j, _ref1, _ref2;
          c = $();
          for (i = _i = _ref1 = this.length - 1; _i >= 0; i = _i += -1) {
            c[(i * 2) + 1] = this[i];
          }
          for (i = _j = 0, _ref2 = b.length; _j < _ref2; i = _j += 1) {
            c[i * 2] = b[i];
          }
          return c;
        },
        fold: function(f) {
          var b, i, n;
          n = this.length;
          b = $((function() {
            var _i, _ref1, _results;
            _results = [];
            for (i = _i = 0, _ref1 = n - 1; _i < _ref1; i = _i += 2) {
              _results.push(f.call(this, this[i], this[i + 1]));
            }
            return _results;
          }).call(this));
          if ((n % 2) === 1) {
            b.push(f.call(this, this[n - 1], void 0));
          }
          return b;
        },
        flatten: function() {
          var b, i, j, _i, _j, _len, _len1;
          b = $();
          for (_i = 0, _len = this.length; _i < _len; _i++) {
            i = this[_i];
            for (_j = 0, _len1 = i.length; _j < _len1; _j++) {
              j = i[_j];
              b.push(j);
            }
          }
          return b;
        },
        call: function() {
          return this.apply(null, arguments);
        },
        apply: function(context, args) {
          return this.map(function() {
            if ($.is("function", this)) {
              return this.apply(context, args);
            } else {
              return this;
            }
          });
        },
        log: function(label) {
          if (label) {
            $.log(label, this.toString(), this.length + " items");
          } else {
            $.log(this.toString(), this.length + " items");
          }
          return this;
        },
        toArray: function() {
          this.__proto__ = Array.prototype;
          return this;
        }
      };
    });
    $.plugin({
      provides: "math",
      depends: "core"
    }, function() {
      return {
        $: {
          range: function(start, end, step) {
            var i;
            if (step == null) {
              step = 1;
            }
            if (!(end != null)) {
              end = start;
              start = 0;
            }
            if (end < start && step > 0) {
              step *= -1;
            }
            return $((function() {
              var _i, _ref1, _results;
              _results = [];
              for (i = _i = 0, _ref1 = Math.ceil((end - start) / step); 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
                _results.push(start + (i * step));
              }
              return _results;
            })());
          },
          zeros: function(n) {
            var i;
            return $((function() {
              var _i, _results;
              _results = [];
              for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {
                _results.push(0);
              }
              return _results;
            })());
          },
          ones: function(n) {
            var i;
            return $((function() {
              var _i, _results;
              _results = [];
              for (i = _i = 0; 0 <= n ? _i < n : _i > n; i = 0 <= n ? ++_i : --_i) {
                _results.push(1);
              }
              return _results;
            })());
          }
        },
        floats: function() {
          return this.map(parseFloat);
        },
        ints: function() {
          return this.map(function() {
            return parseInt(this, 10);
          });
        },
        px: function(delta) {
          return this.ints().map(function() {
            return $.px(this, delta);
          });
        },
        min: function() {
          return this.filter(isFinite).reduce(Math.min);
        },
        max: function() {
          return this.filter(isFinite).reduce(Math.max);
        },
        mean: function() {
          return this.sum() / this.length;
        },
        avg: function() {
          return this.sum() / this.length;
        },
        sum: function() {
          return this.filter(isFinite).reduce(function(a) {
            return a + this;
          });
        },
        product: function() {
          return this.filter(isFinite).reduce(function(a) {
            return a * this;
          });
        },
        squares: function() {
          return this.map(function() {
            return this * this;
          });
        },
        magnitude: function() {
          return Math.sqrt(this.floats().squares().sum());
        },
        scale: function(r) {
          return this.map(function() {
            return r * this;
          });
        },
        add: function(d) {
          var i;
          switch ($.type(d)) {
            case "number":
              return this.map(function() {
                return d + this;
              });
            case "bling":
            case "array":
              return $((function() {
                var _i, _ref1, _results;
                _results = [];
                for (i = _i = 0, _ref1 = Math.min(this.length, d.length); 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
                  _results.push(this[i] + d[i]);
                }
                return _results;
              }).call(this));
          }
        },
        normalize: function() {
          return this.scale(1 / this.magnitude());
        }
      };
    });
    $.plugin({
      provides: "string",
      depends: "function"
    }, function() {
      $.type.extend({
        unknown: {
          string: function(o) {
            var _ref1;
            return (_ref1 = typeof o.toString === "function" ? o.toString() : void 0) != null ? _ref1 : String(o);
          },
          repr: function(o) {
            return $.type.lookup(o).string(o);
          }
        },
        "null": {
          string: function() {
            return "null";
          }
        },
        undefined: {
          string: function() {
            return "undefined";
          }
        },
        string: {
          string: $.identity,
          repr: function(s) {
            return "'" + s + "'";
          }
        },
        array: {
          string: function(a) {
            var x;
            return "[" + ((function() {
              var _i, _len, _results;
              _results = [];
              for (_i = 0, _len = a.length; _i < _len; _i++) {
                x = a[_i];
                _results.push($.toString(x));
              }
              return _results;
            })()).join(",") + "]";
          }
        },
        object: {
          string: function(o) {
            var k, v;
            return "{" + ((function() {
              var _results;
              _results = [];
              for (k in o) {
                v = o[k];
                _results.push("" + k + ":" + ($.toString(v)));
              }
              return _results;
            })()).join(", ") + "}";
          }
        },
        number: {
          repr: function(n) {
            return String(n);
          },
          string: function(n) {
            switch (true) {
              case n.precision != null:
                return n.toPrecision(n.precision);
              case n.fixed != null:
                return n.toFixed(n.fixed);
              default:
                return String(n);
            }
          }
        }
      });
      return {
        $: {
          toString: function(x) {
            if (!(x != null)) {
              return "function Bling(selector, context) { [ ... ] }";
            } else {
              return $.type.lookup(x).string(x);
            }
          },
          toRepr: function(x) {
            return $.type.lookup(x).repr(x);
          },
          px: function(x, delta) {
            if (delta == null) {
              delta = 0;
            }
            return (x != null) && (parseInt(x, 10) + (delta | 0)) + "px";
          },
          capitalize: function(name) {
            return (name.split(" ").map(function(x) {
              return x[0].toUpperCase() + x.substring(1).toLowerCase();
            })).join(" ");
          },
          dashize: function(name) {
            var c, i, ret, _i, _ref1;
            ret = "";
            for (i = _i = 0, _ref1 = (name != null ? name.length : void 0) | 0; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
              c = name.charCodeAt(i);
              if ((91 > c && c > 64)) {
                c += 32;
                ret += '-';
              }
              ret += String.fromCharCode(c);
            }
            return ret;
          },
          camelize: function(name) {
            var i;
            name.split('-');
            while ((i = name != null ? name.indexOf('-') : void 0) > -1) {
              name = $.stringSplice(name, i, i + 2, name[i + 1].toUpperCase());
            }
            return name;
          },
          padLeft: function(s, n, c) {
            if (c == null) {
              c = " ";
            }
            while (s.length < n) {
              s = c + s;
            }
            return s;
          },
          padRight: function(s, n, c) {
            if (c == null) {
              c = " ";
            }
            while (s.length < n) {
              s = s + c;
            }
            return s;
          },
          stringCount: function(s, x, i, n) {
            var j;
            if (i == null) {
              i = 0;
            }
            if (n == null) {
              n = 0;
            }
            if ((j = s.indexOf(x, i)) > i - 1) {
              return $.stringCount(s, x, j + 1, n + 1);
            } else {
              return n;
            }
          },
          stringSplice: function(s, i, j, n) {
            var end, nn, start;
            nn = s.length;
            end = j;
            if (end < 0) {
              end += nn;
            }
            start = i;
            if (start < 0) {
              start += nn;
            }
            return s.substring(0, start) + n + s.substring(end);
          },
          checksum: function(s) {
            var a, b, i, _i, _ref1;
            a = 1;
            b = 0;
            for (i = _i = 0, _ref1 = s.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
              a = (a + s.charCodeAt(i)) % 65521;
              b = (b + a) % 65521;
            }
            return (b << 16) | a;
          },
          repeat: function(x, n) {
            if (n == null) {
              n = 2;
            }
            switch (true) {
              case n === 1:
                return x;
              case n < 1:
                return "";
              case $.is("string", x):
                return x + $.repeat(x, n - 1);
              default:
                return $(x).extend($.repeat(x, n - 1));
            }
          },
          stringBuilder: function() {
            var items,
              _this = this;
            if ($.is("global", this)) {
              return new $.stringBuilder();
            }
            items = [];
            this.length = 0;
            this.append = function(s) {
              items.push(s);
              return _this.length += (s != null ? s.toString().length : void 0) | 0;
            };
            this.prepend = function(s) {
              items.splice(0, 0, s);
              return _this.length += (s != null ? s.toString().length : void 0) | 0;
            };
            this.clear = function() {
              var ret;
              ret = _this.toString();
              items = [];
              _this.length = 0;
              return ret;
            };
            this.toString = function() {
              return items.join("");
            };
            return this;
          }
        },
        toString: function() {
          return $.toString(this);
        },
        toRepr: function() {
          return $.toRepr(this);
        }
      };
    });
    $.plugin({
      provides: "function",
      depends: "hash"
    }, function() {
      return {
        $: {
          identity: function(o) {
            return o;
          },
          not: function(f) {
            return function() {
              return !f.apply(this, arguments);
            };
          },
          compose: function(f, g) {
            return function(x) {
              var y;
              return f.call(y, (y = g.call(x, x)));
            };
          },
          and: function(f, g) {
            return function(x) {
              return g.call(this, x) && f.call(this, x);
            };
          },
          once: function(f, n) {
            if (n == null) {
              n = 1;
            }
            return $.defineProperty((function() {
              if (n-- > 0) {
                return f.apply(this, arguments);
              }
            }), "exhausted", {
              get: function() {
                return n <= 0;
              }
            });
          },
          cycle: function() {
            var f, i;
            f = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            i = -1;
            return function() {
              return f[i = ++i % f.length].apply(this, arguments);
            };
          },
          bound: function(t, f, args) {
            var r;
            if (args == null) {
              args = [];
            }
            if ($.is("function", f.bind)) {
              args.splice(0, 0, t);
              r = f.bind.apply(f, args);
            } else {
              r = function() {
                var a;
                a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
                return f.apply(t, args(args.length ? void 0 : a));
              };
            }
            return $.extend(r, {
              toString: function() {
                return "bound-method of " + t + "." + f.name;
              }
            });
          },
          memoize: function(f) {
            var cache;
            cache = {};
            return function() {
              var a, _name, _ref1;
              a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              return (_ref1 = cache[_name = $.hash(a)]) != null ? _ref1 : cache[_name] = f.apply(this, a);
            };
          }
        }
      };
    });
    $.plugin({
      provides: "hash",
      depends: "type"
    }, function() {
      $.type.extend({
        unknown: {
          hash: function(o) {
            return $.checksum($.toString(o));
          }
        },
        object: {
          hash: function(o) {
            var k;
            return ((function() {
              var _results;
              _results = [];
              for (k in o) {
                _results.push($.hash(o[k]));
              }
              return _results;
            })()) + $.hash(Object.keys(o));
          }
        },
        array: {
          hash: function(o) {
            var i;
            return ((function() {
              var _i, _len, _results;
              _results = [];
              for (_i = 0, _len = x.length; _i < _len; _i++) {
                i = x[_i];
                _results.push($.hash(i));
              }
              return _results;
            })()).reduce(function(a, x) {
              return a + x;
            });
          }
        },
        bool: {
          hash: function(o) {
            return parseInt(o ? 1 : void 0);
          }
        }
      });
      return {
        $: {
          hash: function(x) {
            return $.type.lookup(x).hash(x);
          }
        },
        hash: function() {
          return $.hash(this);
        }
      };
    });
    $.plugin({
      provides: "pubsub"
    }, function() {
      var subscribers;
      subscribers = {};
      return {
        $: {
          publish: function() {
            var args, e, f, _i, _len, _ref1;
            e = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
            _ref1 = (subscribers[e] || (subscribers[e] = []));
            for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
              f = _ref1[_i];
              f.apply(null, args);
            }
            return args;
          },
          publisher: function(e, func) {
            return function() {
              var args;
              args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              func.apply(this, args);
              return $.publish(e, args);
            };
          },
          subscribe: function(e, func) {
            (subscribers[e] || (subscribers[e] = [])).push(func);
            return func;
          },
          unsubscribe: function(e, func) {
            var a, i;
            if (!(func != null)) {
              return subscribers[e] = [];
            } else {
              a = (subscribers[e] || (subscribers[e] = []));
              if ((i = a.indexOf(func)) > -1) {
                return a.splice(i, i);
              }
            }
          }
        }
      };
    });
    $.plugin({
      provides: "throttle",
      depends: "core"
    }, function() {
      return {
        $: {
          throttle: function(f, n, last) {
            if (n == null) {
              n = 250;
            }
            if (last == null) {
              last = 0;
            }
            return function() {
              var a, gap;
              a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              gap = $.now - last;
              if (gap > n) {
                last += gap;
                return f.apply(this, a);
              }
              return null;
            };
          },
          debounce: function(f, n, last) {
            if (n == null) {
              n = 250;
            }
            if (last == null) {
              last = 0;
            }
            return function() {
              var a, gap;
              a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              last += (gap = $.now - last);
              return f.apply(this, a(gap > n ? void 0 : null));
            };
          }
        }
      };
    });
    return $.plugin({
      provides: "EventEmitter"
    }, function() {
      return {
        $: {
          EventEmitter: $.pipe("bling-init").append(function(obj) {
            var list, listeners;
            listeners = {};
            list = function(e) {
              return listeners[e] || (listeners[e] = []);
            };
            obj.__proto__ = {
              emit: function() {
                var a, e, f, _i, _len, _ref1;
                e = arguments[0], a = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
                _ref1 = list(e);
                for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
                  f = _ref1[_i];
                  f.apply(this, a);
                }
                return this;
              },
              addListener: function(e, h) {
                list(e).push(h);
                return this.emit('newListener', e, h);
              },
              on: function(e, h) {
                return this.addListener(e, h);
              },
              removeListener: function(e, h) {
                var i;
                if ((i = list(e).indexOf(h)) > -1) {
                  return list(e).splice(i, 1);
                }
              },
              removeAllListeners: function(e) {
                return listeners[e] = [];
              },
              setMaxListeners: function(n) {},
              listeners: function(e) {
                return list(e).slice(0);
              },
              __proto__: obj.__proto__
            };
            return obj;
          })
        }
      };
    });
  })(Bling, this);

  (function($) {
    return $.plugin({
      provides: "cartesian"
    }, function() {
      return {
        $: {
          cartesian: function() {
            var helper, n, ret, sets;
            sets = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
            n = sets.length;
            ret = [];
            helper = function(cur, i) {
              var x, _i, _len, _ref1;
              if (++i >= n) {
                return ret.push(cur);
              }
              _ref1 = sets[i];
              for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
                x = _ref1[_i];
                helper(cur.concat(x), i);
              }
              return null;
            };
            helper([], -1);
            return $(ret);
          }
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      provides: 'config'
    }, function() {
      return {
        $: {
          config: {
            get: function(name, def) {
              var _ref1;
              return (_ref1 = process.env[name]) != null ? _ref1 : def;
            }
          }
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      provides: "date"
    }, function() {
      var adder, d, floor, format_keys, formats, h, m, ms, parser_keys, parsers, s, units, _ref1;
      _ref1 = [1, 1000, 1000 * 60, 1000 * 60 * 60, 1000 * 60 * 60 * 24], ms = _ref1[0], s = _ref1[1], m = _ref1[2], h = _ref1[3], d = _ref1[4];
      units = {
        ms: ms,
        s: s,
        m: m,
        h: h,
        d: d,
        sec: s,
        second: s,
        seconds: s,
        min: m,
        minute: m,
        minutes: m,
        hr: h,
        hour: h,
        hours: h,
        day: d,
        days: d
      };
      formats = {
        yyyy: Date.prototype.getUTCFullYear,
        mm: function() {
          return this.getUTCMonth() + 1;
        },
        dd: Date.prototype.getUTCDate,
        HH: Date.prototype.getUTCHours,
        MM: Date.prototype.getUTCMinutes,
        SS: Date.prototype.getUTCSeconds,
        MS: Date.prototype.getUTCMilliseconds
      };
      format_keys = Object.keys(formats).sort().reverse();
      parsers = {
        yyyy: Date.prototype.setUTCFullYear,
        mm: function(x) {
          return this.setUTCMonth(x - 1);
        },
        dd: Date.prototype.setUTCDate,
        HH: Date.prototype.setUTCHours,
        MM: Date.prototype.setUTCMinutes,
        SS: Date.prototype.setUTCSeconds,
        MS: Date.prototype.setUTCMilliseconds
      };
      parser_keys = Object.keys(parsers).sort().reverse();
      floor = Math.floor;
      $.type.register("date", {
        match: function(o) {
          return $.isType(Date, o);
        },
        array: function(o) {
          return [o];
        }
      });
      adder = function(key) {
        return function(stamp, delta, stamp_unit) {
          var date;
          if (stamp_unit == null) {
            stamp_unit = $.date.defaultUnit;
          }
          date = $.date.unstamp(stamp, stamp_unit);
          parsers[key].call(date, (formats[key].call(date)) + delta);
          return $.date.stamp(date, stamp_unit);
        };
      };
      return {
        $: {
          date: {
            defaultUnit: "s",
            defaultFormat: "yyyy-mm-dd HH:MM:SS",
            stamp: function(date, unit) {
              if (date == null) {
                date = new Date;
              }
              if (unit == null) {
                unit = $.date.defaultUnit;
              }
              return floor(date / units[unit]);
            },
            unstamp: function(stamp, unit) {
              if (unit == null) {
                unit = $.date.defaultUnit;
              }
              return new Date(floor(stamp * units[unit]));
            },
            convert: function(stamp, from, to) {
              if (from == null) {
                from = $.date.defaultUnit;
              }
              if (to == null) {
                to = $.date.defaultUnit;
              }
              if ($.is("date", stamp)) {
                stamp = $.date.stamp(stamp, from);
              }
              return floor(stamp * units[from] / units[to]);
            },
            midnight: function(stamp, unit) {
              if (unit == null) {
                unit = $.date.defaultUnit;
              }
              return $.date.convert($.date.convert(stamp, unit, "d"), "d", unit);
            },
            format: function(stamp, fmt, unit) {
              var date, k, _i, _len;
              if (fmt == null) {
                fmt = $.date.defaultFormat;
              }
              if (unit == null) {
                unit = $.date.defaultUnit;
              }
              if ($.is("date", stamp)) {
                stamp = $.date.stamp(stamp, unit);
              }
              date = $.date.unstamp(stamp, unit);
              for (_i = 0, _len = format_keys.length; _i < _len; _i++) {
                k = format_keys[_i];
                fmt = fmt.replace(k, $.padLeft("" + formats[k].call(date), k.length, "0"));
              }
              return fmt;
            },
            parse: function(dateString, fmt, to) {
              var date, i, k, _i, _j, _len, _ref2;
              if (fmt == null) {
                fmt = $.date.defaultFormat;
              }
              if (to == null) {
                to = $.date.defaultUnit;
              }
              date = new Date(0);
              for (i = _i = 0, _ref2 = fmt.length; _i < _ref2; i = _i += 1) {
                for (_j = 0, _len = parser_keys.length; _j < _len; _j++) {
                  k = parser_keys[_j];
                  if (fmt.indexOf(k, i) === i) {
                    try {
                      parsers[k].call(date, parseInt(dateString.slice(i, i + k.length), 10));
                    } catch (err) {
                      throw new Error("Invalid date ('" + dateString + "') given format mask: " + fmt + " (failed at position " + i + ")");
                    }
                  }
                }
              }
              return $.date.stamp(date, to);
            },
            addMilliseconds: adder("MS"),
            addSeconds: adder("SS"),
            addMinutes: adder("MM"),
            addHours: adder("HH"),
            addDays: adder("dd"),
            addMonths: adder("mm"),
            addYears: adder("yyyy"),
            range: function(from, to, interval, interval_unit, stamp_unit) {
              var add, cur, ret;
              if (interval == null) {
                interval = 1;
              }
              if (interval_unit == null) {
                interval_unit = "dd";
              }
              if (stamp_unit == null) {
                stamp_unit = $.date.defaultUnit;
              }
              add = adder(interval_unit);
              ret = [from];
              while ((cur = ret[ret.length - 1]) < to) {
                ret.push(add(cur, interval, stamp_unit));
              }
              return ret;
            }
          }
        },
        midnight: function(unit) {
          if (unit == null) {
            unit = $.date.defaultUnit;
          }
          return this.map(function() {
            return $.date.midnight(this, unit);
          });
        },
        unstamp: function(unit) {
          if (unit == null) {
            unit = $.date.defaultUnit;
          }
          return this.map(function() {
            return $.date.unstamp(this, unit);
          });
        },
        stamp: function(unit) {
          if (unit == null) {
            unit = $.date.defaultUnit;
          }
          return this.map(function() {
            return $.date.stamp(this, unit);
          });
        },
        dateFormat: function(fmt, unit) {
          if (fmt == null) {
            fmt = $.date.defaultFormat;
          }
          if (unit == null) {
            unit = $.date.defaultUnit;
          }
          return this.map(function() {
            return $.date.format(this, fmt, unit);
          });
        },
        dateParse: function(fmt, unit) {
          if (fmt == null) {
            fmt = $.date.defaultFormat;
          }
          if (unit == null) {
            unit = $.date.defaultUnit;
          }
          return this.map(function() {
            return $.date.parse(this, fmt, unit);
          });
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      provides: "delay",
      depends: "function"
    }, function() {
      return {
        $: {
          delay: (function() {
            var timeoutQueue;
            timeoutQueue = $.extend([], (function() {
              var next;
              next = function(a) {
                return function() {
                  if (a.length) {
                    return a.shift()();
                  }
                };
              };
              return {
                add: function(f, n) {
                  var i, _i, _ref1;
                  f.order = n + $.now;
                  for (i = _i = 0, _ref1 = this.length; 0 <= _ref1 ? _i <= _ref1 : _i >= _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
                    if (i === this.length || this[i].order > f.order) {
                      this.splice(i, 0, f);
                      break;
                    }
                  }
                  setTimeout(next(this), n);
                  return this;
                },
                cancel: function(f) {
                  var i, _i, _ref1;
                  for (i = _i = 0, _ref1 = this.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
                    if (this[i] === f) {
                      this.splice(i, 1);
                      break;
                    }
                  }
                  return this;
                }
              };
            })());
            return function(n, f) {
              if ($.is("function", f)) {
                timeoutQueue.add(f, n);
              }
              return {
                cancel: function() {
                  return timeoutQueue.cancel(f);
                }
              };
            };
          })()
        },
        delay: function(n, f, c) {
          if (c == null) {
            c = this;
          }
          return inherit(this, $.delay(n, $.bound(c, f)));
        }
      };
    });
  })(Bling);

  (function($) {
    if ($.global.document != null) {
      return $.plugin({
        depends: "function",
        provides: "dom"
      }, function() {
        var after, before, computeCSSProperty, escaper, getOrSetRect, parser, selectChain, toFrag, toNode;
        $.type.register("nodelist", {
          match: function(o) {
            return (o != null) && $.isType("NodeList", o);
          },
          hash: function(o) {
            var i;
            return $((function() {
              var _i, _len, _results;
              _results = [];
              for (_i = 0, _len = x.length; _i < _len; _i++) {
                i = x[_i];
                _results.push($.hash(i));
              }
              return _results;
            })()).sum();
          },
          array: $.identity,
          string: function(o) {
            return "{Nodelist:[" + $(o).select('nodeName').join(",") + "]}";
          },
          node: function(o) {
            return $(o).toFragment();
          }
        });
        $.type.register("node", {
          match: function(o) {
            return (o != null ? o.nodeType : void 0) > 0;
          },
          hash: function(o) {
            return $.checksum(o.nodeName) + $.hash(o.attributes) + $.checksum(o.innerHTML);
          },
          string: function(o) {
            return o.toString();
          },
          node: $.identity
        });
        $.type.register("fragment", {
          match: function(o) {
            return (o != null ? o.nodeType : void 0) === 11;
          },
          hash: function(o) {
            var x;
            return $((function() {
              var _i, _len, _ref1, _results;
              _ref1 = o.childNodes;
              _results = [];
              for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
                x = _ref1[_i];
                _results.push($.hash(x));
              }
              return _results;
            })()).sum();
          },
          string: function(o) {
            return o.toString();
          },
          node: $.identity
        });
        $.type.register("html", {
          match: function(o) {
            var s;
            return typeof o === "string" && (s = o.trimLeft())[0] === "<" && s[s.length - 1] === ">";
          },
          node: function(h) {
            var childNodes, df, i, n, node, _i;
            (node = document.createElement('div')).innerHTML = h;
            if (n = (childNodes = node.childNodes).length === 1) {
              return node.removeChild(childNodes[0]);
            }
            df = document.createDocumentFragment();
            for (i = _i = 0; _i < n; i = _i += 1) {
              df.appendChild(node.removeChild(childNodes[0]));
            }
            return df;
          },
          array: function(o, c) {
            var h;
            return $.type.lookup(h = Bling.HTML.parse(o)).array(h, c);
          },
          string: function(o) {
            return "'" + o + "'";
          },
          repr: function(o) {
            return '"' + o + '"';
          }
        });
        $.type.extend({
          unknown: {
            node: function() {
              return null;
            }
          },
          bling: {
            node: function(o) {
              return o.toFragment();
            }
          },
          node: {
            html: function(n) {
              var d, ret;
              d = document.createElement("div");
              d.appendChild((n = n.cloneNode(true)));
              ret = d.innerHTML;
              d.removeChild(n);
              return ret;
            }
          },
          string: {
            node: function(o) {
              return $(o).toFragment();
            },
            array: function(o, c) {
              return typeof c.querySelectorAll === "function" ? c.querySelectorAll(o) : void 0;
            }
          },
          "function": {
            node: function(o) {
              return $(o.toString()).toFragment();
            }
          }
        });
        toFrag = function(a) {
          var df;
          if (!(a.parentNode != null)) {
            df = document.createDocumentFragment();
            df.appendChild(a);
          }
          return a;
        };
        before = function(a, b) {
          return toFrag(a).parentNode.insertBefore(b, a);
        };
        after = function(a, b) {
          return toFrag(a).parentNode.insertBefore(b, a.nextSibling);
        };
        toNode = function(x) {
          return $.type.lookup(x).node(x);
        };
        escaper = false;
        parser = false;
        computeCSSProperty = function(k) {
          return function() {
            return $.global.getComputedStyle(this, null).getPropertyValue(k);
          };
        };
        getOrSetRect = function(p) {
          return function(x) {
            if (x != null) {
              return this.css(p, x);
            } else {
              return this.rect().select(p);
            }
          };
        };
        selectChain = function(prop) {
          return function() {
            return this.map(function(p) {
              return $((function() {
                var _results;
                _results = [];
                while (p = p[prop]) {
                  _results.push(p);
                }
                return _results;
              })());
            });
          };
        };
        return {
          $: {
            HTML: {
              parse: function(h) {
                return $.type.lookup(h).node(h);
              },
              stringify: function(n) {
                return $.type.lookup(n).html(n);
              },
              escape: function(h) {
                var ret;
                escaper || (escaper = $("<div>&nbsp;</div>").child(0));
                ret = escaper.zap('data', h).select("parentNode.innerHTML").first();
                escaper.zap('data', '');
                return ret;
              }
            }
          },
          html: function(h) {
            switch ($.type(h)) {
              case "undefined":
              case "null":
                return this.select('innerHTML');
              case "string":
                return this.zap('innerHTML', h);
              case "bling":
                return this.html(h.toFragment());
              case "node":
                return this.each(function() {
                  var _results;
                  this.replaceChild(this.childNodes[0], h);
                  _results = [];
                  while (this.childNodes.length > 1) {
                    _results.push(this.removeChild(this.childNodes[1]));
                  }
                  return _results;
                });
            }
          },
          append: function(x) {
            x = toNode(x);
            return this.each(function() {
              return this.appendChild(x.cloneNode(true));
            });
          },
          appendTo: function(x) {
            var clones, i;
            clones = this.map(function() {
              return this.cloneNode(true);
            });
            i = 0;
            $(x).each(function() {
              return this.appendChild(clones[i++]);
            });
            return clones;
          },
          prepend: function(x) {
            if (x != null) {
              x = toNode(x);
              this.take(1).each(function() {
                return before(this.childNodes[0], x);
              });
              this.skip(1).each(function() {
                return before(this.childNodes[0], x.cloneNode(true));
              });
            }
            return this;
          },
          prependTo: function(x) {
            if (x != null) {
              $(x).prepend(this);
            }
            return this;
          },
          before: function(x) {
            if (x != null) {
              x = toNode(x);
              this.take(1).each(function() {
                return before(this, x);
              });
              this.skip(1).each(function() {
                return before(this, x.cloneNode(true));
              });
            }
            return this;
          },
          after: function(x) {
            if (x != null) {
              x = toNode(x);
              this.take(1).each(function() {
                return after(this, x);
              });
              this.skip(1).each(function() {
                return after(this, x.cloneNode(true));
              });
            }
            return this;
          },
          wrap: function(parent) {
            parent = toNode(parent);
            if ($.is("fragment", parent)) {
              throw new Error("cannot call .wrap() with a fragment as the parent");
            }
            return this.each(function(child) {
              var grandpa, marker;
              if (($.is("fragment", child)) || !child.parentNode) {
                return parent.appendChild(child);
              }
              grandpa = child.parentNode;
              marker = document.createElement("dummy");
              parent.appendChild(grandpa.replaceChild(marker, child));
              return grandpa.replaceChild(parent, marker);
            });
          },
          unwrap: function() {
            return this.each(function() {
              if (this.parentNode && this.parentNode.parentNode) {
                return this.parentNode.parentNode.replaceChild(this, this.parentNode);
              } else if (this.parentNode) {
                return this.parentNode.removeChild(this);
              }
            });
          },
          replace: function(n) {
            var clones, i, _i, _ref1, _ref2;
            n = toNode(n);
            clones = this.map(function() {
              return n.cloneNode(true);
            });
            for (i = _i = 0, _ref1 = clones.length; _i < _ref1; i = _i += 1) {
              if ((_ref2 = this[i].parentNode) != null) {
                _ref2.replaceChild(clones[i], this[i]);
              }
            }
            return clones;
          },
          attr: function(a, v) {
            switch (v) {
              case void 0:
                return this.select("getAttribute").call(a, v);
              case null:
                return this.select("removeAttribute").call(a, v);
              default:
                this.select("setAttribute").call(a, v);
                return this;
            }
          },
          data: function(k, v) {
            return this.attr("data-" + ($.dashize(k)), v);
          },
          addClass: function(x) {
            var notempty;
            notempty = function(y) {
              return y !== "";
            };
            return this.removeClass(x).each(function() {
              var c;
              c = this.className.split(" ").filter(notempty);
              c.push(x);
              return this.className = c.join(" ");
            });
          },
          removeClass: function(x) {
            var notx;
            notx = function(y) {
              return y !== x;
            };
            return this.each(function() {
              var c;
              c = this.className.split(" ").filter(notx).join(" ");
              if (c.length === 0) {
                return this.removeAttribute('class');
              }
            });
          },
          toggleClass: function(x) {
            var notx;
            notx = function(y) {
              return y !== x;
            };
            return this.each(function() {
              var c, cls, filter;
              cls = this.className.split(" ");
              filter = $.not($.isEmpty);
              if (cls.indexOf(x) > -1) {
                filter = $.and(notx, filter);
              } else {
                cls.push(x);
              }
              c = cls.filter(filter).join(" ");
              this.className = c;
              if (c.length === 0) {
                return this.removeAttribute('class');
              }
            });
          },
          hasClass: function(x) {
            return this.select('className.split').call(" ").select('indexOf').call(x).map(function(x) {
              return x > -1;
            });
          },
          text: function(t) {
            if (t != null) {
              return this.zap('textContent', t);
            }
            return this.select('textContent');
          },
          val: function(v) {
            if (v != null) {
              return this.zap('value', v);
            }
            return this.select('value');
          },
          css: function(k, v) {
            var cv, i, n, nn, ov, setter, _i, _ref1;
            if ((v != null) || $.is("object", k)) {
              setter = this.select('style.setProperty');
              if ($.is("object", k)) {
                for (i in k) {
                  setter.call(i, k[i], "");
                }
              } else if ($.is("string", v)) {
                setter.call(k, v, "");
              } else if ($.is("array", v)) {
                for (i = _i = 0, _ref1 = n = Math.max(v.length, nn = setter.len()); _i < _ref1; i = _i += 1) {
                  setter[i % nn](k, v[i % n], "");
                }
              }
              return this;
            } else {
              cv = this.map(computeCSSProperty(k));
              ov = this.select('style').select(k);
              return ov.weave(cv).fold(function(x, y) {
                return x || y;
              });
            }
          },
          defaultCss: function(k, v) {
            var i, sel, style;
            sel = this.selector;
            style = "";
            if ($.is("string", k)) {
              if ($.is("string", v)) {
                style += "" + sel + " { " + k + ": " + v + " } ";
              } else {
                throw Error("defaultCss requires a value with a string key");
              }
            } else if ($.is("object", k)) {
              for (i in k + "} ") {
                style += ("" + sel + " { ") + ("" + i + ": " + k[i] + "; ");
              }
            }
            $("<style></style>").text(style).appendTo("head");
            return this;
          },
          rect: function() {
            return this.select('getBoundingClientRect').call();
          },
          width: getOrSetRect("width"),
          height: getOrSetRect("height"),
          top: getOrSetRect("top"),
          left: getOrSetRect("left"),
          bottom: getOrSetRect("bottom"),
          right: getOrSetRect("right"),
          position: function(left, top) {
            switch (true) {
              case !(left != null):
                return this.rect();
              case !(top != null):
                return this.css("left", $.px(left));
              default:
                return this.css({
                  top: $.px(top),
                  left: $.px(left)
                });
            }
          },
          scrollToCenter: function() {
            document.body.scrollTop = this[0].offsetTop - ($.global.innerHeight / 2);
            return this;
          },
          child: function(n) {
            return this.select('childNodes').map(function() {
              return this[n < 0 ? n + this.length : n];
            });
          },
          parents: selectChain('parentNode'),
          prev: selectChain('previousSibling'),
          next: selectChain('nextSibling'),
          remove: function() {
            return this.each(function() {
              var _ref1;
              return (_ref1 = this.parentNode) != null ? _ref1.removeChild(this) : void 0;
            });
          },
          find: function(css) {
            return this.filter("*").map(function() {
              return $(css, this);
            }).flatten();
          },
          clone: function(deep) {
            if (deep == null) {
              deep = true;
            }
            return this.map(function() {
              if ($.is("node", this)) {
                return this.cloneNode(deep);
              }
            });
          },
          toFragment: function() {
            var df;
            if (this.length > 1) {
              df = document.createDocumentFragment();
              (this.map(toNode)).map($.bound(df, df.appendChild));
              return df;
            }
            return toNode(this[0]);
          }
        };
      });
    }
  })(Bling);

  (function($) {
    return $.plugin({
      depends: "dom,function,core",
      provides: "event"
    }, function() {
      var EVENTSEP_RE, bindReady, binder, events, register_live, ret, triggerReady, unregister_live;
      EVENTSEP_RE = /,* +/;
      events = ['mousemove', 'mousedown', 'mouseup', 'mouseover', 'mouseout', 'blur', 'focus', 'load', 'unload', 'reset', 'submit', 'keyup', 'keydown', 'change', 'abort', 'cut', 'copy', 'paste', 'selection', 'drag', 'drop', 'orientationchange', 'touchstart', 'touchmove', 'touchend', 'touchcancel', 'gesturestart', 'gestureend', 'gesturecancel', 'hashchange'];
      binder = function(e) {
        return function(f) {
          return this.bind(e, f)($.is("function", f) ? void 0 : this.trigger(e, f));
        };
      };
      register_live = function(selector, context, evt, f, h) {
        return $(context).bind(evt, h).each(function() {
          var _base, _base1;
          return ((_base = ((_base1 = (this.__alive__ || (this.__alive__ = {})))[selector] || (_base1[selector] = {})))[evt] || (_base[evt] = {}))[f] = h;
        });
      };
      unregister_live = function(selector, context, e, f) {
        var $c;
        $c = $(context);
        return $c.each(function() {
          var a, b, c;
          a = (this.__alive__ || (this.__alive__ = {}));
          b = (a[selector] || (a[selector] = {}));
          c = (b[e] || (b[e] = {}));
          $c.unbind(e, c[f]);
          return delete c[f];
        });
      };
      triggerReady = $.once(function() {
        var _base;
        $(document).trigger("ready").unbind("ready");
        if (typeof document.removeEventListener === "function") {
          document.removeEventListener("DOMContentLoaded", triggerReady, false);
        }
        return typeof (_base = $.global).removeEventListener === "function" ? _base.removeEventListener("load", triggerReady, false) : void 0;
      });
      bindReady = $.once(function() {
        var _base;
        if (typeof document.addEventListener === "function") {
          document.addEventListener("DOMContentLoaded", triggerReady, false);
        }
        return typeof (_base = $.global).addEventListener === "function" ? _base.addEventListener("load", triggerReady, false) : void 0;
      });
      bindReady();
      ret = {
        bind: function(e, f) {
          var c, h;
          c = (e || "").split(EVENTSEP_RE);
          h = function(evt) {
            ret = f.apply(this, arguments);
            if (ret === false) {
              evt.preventAll();
            }
            return ret;
          };
          return this.each(function() {
            var i, _i, _len, _results;
            _results = [];
            for (_i = 0, _len = c.length; _i < _len; _i++) {
              i = c[_i];
              _results.push(this.addEventListener(i, h, false));
            }
            return _results;
          });
        },
        unbind: function(e, f) {
          var c;
          c = (e || "").split(EVENTSEP_RE);
          return this.each(function() {
            var i, _i, _len, _results;
            _results = [];
            for (_i = 0, _len = c.length; _i < _len; _i++) {
              i = c[_i];
              _results.push(this.removeEventListener(i, f, null));
            }
            return _results;
          });
        },
        trigger: function(evt, args) {
          var e, evt_i, _i, _len, _ref1;
          if (args == null) {
            args = {};
          }
          args = $.extend({
            bubbles: true,
            cancelable: true
          }, args);
          _ref1 = (evt || "").split(EVENTSEP_RE);
          for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
            evt_i = _ref1[_i];
            if (evt_i === "click" || evt_i === "mousemove" || evt_i === "mousedown" || evt_i === "mouseup" || evt_i === "mouseover" || evt_i === "mouseout") {
              e = document.createEvent("MouseEvents");
              args = $.extend({
                detail: 1,
                screenX: 0,
                screenY: 0,
                clientX: 0,
                clientY: 0,
                ctrlKey: false,
                altKey: false,
                shiftKey: false,
                metaKey: false,
                button: 0,
                relatedTarget: null
              }, args);
              e.initMouseEvent(evt_i, args.bubbles, args.cancelable, $.global, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.button, args.relatedTarget);
            } else if (evt_i === "blur" || evt_i === "focus" || evt_i === "reset" || evt_i === "submit" || evt_i === "abort" || evt_i === "change" || evt_i === "load" || evt_i === "unload") {
              e = document.createEvent("UIEvents");
              e.initUIEvent(evt_i, args.bubbles, args.cancelable, $.global, 1);
            } else if (evt_i === "touchstart" || evt_i === "touchmove" || evt_i === "touchend" || evt_i === "touchcancel") {
              e = document.createEvent("TouchEvents");
              args = $.extend({
                detail: 1,
                screenX: 0,
                screenY: 0,
                clientX: 0,
                clientY: 0,
                ctrlKey: false,
                altKey: false,
                shiftKey: false,
                metaKey: false,
                touches: [],
                targetTouches: [],
                changedTouches: [],
                scale: 1.0,
                rotation: 0.0
              }, args);
              e.initTouchEvent(evt_i, args.bubbles, args.cancelable, $.global, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.touches, args.targetTouches, args.changedTouches, args.scale, args.rotation);
            } else if (evt_i === "gesturestart" || evt_i === "gestureend" || evt_i === "gesturecancel") {
              e = document.createEvent("GestureEvents");
              args = $.extend({
                detail: 1,
                screenX: 0,
                screenY: 0,
                clientX: 0,
                clientY: 0,
                ctrlKey: false,
                altKey: false,
                shiftKey: false,
                metaKey: false,
                target: null,
                scale: 1.0,
                rotation: 0.0
              }, args);
              e.initGestureEvent(evt_i, args.bubbles, args.cancelable, $.global, args.detail, args.screenX, args.screenY, args.clientX, args.clientY, args.ctrlKey, args.altKey, args.shiftKey, args.metaKey, args.target, args.scale, args.rotation);
            } else {
              e = document.createEvent("Events");
              e.initEvent(evt_i, args.bubbles, args.cancelable);
              try {
                e = $.extend(e, args);
              } catch (err) {

              }
            }
            if (!e) {
              continue;
            } else {
              try {
                this.each(function() {
                  return this.dispatchEvent(e);
                });
              } catch (err) {
                $.log("dispatchEvent error:", err);
              }
            }
          }
          return this;
        },
        live: function(e, f) {
          var context, handler, selector;
          selector = this.selector;
          context = this.context;
          handler = function(evt) {
            return $(selector, context).intersect($(evt.target).parents().first().union($(evt.target))).each(function() {
              return f.call(evt.target = this, evt);
            });
          };
          register_live(selector, context, e, f, handler);
          return this;
        },
        die: function(e, f) {
          $(this.context).unbind(e, unregister_live(this.selector, this.context, e, f));
          return this;
        },
        click: function(f) {
          var _ref1;
          if (f == null) {
            f = {};
          }
          if ((_ref1 = this.css("cursor")) === "auto" || _ref1 === "") {
            this.css("cursor", "pointer");
          }
          if ($.is("function", f)) {
            this.bind('click', f);
          } else {
            this.trigger('click', f);
          }
          return this;
        },
        ready: function(f) {
          if (triggerReady.exhausted) {
            return f.call(this);
          }
          return this.bind("ready", f);
        }
      };
      events.forEach(function(x) {
        return ret[x] = binder(x);
      });
      return ret;
    });
  })(Bling);

  (function($) {
    return $.plugin(function() {
      return {
        $: {
          histogram: function(data, bucket_width, output_width) {
            var buckets, end, i, len, max, n, pct, ret, sum, x, _i, _j, _len, _ref1;
            if (bucket_width == null) {
              bucket_width = 1;
            }
            if (output_width == null) {
              output_width = 80;
            }
            buckets = $();
            len = 0;
            for (_i = 0, _len = data.length; _i < _len; _i++) {
              x = data[_i];
              i = Math.floor(x / bucket_width);
              if ((_ref1 = buckets[i]) == null) {
                buckets[i] = 0;
              }
              buckets[i] += 1;
              len = Math.max(len, i + 1);
            }
            buckets.length = len;
            max = buckets.max();
            buckets = buckets.map(function(x) {
              return x || 0;
            }).scale(1 / max).scale(output_width);
            sum = buckets.sum();
            ret = "";
            for (n = _j = 0; _j < len; n = _j += 1) {
              end = (n + 1) * bucket_width;
              pct = (buckets[n] * 100 / sum).toFixed(0);
              ret += $.padLeft(pct + "%", 3) + $.padRight(" < " + (end.toFixed(2)), 10) + ": " + $.repeat("#", buckets[n]) + "\n";
            }
            return ret;
          }
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      depends: "dom",
      provides: "http"
    }, function() {
      var formencode;
      formencode = function(obj) {
        var i, o;
        o = JSON.parse(JSON.stringify(obj));
        return ((function() {
          var _results;
          _results = [];
          for (i in o) {
            _results.push("" + i + "=" + (escape(o[i])));
          }
          return _results;
        })()).join("&");
      };
      $.type.register("http", {
        match: function(o) {
          return $.isType('XMLHttpRequest', o);
        },
        array: function(o) {
          return [o];
        }
      });
      return {
        $: {
          http: function(url, opts) {
            var xhr;
            if (opts == null) {
              opts = {};
            }
            xhr = new XMLHttpRequest();
            if ($.is("function", opts)) {
              opts = {
                success: $.bound(xhr, opts)
              };
            }
            opts = $.extend({
              method: "GET",
              data: null,
              state: $.identity,
              success: $.identity,
              error: $.identity,
              async: true,
              asBlob: false,
              timeout: 0,
              followRedirects: false,
              withCredentials: false
            }, opts);
            opts.state = $.bound(xhr, opts.state);
            opts.success = $.bound(xhr, opts.success);
            opts.error = $.bound(xhr, opts.error);
            if (opts.data && opts.method === "GET") {
              url += "?" + formencode(opts.data);
            } else if (opts.data && opts.method === "POST") {
              opts.data = formencode(opts.data);
            }
            xhr.open(opts.method, url, opts.async);
            xhr = $.extend(xhr, {
              asBlob: opts.asBlob,
              timeout: opts.timeout,
              followRedirects: opts.followRedirects,
              withCredentials: opts.withCredentials,
              onreadystatechange: function() {
                if (typeof opts.state === "function") {
                  opts.state();
                }
                if (xhr.readyState === 4) {
                  if (xhr.status === 200) {
                    return opts.success(xhr.responseText);
                  } else {
                    return opts.error(xhr.status, xhr.statusText);
                  }
                }
              }
            });
            xhr.send(opts.data);
            return $(xhr);
          },
          post: function(url, opts) {
            if (opts == null) {
              opts = {};
            }
            if ($.is("function", opts)) {
              opts = {
                success: opts
              };
            }
            opts.method = "POST";
            return $.http(url, opts);
          },
          get: function(url, opts) {
            if (opts == null) {
              opts = {};
            }
            if ($.is("function", opts)) {
              opts = {
                success: opts
              };
            }
            opts.method = "GET";
            return $.http(url, opts);
          }
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      depends: "dom",
      provides: "lazy"
    }, function() {
      var lazy_load;
      lazy_load = function(elementName, props) {
        return $("head").append($.extend(document.createElement(elementName), props));
      };
      return {
        $: {
          script: function(src) {
            return lazy_load("script", {
              src: src
            });
          },
          style: function(src) {
            return lazy_load("link", {
              href: src,
              rel: "stylesheet"
            });
          }
        }
      };
    });
  })(Bling);

  (function($) {
    var alphabet, random;
    alphabet = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
    random = (function() {
      var MT, a, b, generate_numbers, index, init_generator, next;
      MT = new Array(624);
      index = 0;
      init_generator = function(seed) {
        var i, _i, _results;
        index = 0;
        MT[0] = seed;
        _results = [];
        for (i = _i = 1; _i <= 623; i = ++_i) {
          _results.push(MT[i] = 0xFFFFFFFF & (1812433253 * (MT[i - 1] ^ (MT[i - 1] >>> 30)) + i));
        }
        return _results;
      };
      generate_numbers = function() {
        var i, y, _i, _results;
        _results = [];
        for (i = _i = 0; _i <= 623; i = ++_i) {
          y = ((MT[i] & 0x80000000) >>> 31) + (0x7FFFFFFF & MT[(i + 1) % 624]);
          MT[i] = MT[(i + 397) % 624] ^ (y >>> 1);
          if ((y % 2) === 1) {
            _results.push(MT[i] = MT[i] ^ 2567483615);
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      };
      a = Math.pow(2, 31);
      b = a * 2;
      next = function() {
        var y;
        if (index === 0) {
          generate_numbers();
        }
        y = MT[index] ^ (y >>> 11) ^ ((y << 7) && 2636928640) ^ ((y << 15) && 4022730752) ^ (y >>> 18);
        index = (index + 1) % 624;
        return (y + a) / b;
      };
      $.defineProperty(next, "seed", {
        set: function(v) {
          return init_generator(v);
        }
      });
      next.seed = +new Date();
      return $.extend(next, {
        real: function(min, max) {
          var _ref1, _ref2;
          if (!(min != null)) {
            _ref1 = [0, 1.0], min = _ref1[0], max = _ref1[1];
          }
          if (!(max != null)) {
            _ref2 = [0, min], min = _ref2[0], max = _ref2[1];
          }
          return ($.random() * (max - min)) + min;
        },
        integer: function(min, max) {
          return Math.floor($.random.real(min, max));
        },
        string: function(len, prefix) {
          if (prefix == null) {
            prefix = "";
          }
          while (prefix.length < len) {
            prefix += $.random.element(alphabet);
          }
          return prefix;
        },
        coin: function(balance) {
          if (balance == null) {
            balance = .5;
          }
          return $.random() <= balance;
        },
        element: function(arr) {
          return arr[$.random.integer(0, arr.length)];
        },
        gaussian: function(mean, ssig) {
          var q, u, v, x, y;
          if (mean == null) {
            mean = 0.5;
          }
          if (ssig == null) {
            ssig = 0.12;
          }
          while (true) {
            u = $.random();
            v = 1.7156 * ($.random() - 0.5);
            x = u - 0.449871;
            y = Math.abs(v) + 0.386595;
            q = (x * x) + y * (0.19600 * y - 0.25472 * x);
            if (!(q > 0.27597 && (q > 0.27846 || (v * v) > (-4 * Math.log(u) * u * u)))) {
              break;
            }
          }
          return mean + ssig * v / u;
        }
      });
    })();
    return $.plugin({
      provides: "random"
    }, function() {
      return {
        $: {
          random: random
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      provides: "sendgrid",
      depends: "config"
    }, function() {
      var nodemailer, transport;
      try {
        nodemailer = require('nodemailer');
      } catch (err) {
        return;

      }
      transport = nodemailer.createTransport('SMTP', {
        service: 'SendGrid',
        auth: {
          user: $.config.get('SENDGRID_USERNAME'),
          pass: $.config.get('SENDGRID_PASSWORD')
        }
      });
      return {
        $: {
          sendMail: function(mail, callback) {
            var _ref1, _ref2, _ref3;
            if ((_ref1 = mail.transport) == null) {
              mail.transport = transport;
            }
            if ((_ref2 = mail.from) == null) {
              mail.from = $.config.get('EMAILS_FROM');
            }
            if ((_ref3 = mail.bcc) == null) {
              mail.bcc = $.config.get('EMAILS_BCC');
            }
            if ($.config.get('SENDGRID_ENABLED', 'true') === 'true') {
              return nodemailer.sendMail(mail, callback);
            } else {
              return callback(false);
            }
          }
        }
      };
    });
  })(Bling);

  (function($) {
    $.plugin({
      provides: "StateMachine"
    }, function() {
      var StateMachine;
      return {
        $: {
          StateMachine: StateMachine = (function() {

            function StateMachine(stateTable) {
              this.reset();
              this.table = stateTable;
              Object.defineProperty(this, "modeline", {
                get: function() {
                  return this.table[this._mode];
                }
              });
              Object.defineProperty(this, "mode", {
                set: function(m) {
                  var ret;
                  this._lastMode = this._mode;
                  this._mode = m;
                  if (this._mode !== this._lastMode && (this.modeline != null) && 'enter' in this.modeline) {
                    ret = this.modeline['enter'].call(this);
                    while ($.is("function", ret)) {
                      ret = ret.call(this);
                    }
                  }
                  return m;
                },
                get: function() {
                  return this._mode;
                }
              });
            }

            StateMachine.prototype.reset = function() {
              this._mode = null;
              return this._lastMode = null;
            };

            StateMachine.prototype.GO = function(m) {
              return function() {
                return this.mode = m;
              };
            };

            StateMachine.GO = function(m) {
              return function() {
                return this.mode = m;
              };
            };

            StateMachine.prototype.tick = function(c) {
              var ret, row;
              row = this.modeline;
              if (!(row != null)) {
                ret = null;
              } else if (c in row) {
                ret = row[c];
              } else if ('def' in row) {
                ret = row['def'];
              }
              while ($.is("function", ret)) {
                ret = ret.call(this, c);
              }
              return ret;
            };

            StateMachine.prototype.run = function(inputs) {
              var c, ret, _i, _len, _ref1;
              this.mode = 0;
              for (_i = 0, _len = inputs.length; _i < _len; _i++) {
                c = inputs[_i];
                ret = this.tick(c);
              }
              if ($.is("function", (_ref1 = this.modeline) != null ? _ref1.eof : void 0)) {
                ret = this.modeline.eof.call(this);
              }
              while ($.is("function", ret)) {
                ret = ret.call(this);
              }
              this.reset();
              return this;
            };

            return StateMachine;

          })()
        }
      };
    });
    return $.plugin({
      provides: "synth",
      depends: "StateMachine"
    }, function() {
      var SynthMachine;
      SynthMachine = (function(_super) {

        __extends(SynthMachine, _super);

        SynthMachine.STATE_TABLE = [
          {
            enter: function() {
              this.tag = this.id = this.cls = this.attr = this.val = this.text = "";
              this.attrs = {};
              return this.GO(1);
            }
          }, {
            '"': SynthMachine.GO(6),
            "'": SynthMachine.GO(7),
            "#": SynthMachine.GO(2),
            ".": SynthMachine.GO(3),
            "[": SynthMachine.GO(4),
            " ": SynthMachine.GO(9),
            "+": SynthMachine.GO(11),
            ",": SynthMachine.GO(10),
            def: function(c) {
              return this.tag += c;
            },
            eof: SynthMachine.GO(13)
          }, {
            ".": SynthMachine.GO(3),
            "[": SynthMachine.GO(4),
            " ": SynthMachine.GO(9),
            "+": SynthMachine.GO(11),
            ",": SynthMachine.GO(10),
            def: function(c) {
              return this.id += c;
            },
            eof: SynthMachine.GO(13)
          }, {
            enter: function() {
              if (this.cls.length > 0) {
                return this.cls += " ";
              }
            },
            "#": SynthMachine.GO(2),
            ".": SynthMachine.GO(3),
            "[": SynthMachine.GO(4),
            " ": SynthMachine.GO(9),
            "+": SynthMachine.GO(11),
            ",": SynthMachine.GO(10),
            def: function(c) {
              return this.cls += c;
            },
            eof: SynthMachine.GO(13)
          }, {
            "=": SynthMachine.GO(5),
            "]": function() {
              this.attrs[this.attr] = this.val;
              return this.GO(1);
            },
            def: function(c) {
              return this.attr += c;
            },
            eof: SynthMachine.GO(12)
          }, {
            "]": function() {
              this.attrs[this.attr] = this.val;
              return this.GO(1);
            },
            def: function(c) {
              return this.val += c;
            },
            eof: SynthMachine.GO(12)
          }, {
            '"': SynthMachine.GO(8),
            def: function(c) {
              return this.text += c;
            },
            eof: SynthMachine.GO(12)
          }, {
            "'": SynthMachine.GO(8),
            def: function(c) {
              return this.text += c;
            },
            eof: SynthMachine.GO(12)
          }, {
            enter: function() {
              this.emitText();
              return this.GO(0);
            }
          }, {
            enter: function() {
              this.emitNode();
              return this.GO(0);
            }
          }, {
            enter: function() {
              this.emitNode();
              this.parent = null;
              return this.GO(0);
            }
          }, {
            enter: function() {
              var _ref1;
              this.emitNode();
              this.parent = (_ref1 = this.parent) != null ? _ref1.parentNode : void 0;
              return this.GO(0);
            }
          }, {
            enter: function() {
              return $.log("Error in synth expression: " + this.input);
            }
          }, {
            enter: function() {
              if (this.tag.length) {
                this.emitNode();
              }
              if (this.text.length) {
                return this.emitText();
              }
            }
          }
        ];

        function SynthMachine() {
          SynthMachine.__super__.constructor.call(this, SynthMachine.STATE_TABLE);
          this.fragment = this.parent = document.createDocumentFragment();
        }

        SynthMachine.prototype.emitNode = function() {
          var k, node;
          node = document.createElement(this.tag);
          node.id = this.id || null;
          node.className = this.cls || null;
          for (k in this.attrs) {
            node.setAttribute(k, this.attrs[k]);
          }
          this.parent.appendChild(node);
          return this.parent = node;
        };

        SynthMachine.prototype.emitText = function() {
          this.parent.appendChild($.HTML.parse(this.text));
          return this.text = "";
        };

        return SynthMachine;

      })($.StateMachine);
      return {
        $: {
          synth: function(expr) {
            var s;
            s = new SynthMachine();
            s.run(expr);
            if (s.fragment.childNodes.length === 1) {
              return $(s.fragment.childNodes[0]);
            } else {
              return $(s.fragment);
            }
          }
        }
      };
    });
  })(Bling);

  (function($) {
    var engines, match_forward;
    engines = {};
    $.plugin(function() {
      var current_engine, template;
      current_engine = null;
      engines = {};
      template = {
        register_engine: function(name, render_func) {
          engines[name] = render_func;
          if (!(current_engine != null)) {
            return current_engine = name;
          }
        },
        render: function(text, args) {
          if (current_engine in engines) {
            return engines[current_engine](text, args);
          }
        }
      };
      template.__defineSetter__('engine', function(v) {
        if (!v in engines) {
          throw new Error("invalid template engine: " + v + " not one of " + (Object.Keys(engines)));
        } else {
          return current_engine = v;
        }
      });
      template.__defineGetter__('engine', function() {
        return current_engine;
      });
      return {
        name: 'Template',
        $: {
          template: template
        }
      };
    });
    $.template.register_engine('null', (function() {
      return function(text, values) {
        return text;
      };
    })());
    match_forward = function(text, find, against, start, stop) {
      var count, i, t, _i;
      if (stop == null) {
        stop = -1;
      }
      count = 1;
      if (stop < 0) {
        stop = text.length + 1 + stop;
      }
      for (i = _i = start; start <= stop ? _i < stop : _i > stop; i = start <= stop ? ++_i : --_i) {
        t = text[i];
        if (t === against) {
          count += 1;
        } else if (t === find) {
          count -= 1;
        }
        if (count === 0) {
          return i;
        }
      }
      return -1;
    };
    $.template.register_engine('pythonic', (function() {
      var chunk_re, compile, render, type_re;
      type_re = /([0-9#0+-]*)\.*([0-9#+-]*)([diouxXeEfFgGcrsqm])((?:.|\n)*)/;
      chunk_re = /%[\(\/]/;
      compile = function(text) {
        var chunks, end, i, j, key, match, n, rest, ret, _i;
        chunks = text.split(chunk_re);
        n = chunks.length;
        ret = [chunks[0]];
        j = 1;
        for (i = _i = 1; 1 <= n ? _i < n : _i > n; i = 1 <= n ? ++_i : --_i) {
          end = match_forward(chunks[i], ')', '(', 0, -1);
          if (end === -1) {
            return "Template syntax error: unmatched '%(' starting at: " + (chunks[i].substring(0, 15));
          }
          key = chunks[i].substring(0, end);
          rest = chunks[i].substring(end);
          match = type_re.exec(rest);
          if (match === null) {
            return "Template syntax error: invalid type specifier starting at '" + rest + "'";
          }
          rest = match[4];
          ret[j++] = key;
          ret[j++] = match[1] | 0;
          ret[j++] = match[2] | 0;
          ret[j++] = match[3];
          ret[j++] = rest;
        }
        return ret;
      };
      compile.cache = {};
      render = function(text, values) {
        var cache, fixed, i, j, key, n, output, pad, rest, type, value, _i, _ref1, _ref2;
        cache = compile.cache[text];
        if (!(cache != null)) {
          cache = compile.cache[text] = compile(text);
        }
        output = [cache[0]];
        j = 1;
        n = cache.length;
        for (i = _i = 1, _ref1 = n - 5; _i <= _ref1; i = _i += 5) {
          _ref2 = cache.slice(i, (i + 4) + 1 || 9e9), key = _ref2[0], pad = _ref2[1], fixed = _ref2[2], type = _ref2[3], rest = _ref2[4];
          value = values[key];
          if (!(value != null)) {
            value = "missing value: " + key;
          }
          switch (type) {
            case 'd':
              output[j++] = "" + parseInt(value, 10);
              break;
            case 'f':
              output[j++] = parseFloat(value).toFixed(fixed);
              break;
            case 's':
              output[j++] = "" + value;
              break;
            default:
              output[j++] = "" + value;
          }
          if (pad > 0) {
            output[j] = String.PadLeft(output[j], pad);
          }
          output[j++] = rest;
        }
        return output.join("");
      };
      return render;
    })());
    return $.template.register_engine('js-eval', (function() {
      var TemplateMachine;
      TemplateMachine = (function(_super) {

        __extends(TemplateMachine, _super);

        function TemplateMachine() {
          return TemplateMachine.__super__.constructor.apply(this, arguments);
        }

        TemplateMachine.STATE_TABLE = [
          {
            enter: function() {
              this.data = [];
              return this.GO(1);
            }
          }, {}
        ];

        return TemplateMachine;

      })($.StateMachine);
      return function(text, values) {
        return text;
      };
    })());
  })(Bling);

  (function($) {
    return $.plugin(function() {
      var parseArray, parseObject, parseOne;
      parseOne = function(data) {
        var extra, i, item, len, type;
        i = data.indexOf(":");
        if (i > 0) {
          len = parseInt(data.slice(0, i), 10);
          item = data.slice(i + 1, i + 1 + len);
          type = data[i + 1 + len];
          extra = data.slice(i + len + 2);
          item = (function() {
            switch (type) {
              case "#":
                return Number(item);
              case "'":
                return String(item);
              case "!":
                return item === "true";
              case "~":
                return null;
              case "]":
                return parseArray(item);
              case "}":
                return parseObject(item);
            }
          })();
          return [item, extra];
        }
        return void 0;
      };
      parseArray = function(x) {
        var data, one, _ref1;
        data = [];
        while (x.length > 0) {
          _ref1 = parseOne(x), one = _ref1[0], x = _ref1[1];
          data.push(one);
        }
        return data;
      };
      parseObject = function(x) {
        var data, key, value, _ref1, _ref2;
        data = {};
        while (x.length > 0) {
          _ref1 = parseOne(x), key = _ref1[0], x = _ref1[1];
          _ref2 = parseOne(x), value = _ref2[0], x = _ref2[1];
          data[key] = value;
        }
        return data;
      };
      return {
        $: {
          TNET: {
            stringify: function(x) {
              var data, type, y, _ref1;
              _ref1 = (function() {
                switch ($.type(x)) {
                  case "number":
                    return [String(x), "#"];
                  case "string":
                    return [x, "'"];
                  case "function":
                    return [String(x), "'"];
                  case "boolean":
                    return [String(!!x), "!"];
                  case "null":
                    return ["", "~"];
                  case "undefined":
                    return ["", "~"];
                  case "array":
                    return [
                      ((function() {
                        var _i, _len, _results;
                        _results = [];
                        for (_i = 0, _len = x.length; _i < _len; _i++) {
                          y = x[_i];
                          _results.push($.TNET.stringify(y));
                        }
                        return _results;
                      })()).join(''), "]"
                    ];
                  case "object":
                    return [
                      ((function() {
                        var _results;
                        _results = [];
                        for (y in x) {
                          _results.push($.TNET.stringify(y) + $.TNET.stringify(x[y]));
                        }
                        return _results;
                      })()).join(''), "}"
                    ];
                }
              })(), data = _ref1[0], type = _ref1[1];
              return (data.length | 0) + ":" + data + type;
            },
            parse: function(x) {
              var _ref1;
              return (_ref1 = parseOne(x)) != null ? _ref1[0] : void 0;
            }
          }
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      provides: "trace",
      depends: "function,type"
    }, function() {
      $.type.extend({
        unknown: {
          trace: $.identity
        },
        object: {
          trace: function(o, label, tracer) {
            var k, _i, _len, _ref1;
            _ref1 = Object.keys(o);
            for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
              k = _ref1[_i];
              o[k] = $.trace(o[k], "" + label + "." + k, tracer);
            }
            return o;
          }
        },
        array: {
          trace: function(o, label, tracer) {
            var i, _i, _ref1;
            for (i = _i = 0, _ref1 = o.length; _i < _ref1; i = _i += 1) {
              o[i] = $.trace(o[i], "" + label + "[" + i + "]", tracer);
            }
            return o;
          }
        },
        "function": {
          trace: function(f, label, tracer) {
            var r;
            r = function() {
              var a;
              a = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
              tracer("" + (this.name || $.type(this)) + "." + (label || f.name) + "(", a, ")");
              return f.apply(this, a);
            };
            tracer("Trace: " + (label || f.name) + " created.");
            r.toString = f.toString;
            return r;
          }
        }
      });
      return {
        $: {
          trace: function(o, label, tracer) {
            if (tracer == null) {
              tracer = $.log;
            }
            return $.type.lookup(o).trace(o, label, tracer);
          }
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      depends: "dom"
    }, function() {
      var COMMASEP, accel_props_re, speeds, testStyle, transformProperty, transitionDuration, transitionProperty, transitionTiming, updateDelay;
      COMMASEP = ", ";
      speeds = {
        "slow": 700,
        "medium": 500,
        "normal": 300,
        "fast": 100,
        "instant": 0,
        "now": 0
      };
      accel_props_re = /(?:scale(?:3d)*|translate(?:[XYZ]|3d)*|rotate(?:[XYZ]|3d)*)/;
      updateDelay = 30;
      testStyle = document.createElement("div").style;
      transformProperty = "transform";
      transitionProperty = "transition-property";
      transitionDuration = "transition-duration";
      transitionTiming = "transition-timing-function";
      if ("WebkitTransform" in testStyle) {
        transformProperty = "-webkit-transform";
        transitionProperty = "-webkit-transition-property";
        transitionDuration = "-webkit-transition-duration";
        transitionTiming = "-webkit-transition-timing-function";
      } else if ("MozTransform" in testStyle) {
        transformProperty = "-moz-transform";
        transitionProperty = "-moz-transition-property";
        transitionDuration = "-moz-transition-duration";
        transitionTiming = "-moz-transition-timing-function";
      } else if ("OTransform" in testStyle) {
        transformProperty = "-o-transform";
        transitionProperty = "-o-transition-property";
        transitionDuration = "-o-transition-duration";
        transitionTiming = "-o-transition-timing-function";
      }
      return {
        $: {
          duration: function(speed) {
            var d;
            d = speeds[speed];
            if (d != null) {
              return d;
            }
            return parseFloat(speed);
          }
        },
        transform: function(end_css, speed, easing, callback) {
          var css, duration, i, ii, props, trans;
          if ($.is("function", speed)) {
            callback = speed;
            speed = easing = null;
          } else if ($.is("function", easing)) {
            callback = easing;
            easing = null;
          }
          if (speed == null) {
            speed = "normal";
          }
          easing || (easing = "ease");
          duration = $.duration(speed) + "ms";
          props = [];
          trans = "";
          css = {};
          for (i in end_css) {
            if (accel_props_re.test(i)) {
              ii = end_css[i];
              if (ii.join) {
                ii = $(ii).px().join(COMMASEP);
              } else if (ii.toString) {
                ii = ii.toString();
              }
              trans += " " + i + "(" + ii + ")";
            } else {
              css[i] = end_css[i];
            }
          }
          for (i in css) {
            props.push(i);
          }
          if (trans) {
            props.push(transformProperty);
          }
          css[transitionProperty] = props.join(COMMASEP);
          css[transitionDuration] = props.map(function() {
            return duration;
          }).join(COMMASEP);
          css[transitionTiming] = props.map(function() {
            return easing;
          }).join(COMMASEP);
          if (trans) {
            css[transformProperty] = trans;
          }
          this.css(css);
          return this.delay(duration, callback);
        },
        hide: function(callback) {
          return this.each(function() {
            if (this.style) {
              this._display = "";
              if (this.style.display === !"none") {
                this._display = this.syle.display;
              }
              return this.style.display = "none";
            }
          }).trigger("hide".delay(updateDelay, callback));
        },
        show: function(callback) {
          return this.each(function() {
            if (this.style) {
              this.style.display = this._display;
              return delete this._display;
            }
          }).trigger("show".delay(updateDelay, callback));
        },
        toggle: function(callback) {
          return this.weave(this.css("display")).fold(function(display, node) {
            if (display === "none") {
              node.style.display = node._display || "";
              delete node._display;
              $(node).trigger("show");
            } else {
              node._display = display;
              node.style.display = "none";
              $(node).trigger("hide");
            }
            return node;
          }).delay(updateDelay, callback);
        },
        fadeIn: function(speed, callback) {
          return this.css('opacity', '0.0').show(function() {
            return this.transform({
              opacity: "1.0",
              translate3d: [0, 0, 0]
            }, speed, callback);
          });
        },
        fadeOut: function(speed, callback, x, y) {
          if (x == null) {
            x = 0.0;
          }
          if (y == null) {
            y = 0.0;
          }
          return this.transform({
            opacity: "0.0",
            translate3d: [x, y, 0.0]
          }, speed, function() {
            return this.hide(callback);
          });
        },
        fadeLeft: function(speed, callback) {
          return this.fadeOut(speed, callback, "-" + this.width().first(), 0.0);
        },
        fadeRight: function(speed, callback) {
          return this.fadeOut(speed, callback, this.width().first(), 0.0);
        },
        fadeUp: function(speed, callback) {
          return this.fadeOut(speed, callback, 0.0, "-" + this.height().first());
        },
        fadeDown: function(speed, callback) {
          return this.fadeOut(speed, callback, 0.0, this.height().first());
        }
      };
    });
  })(Bling);

  (function($) {
    return $.plugin({
      provides: "unittest",
      depends: "core"
    }, function() {
      var failCount, failed, invokeTest, passCount, testCount, testReport;
      testCount = passCount = failCount = 0;
      failed = [];
      invokeTest = function(group, name, func) {
        var done, f, shouldFail, _log;
        if (!$.is("function", func)) {
          return;
        }
        _log = function(msg) {
          return $.log("" + group + ": " + name + "... " + msg);
        };
        shouldFail = name.toLowerCase().indexOf("fail") !== -1;
        done = $.once(function(err) {
          testCount--;
          if (!!err !== shouldFail) {
            _log("fail: " + err);
            failCount++;
            return failed.push(name);
          } else {
            _log("pass");
            passCount++;
            return $.provide(name);
          }
        });
        f = function(done) {
          try {
            return func(done);
          } catch (err) {
            return done(err);
          } finally {
            if (name.toLowerCase().indexOf("async") === -1) {
              done();
            }
          }
        };
        testCount++;
        try {
          return f(done);
        } catch (err) {
          return done(err);
        }
      };
      testReport = $.once(function() {
        return $.log("Passed: " + passCount + " Failed: " + failCount + " [" + failed + "]");
      });
      return {
        $: {
          approx: function(a, b, margin) {
            if (margin == null) {
              margin = .1;
            }
            return Math.abs(a - b) < margin;
          },
          assert: function(cnd, msg) {
            if (msg == null) {
              msg = "no message";
            }
            if (!cnd) {
              throw new Error("Assertion failed: " + msg);
            }
          },
          assertEqual: function(a, b, label) {
            if (a !== b) {
              throw Error("" + (label || '') + " (" + (a != null ? a.toString() : void 0) + ") should equal (" + (b != null ? b.toString() : void 0) + ")");
            }
          },
          assertArrayEqual: function(a, b, label) {
            var i, _i, _ref1, _results;
            _results = [];
            for (i = _i = 0, _ref1 = a.length; 0 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 0 <= _ref1 ? ++_i : --_i) {
              try {
                _results.push($.assertEqual(a[i], b[i], label));
              } catch (err) {
                throw Error("" + (label || '') + " " + (a != null ? a.toString() : void 0) + " should equal " + (b != null ? b.toString() : void 0));
              }
            }
            return _results;
          },
          testGroup: function(name, funcs) {
            var func, interval, k, _results;
            interval = setInterval((function() {
              if (testCount === 0) {
                clearInterval(interval);
                return testReport();
              }
            }), 50);
            _results = [];
            for (k in funcs) {
              func = funcs[k];
              _results.push(invokeTest(name, k, func));
            }
            return _results;
          }
        },
        assertEqual: function() {
          var a, args, i, _i, _ref1,
            _this = this;
          args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
          if (args.length > 1) {
            args = args.map(function(x) {
              if ($.is("function", x)) {
                return x.call(_this, _this);
              } else {
                return x;
              }
            });
            a = args[0];
            for (i = _i = 1, _ref1 = args.length; 1 <= _ref1 ? _i < _ref1 : _i > _ref1; i = 1 <= _ref1 ? ++_i : --_i) {
              $.assertEqual(a, args[i]);
            }
          }
          return this;
        }
      };
    });
  })(Bling);

}).call(this);
