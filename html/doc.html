<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<script src="../bling.js"></script>
		<script src="../plugins/bling.ui.js"></script>
		<script src="../plugins/bling.doc.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Nobile' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
		<style>
			body {
				font-family: 'Nobile', Verdana, sans;
				font-size: 14px;
				width:320px;
				padding:4px;
				margin-left:auto;
				margin-right:auto;
				background-color:white;
			}
			.large { font-size: 16px; }
			.medium { font-size: 14px; }
			.small { font-size: 10px; }
			a.toggle {
				line-height: 20px;
				vertical-align:middle;
				margin: 0px 8px;
			}
			b { color:#911; }
			i { color:#822; }
			p {
				width:300px;
				font-size:14px;
				text-align: justify;
				margin-top: 6px;
			}
			a[name^='api:'] {
				font-size: 18px;
				font-weight: bold;
				font-family: 'Inconsolata';
				color: #222;
				text-decoration:none;
			}
			code.pp, textarea {
				font-family: 'Inconsolata', courier, fixed, sans;
				font-size:14px;
				line-height:1.1em;
				padding:0px 0px 0px 4px;
				display: inline-block;
				margin:0px 0px 0px 0px;
			}
			code {
				font-family: 'Inconsolata', courier, fixed, sans;
				font-size: 16px;
			}
			ol {
				list-style: decimal;
				padding-left: 10px;
			}
			ol ol {
				list-style: circle;
			}

			li.module > span {
				font-size: 16px;
				font-weight: bold;
			}

			a.example {
			}
			li.func {
			}

			.examples {
				display: none;
			}

			#search {
				border-radius: 5px;
			}
		</style>
		<script>
			$(document).ready(function() {
				var $body = $("body"),
					$docroot = $("#docroot"),
					$search = $("#search"),
					i = 0, name = null, module = null,
					progressBar = $.UI.ProgressBar("#search", {
						barColor: "rgba(0,0,0,0.7)",
						textColor: "yellow",
					}),
					funcTemplate = $.synth('li.func a[name=api:%(reference)s] span.def "%(definition)s"'
						+ ' + + a[href=#api:%(reference)s][title=Permalink] "&nbsp;&#182;&nbsp;"'
						+ ' + "&mdash;" br'
						+ ' + span.desc "%(description)s"'
						// + ' + a.example[href=#ex:%(reference)s][title=Examples] "Examples"'
						+ ' + div.examples a[name=#ex:%(reference)s] + "%(examples)s"'),
					old_val,
					$items = $("ol#docroot li")

				setTimeout(function () {
					if( name = $.plugin.s[i++] ) {
						var h3 = $.synth("li.module span '"+name+"'"), // a.toggle.small[name="+name+"][href=#"+name+"] 'Toggle'"),
							ul = $.synth("ol.apilist").append($.doc.module(name, funcTemplate))
						// h3.find("a.toggle").click(function() {
							// ul.toggle()
						// })
						$docroot.append(h3.append(ul))
						// update progress bar
						progressBar.update(i/$.plugin.s.length)
						setTimeout(arguments.callee, 0)
					} else {
						progressBar.update(1)
						$items = $("ol#docroot li")
						// fade the docs in 
						$docroot.fadeIn(function() {
							// read the #hash and scroll there
							var hash = window.location.hash
							if( hash ) {
								hash = hash.replace(/#/, "")
								$("a[name='"+hash+"']").first().scrollIntoView()
							}
						})
					}
				}, 0)
				$docroot.hide()


				$("li.func span.def, li.func span.desc", $docroot).live('click', function() {
					$(this).parents().flatten()
						.intersect($("#docroot li.func"))
						.find("div.examples")
						.toggle()
				})

				$search.keyup(function() {
					var val = $search.val().first().trim()
					if( val == old_val)
						return // ignore keystrokes that dont alter the value
					old_val = val
					$items.hide()
					if( val === "" )
						$items.show()
					else {
						var step = 0, match = null
						setTimeout(function() {
							switch( step ) {
								case 0:
									match = $("ol.apilist li a[name^='api:Bling.'][name*='"+val+"']")
									break
								case 1:
									match = match.parents().flatten()
									break
								case 2:
									match = match.intersect($items)
									break
								case 3:
									match.show()
									return
							}
							step += 1
							progressBar.update(step/3, 0)
							setTimeout(arguments.callee, 10)
						}, 10)
					}
				})
			})
		</script>
	</head>
	<body>
		<input id="search" type="text" size="20" placeholder="Enter filter text here">
		<ol id="docroot">
		</ol>
	</body>
</html>
