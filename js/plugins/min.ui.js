(function(f){return f.plugin(function(){Dialog(selector,opts)(function(){var a,b;b=Object.Extend({autoOpen:!1,draggable:!0},b);a=f(selector).addClass("dialog");b.draggable&&a.draggable();b.autoOpen&&a.show().center();a.find("button.close, .close-button").bind("click touchstart",function(){a.hide();return!1});return a});Draggable(selector,opts)(function(){var a,b,c,e,g,d;d=Object.Extend({handleCSS:{}},d);d.handleCSS=Object.Extend({position:"absolute",top:"0px",left:"0px",width:"100%",height:"6px"},
d.handleCSS);a=f(selector);c=!1;e=g=0;b=f.synth("div.handle").defaultCss({background:"-webkit-gradient(linear, 50% 0%, 50% 100%, from(#eee), color-stop(0.25, #bbb), color-stop(0.3, #eee), color-stop(0.5, #eee), to(#bbb))",height:"6px","border-radius":"3px",cursor:"move"}.css(d.handleCSS.bind("mousedown, touchstart",function(a){c=!0;e||(e=a.pageX);g||(g=a.pageY);return!1})));f(document.bind("mousemove, touchmove",function(b){var d;if(c)return d=b.pageX-e,b=b.pageY-g,a.transform({translate:[d,b]},0).trigger("drag",
{dragObject:a}),!1})).bind("mouseup, touchend",function(){var e;if(c)return c=!1,e=b.position()[0],f(document.elementFromPoint(e.left,e.top-1).trigger("drop",{dropObject:a}))});return a.addClass("draggable").css({position:"relative","padding-top":a.css("padding-top").map(Number.AtLeast(parseInt(d.handleCSS.height,10))).px().first()}.append(b))});ProgressBar(selector,opts)(function(){var a,b,c,e,g;b=Object.Extend({change:Function.Empty,backgroundColor:"#fff",barColor:"rgba(0,128,0,0.5)",textColor:"white",
reset:!1},b);a=f(selector).addClass("progress-bar");g=0;b.reset&&(c=a.css("background").first(),e=a.css("color").first());return a.zap("updateProgress",function(d){for(;d>1;)d=d/100;g=d;d===1&&b.reset?a.css("background",c).css("color",e):a.css({background:"-webkit-gradient(linear, 0 0, "+parseInt(d*100)+"% 0, color-stop(0, "+b.barColor+"), color-stop(0.98, "+b.barColor+"), color-stop(1.0, "+b.backgroundColor+"))",color:b.textColor});if(Object.IsFunc(b.change))return b.change(g)})});Accordion(selector,
opts)(function(){var a,b,c;c=Object.Extend({exclusive:!1,sticky:!1},c);b=f(selector).addClass("accordion");a=function(a){var g,d,h,a=f(a).children().first().filter("*");if(2!==a.len())throw Exception("accordion row requires 2 elements, not "+a.len());h=a.eq(0).addClass("title");g=a.eq(1).addClass("body").hide();d=!1;return h.click(function(){c.exclusive&&b.find(".body").hide();if(d){if(c.sticky)return g.show().addClass("visible"),h.addClass("selected").trigger("select"),d=!0;g.hide().removeClass("visible");
h.removeClass("selected").trigger("deselect");return d=!1}g.show().addClass("visible");h.addClass("selected").trigger("select");return d=!0})};b.bind("DOMNodeInserted",function(c){var g;g=b.children().first().filter("*");c=f(c.target).parents().first();return a(c.intersect(g))});b.children().first().filter("*").map(a);return b});ViewStack(selector,opts)(function(){var a,b,c,e;b=f(selector).css({position:"relative",top:"0px",left:"0px"}.hide().map(f));a=0;b[a].show();b.next=function(){b[a].hide();
a=++a%nn;return b[a].show()};b.activate=function(c){b[a].hide();a=c;return b[c].show()};c=0;for(e=b.len();0<=e?c<e:c>e;0<=e?c++:c--)b[c].zap("_viewIndex",c.zap("activate",function(){return b.activate(this._viewIndex)}));return b});Tabs(selector,views)(function(){var a,b,c,e;c=f(selector);e=f(e).viewStack();b=c.len();for(a=0;0<=b?a<=b:a>=b;0<=b?a++:a--)c._tabIndex=a;f(c[0]).addClass("active");return c.click(function(){c.removeClass("active");e.activate(this._tabIndex);return f(this).addClass("active")})});
return{name:"UI",$:{UI:{Draggable:Draggable,ProgressBar:ProgressBar,ViewStack:ViewStack,Tabs:Tabs,Accordion:Accordion}},dialog:function(a){return Dialog(this,a)},progressBar:function(a){return ProgressBar(this,a)},viewStack:function(a){return ViewStack(this,a)},tabs:function(a){return Tabs(this,a)},accordion:function(a){return Accordion(this,a)},draggable:function(a){return Draggable(this,a)}}})})(Bling);
