<!DOCTYPE html>  <html> <head>   <title>bling.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               bling.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Philoshopy</h2>

<ol>
<li>Always work on <em>sets</em> of stuff, scalars are annoying.
If you always write code to handle sets, you usually handle the scalar case for free.</li>
<li>Don't alter global <em>prototypes</em>; global <em>types</em> are OK.</li>
<li>Have fun and learn; about the DOM, about jQuery, about JavaScript and CoffeeScript.</li>
<li>Have the courage to refactor; learning requires some chaos.</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Author</h2>

<p>Jesse Dailey <a href="&#109;&#x61;&#x69;&#x6C;&#x74;&#x6F;:j&#x65;&#x73;&#x73;&#x65;&#x2E;&#x64;&#x61;&#105;&#108;&#x65;&#x79;&#64;&#103;&#109;&#97;&#105;&#108;&#x2E;&#99;o&#109;">j&#x65;&#x73;&#x73;&#x65;&#x2E;&#x64;&#x61;&#105;&#108;&#x65;&#x79;&#64;&#103;&#109;&#97;&#105;&#108;&#x2E;&#99;o&#109;</a>, Copyright: 2011, License: MIT.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>Warming Up</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>We need a few things to get started:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>A safe logger to use for <code>$.log()</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">log = </span><span class="nf">(a...) -&gt;</span>
	<span class="k">try</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">console</span><span class="p">,</span> <span class="nx">a</span>
	<span class="nx">alert</span> <span class="nx">a</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>A safe fill-in for <code>Object.keys</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span> <span class="o">?=</span> <span class="nf">(o) -&gt;</span> <span class="p">(</span><span class="nx">k</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">o</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>A way to assign values from <code>b</code> to <code>a</code>, with optional whitelist:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">extend = </span><span class="nf">(a, b) -&gt;</span>
	<span class="k">return</span> <span class="nx">a</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">b</span>
	<span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
		<span class="nv">v = </span><span class="nx">b</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
		<span class="k">if</span> <span class="nx">v</span><span class="o">?</span> <span class="k">then</span> <span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
	<span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>A wrapper for Object.defineProperty that changes the defaults</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">defineProperty = </span><span class="nf">(o,name,opts) -&gt;</span>
	<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span> <span class="nx">o</span><span class="p">,</span><span class="nx">name</span><span class="p">,</span> <span class="nx">extend</span><span class="p">({</span>
		<span class="nv">configurable: </span><span class="kc">true</span>
		<span class="nv">enumerable: </span><span class="kc">true</span>
	<span class="p">},</span> <span class="nx">opts</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>Type System</h2>

<p>The type system is built around a <em>type classifier</em>. Initially, this
will only know how to match types (and the order to check them in).
Later, the type-instance that results from classification will be
extended to provide more operations, e.g. hashing.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Before we build a full classifier, we need a few things.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>isType(T, obj)</code> is a simple boolean test to see if any
object <code>o</code> is of type <code>T</code>; respecting prototype chains,
constructors, and anything else we can think of that matters.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isType = </span><span class="nf">(T, o) -&gt;</span>
	<span class="k">if</span> <span class="o">not</span> <span class="nx">o</span><span class="o">?</span> <span class="k">then</span> <span class="nx">T</span> <span class="k">in</span> <span class="p">[</span><span class="nx">o</span><span class="p">,</span><span class="s">&quot;null&quot;</span><span class="p">,</span><span class="s">&quot;undefined&quot;</span><span class="p">]</span>
	<span class="k">else</span> <span class="nx">o</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">is</span> <span class="nx">T</span> <span class="o">or</span>
		<span class="nx">o</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="nx">T</span> <span class="o">or</span>
		<span class="nb">Object</span><span class="o">::</span><span class="nx">toString</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;[object </span><span class="si">#{</span><span class="nx">T</span><span class="si">}</span><span class="s">]&quot;</span> <span class="o">or</span>
		<span class="nx">isType</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">__proto__</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><code>inherit(parent, child)</code> is similar to extend, except it works by
inserting the parent as the prototype of the child <em>instance</em>. This is unlike
coffee's <code>class X extends Y</code>, because it expects the target <code>child</code>
to be an <em>instance</em>, and the <code>parent</code> can either be an <em>instance</em> or a
<strong>constructor</strong>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">inherit = </span><span class="nf">(parent, obj) -&gt;</span>
	<span class="k">if</span> <span class="k">typeof</span> <span class="nx">parent</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
		<span class="nv">obj.constructor = </span><span class="nx">parent</span>
		<span class="nv">parent = parent::</span>
	<span class="nv">obj.__proto__ = </span><span class="nx">parent</span>
	<span class="nx">obj</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Now, let's begin to build the classifier for <code>$.type(obj)</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">type = </span><span class="p">(</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Internally, maintain a registry of known types.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">cache = </span><span class="p">{}</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Each type in the registry is an instance that inherits from a
base object.  Later, when we want to do more than <code>match</code> with
each type, we will put default implementations on this base.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">base =</span>
		<span class="nv">name: </span><span class="s">&#39;unknown&#39;</span>
		<span class="nv">match: </span><span class="nf">(o) -&gt;</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>When classifying an object, this array of names will control
the order of the calls to <code>match</code> (and thus, the precedence).</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">order = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>When adding a new type to the regisry:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">register = </span><span class="nf">(name, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <ul>
<li>Put the type check in order (if it isn't already).</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">order</span><span class="p">.</span><span class="nx">unshift</span> <span class="nx">name</span> <span class="k">if</span> <span class="o">not</span> <span class="p">(</span><span class="nx">name</span> <span class="k">of</span> <span class="nx">cache</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <ul>
<li>inherit from the base type and store in the cache.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">cache</span><span class="p">[</span><span class="nv">data.name = </span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="nx">base</span> <span class="o">isnt</span> <span class="nx">data</span><span class="p">)</span> <span class="k">then</span> <span class="p">(</span><span class="nx">inherit</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="k">else</span> <span class="nx">data</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Later, plugins can <code>extend</code> previously registered types with new
functionality.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">_extend = </span><span class="nf">(name, data) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>The <code>name</code> should be of a registered type (a key into the cache)</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>But, if you attempt to extend a type that was not registered yet,
it will be automatically registered.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">?=</span> <span class="nx">register</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="p">{})</span>
			<span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">extend</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">data</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>But you can also extend a bunch of types at once, by passing a
2-level deep object, where the first level of keys are type
names and the second level of keys are objects full of
extensions.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">name</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
			<span class="p">(</span><span class="nx">_extend</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">name</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">name</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>To classify an object, simply check every match in order.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">lookup = </span><span class="nf">(obj) -&gt;</span>
		<span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">order</span>
			<span class="k">if</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">match</span><span class="p">.</span><span class="nx">call</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">obj</span>
				<span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Now, register all the built-in types. These checks are
executed in <em>reverse order</em>, so the first listed here, <code>"unknown"</code>,
is always checked last.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">register</span> <span class="s">&quot;unknown&quot;</span><span class="p">,</span>   <span class="nx">base</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>This implies that the 'simplest' checks should be registered
first, and conceptually more specialized checks would get added
as time goes on (so specialized type matches are preferred).</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">register</span> <span class="s">&quot;object&quot;</span><span class="p">,</span>    <span class="nv">match: </span><span class="o">-&gt;</span> <span class="k">typeof</span> <span class="nx">@</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
	<span class="nx">register</span> <span class="s">&quot;error&quot;</span><span class="p">,</span>     <span class="nv">match: </span><span class="o">-&gt;</span> <span class="nx">isType</span> <span class="s">&#39;Error&#39;</span><span class="p">,</span> <span class="nx">@</span>
	<span class="nx">register</span> <span class="s">&quot;regexp&quot;</span><span class="p">,</span>    <span class="nv">match: </span><span class="o">-&gt;</span> <span class="nx">isType</span> <span class="s">&#39;RegExp&#39;</span><span class="p">,</span> <span class="nx">@</span>
	<span class="nx">register</span> <span class="s">&quot;string&quot;</span><span class="p">,</span>    <span class="nv">match: </span><span class="o">-&gt;</span> <span class="k">typeof</span> <span class="nx">@</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> <span class="o">or</span> <span class="nx">isType</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">@</span>
	<span class="nx">register</span> <span class="s">&quot;number&quot;</span><span class="p">,</span>    <span class="nv">match: </span><span class="o">-&gt;</span> <span class="nx">isType</span> <span class="nb">Number</span><span class="p">,</span> <span class="nx">@</span>
	<span class="nx">register</span> <span class="s">&quot;bool&quot;</span><span class="p">,</span>      <span class="nv">match: </span><span class="o">-&gt;</span> <span class="k">typeof</span> <span class="nx">@</span> <span class="o">is</span> <span class="s">&quot;boolean&quot;</span> <span class="o">or</span> <span class="nb">String</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;true&quot;</span><span class="p">,</span><span class="s">&quot;false&quot;</span><span class="p">]</span>
	<span class="nx">register</span> <span class="s">&quot;array&quot;</span><span class="p">,</span>     <span class="nv">match: </span><span class="o">-&gt;</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="o">?</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span> <span class="o">or</span> <span class="nx">isType</span> <span class="nb">Array</span><span class="p">,</span> <span class="nx">@</span>
	<span class="nx">register</span> <span class="s">&quot;function&quot;</span><span class="p">,</span>  <span class="nv">match: </span><span class="o">-&gt;</span> <span class="k">typeof</span> <span class="nx">@</span> <span class="o">is</span> <span class="s">&quot;function&quot;</span>
	<span class="nx">register</span> <span class="s">&quot;global&quot;</span><span class="p">,</span>    <span class="nv">match: </span><span class="o">-&gt;</span> <span class="k">typeof</span> <span class="nx">@</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span> <span class="o">and</span> <span class="s">&#39;setInterval&#39;</span> <span class="k">of</span> <span class="nx">@</span> <span class="c1"># Use the same crude method as jQuery for detecting the window, not very safe but it does work in Node and the browser</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>These checks for null and undefined are small exceptions to the
simple-first idea, since they are precise and getting them out
of the way early lets the above tests omit a safety check.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">register</span> <span class="s">&quot;undefined&quot;</span><span class="p">,</span> <span class="nv">match: </span><span class="nf">(x) -&gt;</span> <span class="nx">x</span> <span class="o">is</span> <span class="kc">undefined</span>
	<span class="nx">register</span> <span class="s">&quot;null&quot;</span><span class="p">,</span>      <span class="nv">match: </span><span class="nf">(x) -&gt;</span> <span class="nx">x</span> <span class="o">is</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Now, we finally have all the pieces to make the real classifier.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">return</span> <span class="nx">extend</span> <span class="p">(</span><span class="nf">(o) -&gt;</span> <span class="nx">lookup</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">name</span><span class="p">),</span>
		<span class="nv">register: </span><span class="nx">register</span>
		<span class="nv">lookup: </span><span class="nx">lookup</span>
		<span class="nv">extend: </span><span class="nx">_extend</span>
		<span class="o">is:</span> <span class="nf">(t, o) -&gt;</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">match</span><span class="p">.</span><span class="nx">call</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">o</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Example: Calling $.type directly will get you the simple name of the
best match.</p>

<blockquote>
  <p><code>type([]) == "array"</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>If you want to know everything, you can use lookup
directly.</p>

<blockquote>
  <p><code>type.lookup([]).name == "array"</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Later, once other systems have extended the base type, the
type-instance returned from type.lookup will do more.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">)()</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h1>The Bling Constructor</h1>

<p>This is using coffee's class syntax, but only as a hack really.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>First, we want the Bling function to have a name so that
<code>$().constructor.name == "Bling"</code>, for sanity, and for easily
detecting a mixed-jQuery environment (we do try to play nice).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Second, the <code>new</code> operator is not good.  What it does normally is
make a shallow copy of the prototype to use as context and return
value for the constructor.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>In that simple statement is basically the core of the JS type
system, and even in that one sentence there are three problems:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <ol>
<li><em>The copy is shallow</em>; creating partially-shared state between
instances.</li>
<li><em>There is a copy at all</em>; it's nice to avoid copying in critical
sections whenever possible.</li>
<li><em>It replaces the return value of the constructor</em>; reducing
flexibility in implementations.</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>So, the Bling constructor should not be called as <code>new Bling</code>,
and as a bonus our assignment to a symbol (<code>$</code>) remains simple.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Bling</span>
	</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>We compute this only once, privately, so we dont have to check
during every construction.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">default_context = </span><span class="k">if</span> <span class="nb">document</span><span class="o">?</span> <span class="k">then</span> <span class="nb">document</span> <span class="k">else</span> <span class="p">{}</span>

	<span class="nv">constructor: </span><span class="nf">(selector, context = default_context) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Since we have this nice Type system, our constructor is succinct:
1. Classify the type.
2. Convert the selector to a set using the type-instance (which
in the case of anything array-like is a no-op).
3. Use inherit to <em>hijack</em> the set's prototype in-place.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">return</span> <span class="nx">inherit</span> <span class="nx">Bling</span><span class="p">,</span> <span class="nx">extend</span> <span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">array</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">),</span>
			<span class="nv">selector: </span><span class="nx">selector</span>
			<span class="nv">context: </span><span class="nx">context</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <h2>$.plugin( [ opts ], func )</h2>

<p>Each plugin is a function that returns an object full of stuff to
extend the Bling prototype with.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Example: the simplest possible plugin.</p>

<blockquote>
  <p>$.plugin -> echo: -> @</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>After this, <code>$(...).echo()</code> will work.  Also, this will
create a default 'root' version: <code>$.echo</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>You can explicitly define root-level values by nesting things
under a <code>$</code> key:</p>

<blockquote>
  <p>$.plugin () -> $: hello: -> "Hello!"</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>This will create <code>$.hello</code>, but not <code>$().hello</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="vi">@plugin: </span><span class="nf">(opts, constructor) -&gt;</span>
		<span class="k">if</span> <span class="o">not</span> <span class="nx">constructor</span><span class="o">?</span>
			<span class="nv">constructor = </span><span class="nx">opts</span><span class="p">;</span> <span class="nv">opts = </span><span class="p">{}</span>
		
		<span class="k">if</span> <span class="s">&quot;depends&quot;</span> <span class="k">of</span> <span class="nx">opts</span>
			<span class="k">return</span> <span class="nx">@depends</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">depends</span><span class="p">,</span> <span class="o">=&gt;</span>
				<span class="nx">@plugin</span> <span class="p">{</span> <span class="nv">provides: </span><span class="nx">opts</span><span class="p">.</span><span class="nx">provides</span> <span class="p">},</span> <span class="nx">constructor</span>
		<span class="k">try</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>We call the plugin constructor and expect that it returns an
object full of things to attach to either Bling or it's prototype.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nv">plugin = </span><span class="nx">constructor</span><span class="o">?</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span><span class="nx">@</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>If the plugin has a <code>$</code> key, extend the root.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">extend</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">plugin</span><span class="o">?</span><span class="p">.</span><span class="nx">$</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Clean off keys we no longer care about: <code>$</code> and <code>name</code>. (An
older version of plugin() used to require names,
but we ignore them now in favor of depends/provides.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="p">[</span><span class="s">&#39;$&#39;</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">].</span><span class="nx">forEach</span> <span class="nf">(k) -&gt;</span> <span class="k">delete</span> <span class="nx">plugin</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Now put everything else on the Bling prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">extend</span> <span class="nx">@</span><span class="o">::</span><span class="p">,</span> <span class="nx">plugin</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Finally, add root-level wrappers for anything that doesn't
have one already.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="p">(</span> <span class="nx">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">or=</span> <span class="p">(</span><span class="nx">a</span><span class="p">...)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">@</span><span class="o">::</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">apply</span> <span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">...])</span> <span class="p">)</span> <span class="k">for</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">plugin</span>
				<span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">provides</span><span class="o">?</span> <span class="k">then</span> <span class="nx">@provide</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">provides</span>
		<span class="k">catch</span> <span class="nx">error</span>
			<span class="nx">log</span> <span class="s">&quot;failed to load plugin: </span><span class="si">#{</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s"> &#39;</span><span class="si">#{</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="s">&#39;&quot;</span>
			<span class="k">throw</span> <span class="nx">error</span>
		<span class="nx">@</span>
	</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <h2>Code dependencies</h2>

<p>$.depends, $.provide and $.provides, allow for representing
dependencies between any functions. Plugins can and should use this
to ensure their correct loading order.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">qu = </span><span class="p">[]</span>
	<span class="nv">done = </span><span class="p">{}</span>
	<span class="nv">filt = </span><span class="nf">(n) -&gt;</span>
		<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">n</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> <span class="k">then</span> <span class="nx">n</span><span class="p">.</span><span class="nx">split</span> <span class="s">&quot;,&quot;</span> <span class="k">else</span> <span class="nx">n</span><span class="p">)</span>
		<span class="p">.</span><span class="nx">filter</span> <span class="nf">(x) -&gt;</span> <span class="o">not</span> <span class="p">(</span><span class="nx">x</span> <span class="k">of</span> <span class="nx">done</span><span class="p">)</span>

	<span class="vi">@depends: </span><span class="nf">(needs, f) -&gt;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">needs = </span><span class="nx">filt</span><span class="p">(</span><span class="nx">needs</span><span class="p">)).</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nx">f</span><span class="p">()</span>
		<span class="k">else</span> <span class="nx">qu</span><span class="p">.</span><span class="nx">push</span> <span class="nf">(need) -&gt;</span>
			<span class="p">((</span><span class="nx">needs</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span> <span class="nv">i = </span><span class="nx">needs</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">need</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">and</span>
			<span class="nx">needs</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="o">and</span>
			<span class="nx">f</span>
		<span class="nx">f</span>

	<span class="vi">@provide: </span><span class="nf">(needs) -&gt;</span>
		<span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;provide(</span><span class="si">#{</span><span class="nx">needs</span><span class="si">}</span><span class="s">)&quot;</span>
		<span class="k">for</span> <span class="nx">need</span> <span class="k">in</span> <span class="nx">filt</span><span class="p">(</span><span class="nx">needs</span><span class="p">)</span>
			<span class="nx">done</span><span class="p">[</span><span class="nx">need</span><span class="p">]</span> <span class="o">=</span> <span class="nv">i = </span><span class="mi">0</span>
			<span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">qu</span><span class="p">.</span><span class="nx">length</span>
				<span class="k">if</span> <span class="p">(</span><span class="nv">f = </span><span class="nx">qu</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="nx">need</span><span class="p">))</span> <span class="k">then</span> <span class="p">(</span><span class="nx">qu</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">i</span><span class="p">,</span><span class="mi">1</span><span class="p">;</span> <span class="nx">f</span><span class="p">())</span>
				<span class="k">else</span> <span class="nx">i</span><span class="o">++</span>
		<span class="kc">null</span>

	<span class="vi">@provides: </span><span class="nf">(needs, f) -&gt;</span> <span class="nf">(a...) -&gt;</span> <span class="nx">r</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="nx">a</span><span class="p">...);</span> <span class="nx">Bling</span><span class="p">.</span><span class="nx">provide</span><span class="p">(</span><span class="nx">needs</span><span class="p">);</span> <span class="nx">r</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <h3>Registering the "bling" type.</h3>

<p>First, we give the basic types the ability to turn into something
array-like, for use by the constructor.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">type</span><span class="p">.</span><span class="nx">extend</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>If we don't know any better way, we just stick the
thing inside a real array.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">unknown: </span>  <span class="p">{</span> <span class="nv">array: </span><span class="nf">(o) -&gt;</span> <span class="p">[</span><span class="nx">o</span><span class="p">]</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>But where we do know better, we can provide more meaningful
conversions. Later, in the DOM section, we will extend
this further to know how to convert "html", "node", etc.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Null and undefined values convert to an empty array.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kc">null</span><span class="o">:</span>      <span class="p">{</span> <span class="nv">array: </span><span class="nf">(o) -&gt;</span> <span class="p">[]</span> <span class="p">}</span>
		<span class="kc">undefined</span><span class="o">:</span> <span class="p">{</span> <span class="nv">array: </span><span class="nf">(o) -&gt;</span> <span class="p">[]</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Arrays just convert to themselves.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">array: </span>    <span class="p">{</span> <span class="nv">array: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Numbers create a new array of that capacity.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">number: </span>   <span class="p">{</span> <span class="nv">array: </span><span class="nf">(o) -&gt;</span> <span class="nx">Bling</span><span class="p">.</span><span class="nx">extend</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">o</span><span class="p">),</span> <span class="nv">length: </span><span class="mi">0</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Now, we register "bling", and all the things we know how to do
with it:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">type</span><span class="p">.</span><span class="nx">register</span> <span class="s">&quot;bling&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Add the type test so: <code>$.type($()) == "bling"</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">match: </span> <span class="nf">(o) -&gt;</span> <span class="nx">o</span> <span class="o">and</span> <span class="nx">isType</span> <span class="nx">Bling</span><span class="p">,</span> <span class="nx">o</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Blings extend arrays so they convert to themselves.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">array: </span> <span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toArray</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Their hash is just the sum of member hashes.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">hash: </span>  <span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">Bling</span><span class="p">.</span><span class="nx">hash</span><span class="p">).</span><span class="nx">sum</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>They have a very literal string representation.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">string: </span><span class="nf">(o) -&gt;</span> <span class="nx">Bling</span><span class="p">.</span><span class="nx">symbol</span> <span class="o">+</span> <span class="s">&quot;([&quot;</span> <span class="o">+</span> <span class="nx">o</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">Bling</span><span class="p">.</span><span class="nx">toString</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span><span class="o">+</span> <span class="s">&quot;])&quot;</span>

<span class="nv">Bling.prototype = </span><span class="p">[]</span> <span class="c1"># similar to `class Bling extends (new Array)`,</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>if such a thing were supported by the syntax directly.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <h1>Plugins</h1>

<p>Now that we have a way to load plugins and express dependencies
between them, all future code will come in a plugin.</p>

<p>For the rest of this file, set up a namespace that protects <code>$</code>,
so we can safely use short-hand in all of our plugins.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="nf">($) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Grab a safe (browser vs. nodejs) reference to the global object</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">glob = </span><span class="k">if</span> <span class="nb">window</span><span class="o">?</span> <span class="k">then</span> <span class="nb">window</span> <span class="k">else</span> <span class="nx">global</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <h3>Types plugin</h3>

<p>Exposes the type system publicly.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;type&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">$:</span>
			<span class="nv">inherit: </span><span class="nx">inherit</span>
			<span class="nv">extend: </span><span class="nx">extend</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p><code>$.isType(Array, [])</code> is lower level than the others,
doing simple comparison between constructors.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">isType: </span><span class="nx">isType</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p><code>$.type([])</code> equals <code>"array"</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">type: </span><span class="nx">type</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p><code>$.is("function", -&gt;)</code> equals true/false.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="o">is:</span> <span class="nx">type</span><span class="p">.</span><span class="o">is</span>
			<span class="nv">isSimple: </span><span class="nf">(o) -&gt;</span> <span class="nx">type</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="s">&quot;number&quot;</span><span class="p">,</span> <span class="s">&quot;bool&quot;</span><span class="p">]</span>
			<span class="nv">isEmpty: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">]</span>
	</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <h2>Symbol Plugin</h2>

<p>Symbol adds a dynamic property: Bling.symbol, which contains the
current global binding where you can find Bling (default: <code>$</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>When you assign a symbol, it carefully tracks the previous values
and restores them later if you change.  This is all so we can
play nice with jQuery and underscore.  For instance, if you load
jQuery, then load Bling, you set <code>Bling.symbol = "_"</code> and <code>$</code> will
go back to pointing at jQuery, and you can do <code>_(...)</code> to create a
Bling set.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>There is no restriction on the length or nature of the symbol
except that it must be a valid JavaScript identifier:</p>

<blockquote>
  <p><code>Bling.symbol = 'foo'; $.is("bling", foo()) == true</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;symbol&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">symbol = </span><span class="kc">null</span>
		<span class="nv">cache = </span><span class="p">{}</span>
		<span class="nv">glob.Bling = </span><span class="nx">$</span>
		<span class="nx">defineProperty</span> <span class="nx">$</span><span class="p">,</span> <span class="s">&quot;symbol&quot;</span><span class="p">,</span>
			<span class="nv">set: </span><span class="nf">(v) -&gt;</span>
				<span class="nx">glob</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">symbol</span><span class="p">]</span>
				<span class="nx">cache</span><span class="p">[</span><span class="nv">symbol = </span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">glob</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span>
				<span class="nx">glob</span><span class="p">[</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Bling</span>
			<span class="nv">get: </span><span class="o">-&gt;</span> <span class="nx">symbol</span>
		<span class="k">return</span> <span class="nv">$: symbol: </span><span class="s">&quot;$&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <h2>Compat Plugin</h2>

<p>This keeps getting smaller over time, but we just try to bundle
'shim-like' stuff here; adding or replacing basic ES5 stuff that
we need to use.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Make sure we have String functions: <code>trimLeft</code>, and <code>split</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nb">String</span><span class="o">::</span><span class="nx">trimLeft</span> <span class="o">or=</span> <span class="o">-&gt;</span> <span class="nx">@replace</span><span class="p">(</span><span class="sr">/^\s+/</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
		<span class="nb">String</span><span class="o">::</span><span class="nx">split</span> <span class="o">or=</span> <span class="nf">(sep) -&gt;</span>
			<span class="nv">a = </span><span class="p">[];</span> <span class="nv">i = </span><span class="mi">0</span>
			<span class="k">while</span> <span class="p">(</span><span class="nv">j = </span><span class="nx">@indexOf</span> <span class="nx">sep</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
				<span class="nx">a</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@substring</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">)</span>
				<span class="nv">i = </span><span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span>
			<span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Find the last index of character <code>c</code> in the string <code>s</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nb">String</span><span class="o">::</span><span class="nx">lastIndexOf</span> <span class="o">or=</span> <span class="nf">(s, c, i = -1) -&gt;</span>
			<span class="nv">j = </span><span class="o">-</span><span class="mi">1</span>
			<span class="nv">j = </span><span class="nx">i</span> <span class="k">while</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
			<span class="nx">j</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Make sure we have Array functions: <code>join</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nb">Array</span><span class="o">::</span><span class="nx">join</span> <span class="o">or=</span> <span class="nf">(sep = &#39;&#39;) -&gt;</span>
			<span class="nv">n = </span><span class="nx">@length</span>
			<span class="k">return</span> <span class="s">&quot;&quot;</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">is</span> <span class="mi">0</span>
			<span class="nv">s = </span><span class="nx">@</span><span class="p">[</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">while</span> <span class="o">--</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span>
				<span class="nv">s = </span><span class="nx">@</span><span class="p">[</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">sep</span> <span class="o">+</span> <span class="nx">s</span>
			<span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Add a handy nuke function to events: <code>preventAll</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="nx">Event</span><span class="o">?</span>
			<span class="nv">Event::preventAll = </span><span class="nf">() -&gt;</span>
				<span class="nx">@preventDefault</span><span class="p">()</span>
				<span class="nx">@stopPropagation</span><span class="p">()</span>
				<span class="vi">@cancelBubble = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Make sure we have Element functions: <code>matchesSelector</code>, and
<code>cloneNode</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="nx">Element</span><span class="o">?</span>
			<span class="nv">Element::matchesSelector = </span><span class="nx">Element</span><span class="o">::</span><span class="nx">webkitMatchesSelector</span> <span class="o">or</span>
				<span class="nx">Element</span><span class="o">::</span><span class="nx">mozMatchesSelector</span> <span class="o">or</span>
				<span class="nx">Element</span><span class="o">::</span><span class="nx">matchesSelector</span>

			<span class="k">if</span> <span class="nx">Element</span><span class="o">::</span><span class="nx">cloneNode</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="c1"># if cloneNode does not take a &#39;deep&#39; argument, add support</span>
				<span class="nv">oldClone = </span><span class="nx">Element</span><span class="o">::</span><span class="nx">cloneNode</span>
				<span class="nv">Element::cloneNode = </span><span class="nf">(deep = false) -&gt;</span>
					<span class="nv">n = </span><span class="nx">oldClone</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
					<span class="k">if</span> <span class="nx">deep</span>
						<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@childNodes</span>
							<span class="nx">n</span><span class="p">.</span><span class="nx">appendChild</span> <span class="nx">i</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span>
					<span class="k">return</span> <span class="nx">n</span>

		<span class="k">return</span> <span class="p">{</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <h2>Delay Plugin</h2>

<p><strong>Q</strong>: Since JS uses a single event loop, what happens if multiple
setTimeout/Intervals are scheduled at a time when the event loop is busy?</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p><strong>A</strong>: All the due functions are called in no particular order; even if
they were clearly scheduled in a sequence like:
<code>setTimeout(f,1); setTimeout(g,2)</code>.  These will execute in
random order when using setTimeout directly.  This isn't
necessarily about timer (in)accuracy, it's about how it
stores and dequeues handlers.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">depends: </span><span class="s">&quot;function&quot;</span>
		<span class="nv">provides: </span><span class="s">&quot;delay&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">$:</span>
			<span class="nv">delay: </span><span class="p">(</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>timeoutQueue is a private array that controls the order.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">timeoutQueue = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="p">[],</span> <span class="p">(</span><span class="o">-&gt;</span>
					<span class="nv">next = </span><span class="nf">(a) -&gt;</span> <span class="o">-&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">shift</span><span class="p">()()</span> <span class="k">if</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span>
					<span class="nv">add: </span><span class="nf">(f, n) -&gt;</span>
						<span class="nv">f.order = </span><span class="nx">n</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">now</span>
						<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span>
							<span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="nx">@length</span> <span class="o">or</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">order</span> <span class="o">&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">order</span>
								<span class="nx">@splice</span> <span class="nx">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">f</span>
								<span class="k">break</span>
						<span class="nx">setTimeout</span> <span class="nx">next</span><span class="p">(</span><span class="nx">@</span><span class="p">),</span> <span class="nx">n</span>
						<span class="nx">@</span>
					<span class="nv">cancel: </span><span class="nf">(f) -&gt;</span>
						<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span>
							<span class="k">if</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">f</span>
								<span class="nx">@splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span>
								<span class="k">break</span>
						<span class="nx">@</span>
				<span class="p">)()</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Note that this reverses the order of <em>n</em> and <em>f</em>
intentionally.  Throughout this library, the convention is
to put the simple things first, to improve code flow:</p>

<blockquote>
  <p><code>$.delay 5, () -&gt;</code> is better than <code>$.delay (() -&gt; ), 5</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nf">(n, f) -&gt;</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nx">f</span><span class="p">)</span> <span class="k">then</span> <span class="nx">timeoutQueue</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
					<span class="nv">cancel: </span><span class="o">-&gt;</span> <span class="nx">timeoutQueue</span><span class="p">.</span><span class="nx">cancel</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
			<span class="p">)()</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Continue with <em>f</em> after <em>n</em> milliseconds.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">delay: </span><span class="nf">(n, f, c=@) -&gt;</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">delay</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <h2>Core Plugin</h2>

<p>The functional basis for all other modules.  Provides all the
basic stuff that you are familiar with from jQuery: 'each', 'map',
etc.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;core&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>

		<span class="nx">defineProperty</span> <span class="nx">$</span><span class="p">,</span> <span class="s">&quot;now&quot;</span><span class="p">,</span>
			<span class="nv">get: </span><span class="o">-&gt;</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Negative indices should work the same everywhere.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">index = </span><span class="nf">(i, o) -&gt;</span>
			<span class="nx">i</span> <span class="o">+=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span> <span class="k">while</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">0</span>
			<span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span>
				<span class="nv">log: </span><span class="nx">log</span>
				<span class="nv">assert: </span><span class="nf">(c, m=&quot;&quot;) -&gt;</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">c</span> <span class="k">then</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;assertion failed: </span><span class="si">#{</span><span class="nx">m</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
				<span class="nv">coalesce: </span><span class="nf">(a...) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">coalesce</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Get a new set containing only the i-th element of <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">eq: </span><span class="nf">(i) -&gt;</span> <span class="nx">$</span><span class="p">([</span><span class="nx">@</span><span class="p">[</span><span class="nx">index</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">@</span><span class="p">]])</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Call a function on every item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">each: </span><span class="nf">(f) -&gt;</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">t</span><span class="p">)</span> <span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">@</span><span class="p">);</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Get a new set with the results of calling a function of every
item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">map: </span><span class="nf">(f) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span><span class="nx">t</span><span class="p">)</span> <span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">@</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Reduce <em>this</em> to a single value, accumulating in <em>a</em>.
Example: <code>(a,x) -&gt; a+x</code> == <code>(a) -&gt; a+@</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">reduce: </span><span class="nf">(f, a) -&gt;</span>
				<span class="nv">t = </span><span class="nx">@</span>
				<span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="o">?</span>
					<span class="nv">a = </span><span class="nx">@</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
					<span class="nv">t = </span><span class="nx">@skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
				<span class="p">(</span><span class="nv">a = </span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">t</span>
				<span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>Get a new set with every item from <em>this</em> and from <em>other</em>. <code>strict</code> refers to whether
to use == or === for comparison.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">union: </span><span class="nf">(other, strict = true) -&gt;</span>
				<span class="nv">ret = </span><span class="nx">$</span><span class="p">()</span>
				<span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">strict</span><span class="p">)</span>
				<span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">other</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">ret</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">strict</span><span class="p">)</span>
				<span class="nx">ret</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>Get a new set without duplicates.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">distinct: </span><span class="nf">(strict = true) -&gt;</span> <span class="nx">@union</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">strict</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Get a new set whose items are all in <em>this</em> and _other.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">intersect: </span><span class="nf">(other) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">x</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">other</span><span class="p">)</span> <span class="c1"># another very beatiful expression</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>True if item is in <em>this</em> set.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">contains: </span><span class="nf">(item, strict = true) -&gt;</span> <span class="p">((</span><span class="nx">strict</span> <span class="o">and</span> <span class="nx">t</span> <span class="o">is</span> <span class="nx">item</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="o">not</span> <span class="nx">strict</span> <span class="o">and</span> <span class="nx">t</span> <span class="o">==</span> <span class="nx">item</span><span class="p">)</span> <span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">@</span><span class="p">).</span><span class="nx">reduce</span> <span class="p">(</span><span class="nf">(a,x) -&gt;</span> <span class="nx">a</span> <span class="o">or</span> <span class="nx">x</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>Get an integer count of items in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">count: </span><span class="nf">(item, strict = true) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="p">(</span><span class="nx">item</span> <span class="o">is</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">strict</span> <span class="o">and</span> <span class="nx">t</span> <span class="o">is</span> <span class="nx">item</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="o">not</span> <span class="nx">strict</span> <span class="o">and</span> <span class="nx">t</span> <span class="o">==</span> <span class="nx">item</span><span class="p">)).</span><span class="nx">sum</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>Get the first non-null item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">coalesce: </span><span class="o">-&gt;</span>
				<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;array&quot;</span><span class="p">,</span><span class="s">&quot;bling&quot;</span><span class="p">]</span> <span class="k">then</span> <span class="nv">i = </span><span class="nx">$</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">coalesce</span><span class="p">()</span>
					<span class="k">if</span> <span class="nx">i</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="nx">i</span>
				<span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>Swap item i with item j, in-place.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">swap: </span><span class="nf">(i,j) -&gt;</span>
				<span class="nv">i = </span><span class="nx">index</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">@</span>
				<span class="nv">j = </span><span class="nx">index</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">@</span>
				<span class="k">if</span> <span class="nx">i</span> <span class="o">isnt</span> <span class="nx">j</span>
					<span class="p">[</span><span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span><span class="nx">@</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">@</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span><span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span>
				<span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Randomly shuffle every item, in-place.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">shuffle: </span><span class="o">-&gt;</span>
				<span class="nv">i = </span><span class="nx">@length</span><span class="o">-</span><span class="mi">1</span>
				<span class="k">while</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span>
					<span class="nx">@swap</span> <span class="o">--</span><span class="nx">i</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">i</span><span class="p">)</span>
				<span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Get a new set of properties from every item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">select: </span><span class="p">(</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>A helper that will read property <code>p</code> from some object later.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">getter = </span><span class="nf">(prop) -&gt;</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nv">v = </span><span class="nx">@</span><span class="p">[</span><span class="nx">prop</span><span class="p">])</span> <span class="k">then</span> <span class="nx">$</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span> <span class="k">else</span> <span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>Recursively split <code>p</code> on <code>.</code> and map the getter helper
to read a set of complex <code>p</code> values from an object.</p>

<blockquote>
  <p><code>$([x]).select("name") == [ x.name ]</code>
  <code>$([x]).select("childNodes.1.nodeName") == [ x.childNodes[1].nodeName ]</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">select = </span><span class="nf">(p) -&gt;</span>
					<span class="k">if</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">p</span><span class="p">.</span><span class="nx">indexOf</span> <span class="s">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nx">@select</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">substr</span> <span class="mi">0</span><span class="p">,</span><span class="nx">i</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">substr</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
					<span class="k">else</span> <span class="nx">@map</span><span class="p">(</span><span class="nx">getter</span> <span class="nx">p</span><span class="p">)</span>
			<span class="p">)()</span></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>Replace any false-ish items in <em>this</em> with <em>x</em>.</p>

<blockquote>
  <p><code>$("&lt;a&gt;").select('parentNode').or(document)</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="o">or:</span> <span class="nf">(x) -&gt;</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">or=</span> <span class="nx">x</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">@length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Assign the value <em>v</em> to property <em>b</em> on every
item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">zap: </span><span class="nf">(p, v) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p><code>zap</code> supports the same dot-delimited property name scheme
that <code>select</code> uses. It does this by using <code>select</code>
internally.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>Find the last "." in <code>p</code> so we can split into a head (to
send to <code>select</code>) and a tail (a simple value to assign to).</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">i = </span><span class="nx">p</span><span class="p">.</span><span class="nx">lastIndexOf</span> <span class="s">&quot;.&quot;</span>

				<span class="k">if</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>Use <code>select</code> to fetch the head portion, the tail will be
a single property with no dots, which we recurse on (into
a lower branch next time).</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nv">head = </span><span class="nx">p</span><span class="p">.</span><span class="nx">substr</span> <span class="mi">0</span><span class="p">,</span><span class="nx">i</span>
					<span class="nv">tail = </span><span class="nx">p</span><span class="p">.</span><span class="nx">substr</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span>
					<span class="nx">@select</span><span class="p">(</span><span class="nx">head</span><span class="p">).</span><span class="nx">zap</span> <span class="nx">tail</span><span class="p">,</span> <span class="nx">v</span>
					<span class="k">return</span> <span class="nx">@</span>

				<span class="k">switch</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>If <em>v</em> is a sequence of values, they are striped across each
item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">when</span> <span class="s">&quot;array&quot;</span><span class="p">,</span><span class="s">&quot;bling&quot;</span> <span class="k">then</span> <span class="nx">@each</span> <span class="o">-&gt;</span> <span class="nx">@</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="o">++</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>If <em>v</em> is a function, map and set each item's property,
akin to: <code>x[p] = v(x[p])</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">when</span> <span class="s">&quot;function&quot;</span> <span class="k">then</span> <span class="nx">@zap</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">@select</span><span class="p">(</span><span class="nx">p</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Anything else, scalars, objects, null, anything, get
assigned directly to each item in this.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">else</span> <span class="nx">@each</span> <span class="o">-&gt;</span> <span class="nx">@</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
				<span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>Get a new set with only the first <em>n</em> items from <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">take: </span><span class="nf">(n = 1) -&gt;</span>
				<span class="nv">end = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">@length</span>
				<span class="nx">$</span><span class="p">(</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">end</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Get a new set with every item except the first <em>n</em> items.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">skip: </span><span class="nf">(n = 0) -&gt;</span>
				<span class="nv">start = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="o">|</span><span class="mi">0</span>
				<span class="nx">$</span><span class="p">(</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">start</span><span class="p">...</span><span class="nx">@length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Get the first item(s).</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">first: </span><span class="nf">(n = 1) -&gt;</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">@</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="nx">@take</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Get the last item(s).</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">last: </span><span class="nf">(n = 1) -&gt;</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">is</span> <span class="mi">1</span> <span class="k">then</span> <span class="nx">@</span><span class="p">[</span><span class="nx">@length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nx">@skip</span><span class="p">(</span><span class="nx">@length</span> <span class="o">-</span> <span class="nx">n</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Get a subset of <em>this</em> including [/i/../j/-1]</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">slice: </span><span class="nf">(start=0, end=@length) -&gt;</span>
				<span class="nv">start = </span><span class="nx">index</span> <span class="nx">start</span><span class="p">,</span> <span class="nx">@</span>
				<span class="nv">end = </span><span class="nx">index</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">@</span>
				<span class="nx">$</span><span class="p">(</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">start</span><span class="p">...</span><span class="nx">end</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Append the items in <em>b</em> into <em>this</em>. Modifies <em>this</em> in-place.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">extend: </span><span class="nf">(b) -&gt;</span> <span class="nx">@</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">b</span><span class="p">;</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>Appends a single item to <em>this</em>; unlike a native Array, it
returns a reference to <em>this</em> for chaining.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">push: </span><span class="nf">(b) -&gt;</span> <span class="nb">Array</span><span class="o">::</span><span class="nx">push</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>Get a new set containing only items that match <em>f</em>. <em>f</em> can be
any of:</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">filter: </span><span class="nf">(f) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>The argument <em>f</em> can be any of:</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">g = </span><span class="k">switch</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span> <span class="nx">f</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <ul>
<li>selector string: <code>.filter("td.selected")</code></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">when</span> <span class="s">&quot;string&quot;</span> <span class="k">then</span> <span class="nf">(x) -&gt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">matchesSelector</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <ul>
<li>RegExp object: <code>.filter(/^prefix-/)</code></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">when</span> <span class="s">&quot;regexp&quot;</span> <span class="k">then</span> <span class="nf">(x) -&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <ul>
<li>function: <code>.filter (x) -&gt; (x%2) is 1</code></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">when</span> <span class="s">&quot;function&quot;</span> <span class="k">then</span> <span class="nx">f</span>
					<span class="k">else</span>
						<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;unsupported type passed to filter: </span><span class="si">#{</span><span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
				<span class="nx">$</span><span class="p">(</span> <span class="nb">Array</span><span class="o">::</span><span class="nx">filter</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">g</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>$( it for it in @ when g.call(it,it) )</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>Get a new set of booleans, true if the node from <em>this</em>
matched the CSS expression.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">matches: </span><span class="nf">(expr) -&gt;</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&#39;matchesSelector&#39;</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">expr</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Each node in <em>this</em> contributes all children matching the
CSS expression to a new set.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">querySelectorAll: </span><span class="nf">(expr) -&gt;</span>
				<span class="nx">@filter</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">reduce</span> <span class="nf">(a, i) -&gt;</span>
					<span class="nx">a</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">i</span><span class="p">.</span><span class="nx">querySelectorAll</span> <span class="nx">expr</span>
				<span class="p">,</span> <span class="nx">$</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>Get a new set with items interleaved from the items in <em>a</em> and
<em>b</em>. The result is:</p>

<blockquote>
  <p><code>$([ b[i], this[i], ... ])</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">weave: </span><span class="nf">(b) -&gt;</span>
				<span class="nv">c = </span><span class="nx">$</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>First spread out <em>this</em>, from back to front.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="nx">@length</span><span class="o">-</span><span class="mi">1</span><span class="p">..</span><span class="mi">0</span><span class="p">]</span> <span class="k">by</span> <span class="o">-</span><span class="mi">1</span>
					<span class="nx">c</span><span class="p">[(</span><span class="nx">i</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>Then interleave items from <em>b</em>, from front to back</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span>
					<span class="nx">c</span><span class="p">[</span><span class="nx">i</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
				<span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>Notes about <code>weave</code>:
* the items of b come first.
* the result always has 2 * max(length) items.
* if b and this are different lengths, the shorter will yield
<code>undefined</code>(s) into the result.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>Get a new set with <em>c</em> = <code>f(a,b)</code>. Will always return a set
with half as many items as <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">fold: </span><span class="nf">(f) -&gt;</span>
				<span class="nv">n = </span><span class="nx">@length</span>
				<span class="nv">b = </span><span class="nx">$</span><span class="p">(</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">by</span> <span class="mi">2</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>If there is an odd man out, make one last call</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span> <span class="o">is</span> <span class="mi">1</span>
					<span class="nx">b</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@</span><span class="p">[</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="kc">undefined</span> <span class="p">)</span>
				<span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>Tip: use <code>fold</code> as a companion to <code>weave</code>; weave two blings together,
then fold them back to the original size.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>Get a new set with all items from subsets in one set.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">flatten: </span><span class="o">-&gt;</span>
				<span class="nv">b = </span><span class="nx">$</span><span class="p">()</span>
				<span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">j</span><span class="p">)</span> <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">@</span>
				<span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Call every function in <em>this</em> with the same arguments.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">call: </span><span class="o">-&gt;</span> <span class="nx">@apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>Apply every function in <em>this</em> to <em>context</em> with <em>args</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">apply: </span><span class="nf">(context, args) -&gt;</span>
				<span class="nx">@map</span> <span class="o">-&gt;</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;function&quot;</span><span class="p">,</span> <span class="nx">@</span> <span class="k">then</span> <span class="nx">@apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>Log one line for each item in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">log: </span><span class="nf">(label) -&gt;</span>
				<span class="k">if</span> <span class="nx">label</span>
					<span class="nx">$</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">label</span><span class="p">,</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@length</span> <span class="o">+</span> <span class="s">&quot; items&quot;</span><span class="p">)</span>
				<span class="k">else</span>
					<span class="nx">$</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">@length</span> <span class="o">+</span> <span class="s">&quot; items&quot;</span><span class="p">)</span>
				<span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Convert this to an array.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">toArray: </span><span class="o">-&gt;</span> <span class="p">(</span><span class="nx">@</span><span class="p">.</span><span class="nv">__proto__ = </span><span class="nb">Array</span><span class="o">::</span><span class="p">);</span> <span class="nx">@</span> <span class="c1"># no copies, yay?</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <h2>Math Plugin</h2>

<p>All the stuff you need to use blings as vectors in linear algebra.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;math&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">$:</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>Get an array of numbers.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">range: </span><span class="nf">(start, end, step = 1) -&gt;</span>
				<span class="nx">step</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">end</span> <span class="o">&lt;</span> <span class="nx">start</span> <span class="o">and</span> <span class="nx">step</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="c1"># force step to have the same sign as start-&gt;end</span>
				<span class="nx">$</span><span class="p">(</span> <span class="p">(</span><span class="nx">start</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="nx">step</span><span class="p">))</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span> <span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="nx">step</span> <span class="p">)]</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>Get an array of zeros.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">zeros: </span><span class="nf">(n) -&gt;</span> <span class="nx">$</span><span class="p">(</span> <span class="mi">0</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>Get an array of ones.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">ones: </span><span class="nf">(n) -&gt;</span> <span class="nx">$</span><span class="p">(</span> <span class="mi">1</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Convert everything to a float.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">floats: </span><span class="o">-&gt;</span> <span class="nx">@map</span> <span class="nb">parseFloat</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>Convert everything to an int.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">ints: </span><span class="o">-&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nb">parseInt</span> <span class="nx">@</span><span class="p">,</span> <span class="mi">10</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>Convert everything to a "px" string.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">px: </span><span class="nf">(delta) -&gt;</span> <span class="nx">@ints</span><span class="p">().</span><span class="nx">map</span> <span class="o">-&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">px</span> <span class="nx">@</span><span class="p">,</span><span class="nx">delta</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>Get the smallest element (defined by Math.min)</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">min: </span><span class="o">-&gt;</span> <span class="nx">@reduce</span> <span class="nf">(a) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>Get the largest element (defined by Math.max)</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">max: </span><span class="o">-&gt;</span> <span class="nx">@reduce</span> <span class="nf">(a) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>Get the mean (average) of the set.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">mean: </span><span class="o">-&gt;</span> <span class="nx">@sum</span><span class="p">()</span> <span class="o">/</span> <span class="nx">@length</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Get the sum of the set.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">sum: </span><span class="o">-&gt;</span> <span class="nx">@reduce</span> <span class="nf">(a) -&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>Get the product of all items in the set.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">product: </span><span class="o">-&gt;</span> <span class="nx">@reduce</span> <span class="nf">(a) -&gt;</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Get a new set with every item squared.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">squares: </span><span class="o">-&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nx">@</span> <span class="o">*</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>Get the magnitude (vector length) of this set.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">magnitude: </span><span class="o">-&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span> <span class="nx">@floats</span><span class="p">().</span><span class="nx">squares</span><span class="p">().</span><span class="nx">sum</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>Get a new set, scaled by a real factor.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">scale: </span><span class="nf">(r) -&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nx">r</span> <span class="o">*</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>Add this to d, get a new set.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">add: </span><span class="nf">(d) -&gt;</span> <span class="k">switch</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
			<span class="k">when</span> <span class="s">&quot;number&quot;</span> <span class="k">then</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nx">d</span> <span class="o">+</span> <span class="nx">@</span>
			<span class="k">when</span> <span class="s">&quot;bling&quot;</span><span class="p">,</span><span class="s">&quot;array&quot;</span> <span class="k">then</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="nx">d</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">@length</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>Get a new set with same direction, but magnitude equal to 1.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">normalize: </span><span class="o">-&gt;</span> <span class="nx">@scale</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nx">@magnitude</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <h2>String Plugin</h2>

<p>Filling out the standard library of string functions.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">depends: </span><span class="s">&quot;function&quot;</span>
		<span class="nv">provides: </span><span class="s">&quot;string&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <h3>toString</h3>

<p>Extend the base type to allow for converting things
to string based on their type. This is a separate system from the
native Object.prototype.toString chain of methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">extend</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>First, extend the base type with a default <code>string</code> function</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">unknown: </span>  <span class="p">{</span> <span class="nv">string: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toString</span><span class="o">?</span><span class="p">()</span> <span class="o">?</span> <span class="nb">String</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>Now, for each basic type, provide a basic <code>string</code> function.
Later, more complex types will be added by plugins.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kc">null</span><span class="o">:</span>      <span class="p">{</span> <span class="nv">string: </span><span class="o">-&gt;</span> <span class="s">&quot;null&quot;</span> <span class="p">}</span>
			<span class="kc">undefined</span><span class="o">:</span> <span class="p">{</span> <span class="nv">string: </span><span class="o">-&gt;</span> <span class="s">&quot;undefined&quot;</span> <span class="p">}</span>
			<span class="nv">string: </span>   <span class="p">{</span> <span class="nv">string: </span><span class="nx">$</span><span class="p">.</span><span class="nx">identity</span> <span class="p">}</span>
			<span class="nv">array: </span>    <span class="p">{</span> <span class="nv">string: </span><span class="nf">(a) -&gt;</span> <span class="s">&quot;[&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">a</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> <span class="p">}</span>
			<span class="nv">object: </span>   <span class="p">{</span> <span class="nv">string: </span><span class="nf">(o) -&gt;</span> <span class="s">&quot;{&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">k</span><span class="si">}</span><span class="s">:</span><span class="si">#{</span><span class="nx">$</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">for</span> <span class="nx">k</span><span class="p">,</span><span class="nx">v</span> <span class="k">in</span> <span class="nx">o</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;}&quot;</span> <span class="p">}</span>
			<span class="nv">number: </span>   <span class="p">{</span> <span class="nv">string: </span><span class="nf">(n) -&gt;</span>
				<span class="k">switch</span> <span class="kc">true</span>
					<span class="k">when</span> <span class="nx">n</span><span class="p">.</span><span class="nx">precision</span><span class="o">?</span> <span class="k">then</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toPrecision</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">precision</span><span class="p">)</span>
					<span class="k">when</span> <span class="nx">n</span><span class="p">.</span><span class="nx">fixed</span><span class="o">?</span> <span class="k">then</span> <span class="nx">n</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">fixed</span><span class="p">)</span>
					<span class="k">else</span> <span class="nb">String</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>Return a bunch of root-level string functions.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span>
				<span class="nv">toString: </span><span class="nf">(x) -&gt;</span>
					<span class="k">if</span> <span class="o">not</span> <span class="nx">x</span><span class="o">?</span> <span class="k">then</span> <span class="s">&quot;function Bling(selector, context) { [ ... ] }&quot;</span>
					<span class="k">else</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">string</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>Get a "px" string.
Accepts anything parseInt-able (including an existing "px"
string), adjusts by optional delta.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">px: </span><span class="nf">(x, delta=0) -&gt;</span> <span class="nx">x</span><span class="o">?</span> <span class="o">and</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nx">delta</span><span class="o">|</span><span class="mi">0</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;px&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>Example: Add 100px of width to an element.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>jQuery style:</p>

<blockquote>
  <p><code>node.css("width",$.px(node.css("width"), + 100))</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>Bling style:</p>

<blockquote>
  <p><code>node.zap 'style.width', -&gt; $.px(@, + 100)</code></p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>Properly <strong>Capitalize</strong> Each Word In A String.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">capitalize: </span><span class="nf">(name) -&gt;</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(x) -&gt;</span> <span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">x</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Convert a <em>camelCase</em> name to a <em>dash-name</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">dashize: </span><span class="nf">(name) -&gt;</span>
					<span class="nv">ret = </span><span class="s">&quot;&quot;</span>
					<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...(</span><span class="nx">name</span><span class="o">?</span><span class="p">.</span><span class="nx">length</span><span class="o">|</span><span class="mi">0</span><span class="p">)]</span> <span class="k">by</span> <span class="mi">1</span>
						<span class="nv">c = </span><span class="nx">name</span><span class="p">.</span><span class="nx">charCodeAt</span> <span class="nx">i</span></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>For each uppercase character,</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">if</span> <span class="mi">91</span> <span class="o">&gt;</span> <span class="nx">c</span> <span class="o">&gt;</span> <span class="mi">64</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>Shift it to lower case and insert a '-'.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">c</span> <span class="o">+=</span> <span class="mi">32</span>
							<span class="nx">ret</span> <span class="o">+=</span> <span class="s">&#39;-&#39;</span>
						<span class="nx">ret</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
					<span class="nx">ret</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>Convert a <em>dash-name</em> to a <em>camelName</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">camelize: </span><span class="nf">(name) -&gt;</span>
					<span class="nx">name</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
					<span class="k">while</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">name</span><span class="o">?</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
						<span class="nv">name = </span><span class="nx">$</span><span class="p">.</span><span class="nx">stringSplice</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="nx">name</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="nx">toUpperCase</span><span class="p">())</span>
					<span class="nx">name</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>Fill the left side of a string to make it a fixed width.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">padLeft: </span><span class="nf">(s, n, c = &quot; &quot;) -&gt;</span>
					<span class="k">while</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">n</span>
						<span class="nv">s = </span><span class="nx">c</span> <span class="o">+</span> <span class="nx">s</span>
					<span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>Fill the right side of a string to make it a fixed width.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">padRight: </span><span class="nf">(s, n, c = &quot; &quot;) -&gt;</span>
					<span class="k">while</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">n</span>
						<span class="nv">s = </span><span class="nx">s</span> <span class="o">+</span> <span class="nx">c</span>
					<span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>Count the number of occurences of <code>x</code> in <code>s</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">stringCount: </span><span class="nf">(s, x, i = 0, n = 0) -&gt;</span> <span class="k">if</span> <span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">i</span><span class="p">))</span> <span class="o">&gt;</span> <span class="nx">i</span><span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nx">$</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span><span class="nx">x</span><span class="p">,</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="nx">n</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>Splice the substring <code>n</code> into the string <code>s', replacing indices
between</code>i<code>and</code>j`.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">stringSplice: </span><span class="nf">(s, i, j, n) -&gt;</span>
					<span class="nv">nn = </span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span>
					<span class="nv">end = </span><span class="nx">j</span>
					<span class="k">if</span> <span class="nx">end</span> <span class="o">&lt;</span> <span class="mi">0</span>
						<span class="nx">end</span> <span class="o">+=</span> <span class="nx">nn</span>
					<span class="nv">start = </span><span class="nx">i</span>
					<span class="k">if</span> <span class="nx">start</span> <span class="o">&lt;</span> <span class="mi">0</span>
						<span class="nx">start</span> <span class="o">+=</span> <span class="nx">nn</span>
					<span class="nx">s</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">start</span><span class="p">)</span> <span class="o">+</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">s</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">end</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>Compute the Adler32 checksum of a string.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">checksum: </span><span class="nf">(s) -&gt;</span>
					<span class="nv">a = </span><span class="mi">1</span><span class="p">;</span> <span class="nv">b = </span><span class="mi">0</span>
					<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span>
						<span class="nv">a = </span><span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">s</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span> <span class="o">%</span> <span class="mi">65521</span>
						<span class="nv">b = </span><span class="p">(</span><span class="nx">b</span> <span class="o">+</span> <span class="nx">a</span><span class="p">)</span> <span class="o">%</span> <span class="mi">65521</span>
					<span class="p">(</span><span class="nx">b</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>Return a string-builder, which uses arrays to defer all string
concatenation until you call <code>builder.toString()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">stringBuilder: </span><span class="o">-&gt;</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;window&quot;</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span> <span class="k">then</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">stringBuilder</span><span class="p">()</span>
					<span class="nv">items = </span><span class="p">[]</span>
					<span class="vi">@length   = </span><span class="mi">0</span>
					<span class="vi">@append   = </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">push</span> <span class="nx">s</span><span class="p">;</span> <span class="nx">@length</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">?</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="o">|</span><span class="mi">0</span>
					<span class="vi">@prepend  = </span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">splice</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">s</span><span class="p">;</span> <span class="nx">@length</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">?</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">length</span><span class="o">|</span><span class="mi">0</span>
					<span class="vi">@clear    = </span><span class="p">(</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="nv">ret = </span><span class="nx">@toString</span><span class="p">();</span> <span class="nv">items = </span><span class="p">[];</span> <span class="vi">@length = </span><span class="mi">0</span><span class="p">;</span> <span class="nx">ret</span>
					<span class="vi">@toString = </span><span class="p">(</span> <span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
					<span class="nx">@</span>
			<span class="nv">toString: </span><span class="o">-&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toString</span> <span class="nx">@</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <h2>Function Plugin</h2>

<p>These are little function factories, for making new functions out of other functions.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;function&quot;</span>
		<span class="nv">depends: </span><span class="s">&quot;hash&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">$:</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p><strong>$.identity(x)</strong> returns x.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">identity: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p><strong>$.not(f)</strong> returns a new function that returns <code>not f(...)</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="o">not:</span> <span class="nf">(f) -&gt;</span> <span class="nf">(a...) -&gt;</span> <span class="o">not</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p><strong>$.compose(f,g)</strong> composes <em>f</em> and <em>g</em> to <code>f(g(...))</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">compose: </span><span class="nf">(f,g) -&gt;</span> <span class="nf">(x) -&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="p">(</span><span class="nv">y = </span><span class="nx">g</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">x</span><span class="p">)))</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p><strong>$.and(f,g)</strong> returns a new function that returns f(x) &amp;&amp; g(x).</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="o">and:</span> <span class="nf">(f,g) -&gt;</span> <span class="nf">(x) -&gt;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">x</span><span class="p">)</span> <span class="o">and</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">x</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p><strong>$.once(f)</strong> returns a new function that will only call
<em>f</em> <strong>once</strong>, or <em>n</em> times if you pass the optional argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">once: </span><span class="nf">(f,n=1) -&gt;</span> <span class="nv">f.n = </span><span class="nx">n</span><span class="p">;</span> <span class="nf">(a...) -&gt;</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span> <span class="k">if</span> <span class="nx">f</span><span class="p">.</span><span class="nx">n</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p><strong>$.bound(context,f,[args])</strong> returns a new function that
forces <code>this === context</code> when called.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">bound: </span><span class="nf">(t, f, args = []) -&gt;</span>
				<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;function&quot;</span><span class="p">,</span> <span class="nx">f</span><span class="p">.</span><span class="nx">bind</span>
					<span class="nx">args</span><span class="p">.</span><span class="nx">splice</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">t</span>
					<span class="nv">r = </span><span class="nx">f</span><span class="p">.</span><span class="nx">bind</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">args</span>
				<span class="k">else</span>
					<span class="nv">r = </span><span class="nf">(a...) -&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">t</span><span class="p">,</span> <span class="p">(</span><span class="nx">args</span> <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="k">else</span> <span class="nx">a</span><span class="p">)</span>
				<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">r</span><span class="p">,</span> <span class="p">{</span> <span class="nv">toString: </span><span class="o">-&gt;</span> <span class="s">&quot;bound-method of </span><span class="si">#{</span><span class="nx">t</span><span class="si">}</span><span class="s">.</span><span class="si">#{</span><span class="nx">f</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s">&quot;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p><strong>$.memoize(f)</strong> returns a new function that caches function calls to f, based on hashing the arguments.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">memoize: </span><span class="nf">(f) -&gt;</span> <span class="nv">cache = </span><span class="p">{};</span> <span class="nf">(a...) -&gt;</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">a</span><span class="p">)]</span> <span class="o">?=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">a</span> <span class="c1"># BUG: skips cache if f returns null on purpose</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <h2>Trace Plugin</h2>

<p>A very useful debugging tool, <code>$(o).trace() or $.trace(o)</code> will deep-walk all
properties and wrap all functions with new functions that call the
originals but log the calls (and use the property names from the
deep walk as labels).</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;trace&quot;</span>
		<span class="nv">depends: </span><span class="s">&quot;function,type&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">extend</span>
			<span class="nv">unknown: </span><span class="p">{</span> <span class="nv">trace: </span><span class="nx">$</span><span class="p">.</span><span class="nx">identity</span> <span class="p">}</span>
			<span class="nv">object: </span> <span class="p">{</span> <span class="nv">trace: </span><span class="nf">(o, label, tracer) -&gt;</span> <span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">],</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">label</span><span class="si">}</span><span class="s">.</span><span class="si">#{</span><span class="nx">k</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="nx">tracer</span><span class="p">)</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">o</span><span class="p">));</span> <span class="nx">o</span> <span class="p">}</span>
			<span class="nv">array: </span>  <span class="p">{</span> <span class="nv">trace: </span><span class="nf">(o, label, tracer) -&gt;</span> <span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">label</span><span class="si">}</span><span class="s">[</span><span class="si">#{</span><span class="nx">i</span><span class="si">}</span><span class="s">]&quot;</span><span class="p">,</span> <span class="nx">tracer</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="k">by</span> <span class="mi">1</span><span class="p">);</span> <span class="nx">o</span> <span class="p">}</span>
			<span class="nv">function:</span>
				<span class="nv">trace: </span><span class="nf">(f, label, tracer) -&gt;</span>
					<span class="nv">r = </span><span class="nf">(a...) -&gt;</span>
						<span class="nx">tracer</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@name</span> <span class="o">or</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span><span class="si">}</span><span class="s">.</span><span class="si">#{</span><span class="nx">label</span> <span class="o">or</span> <span class="nx">f</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s">(&quot;</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="s">&quot;)&quot;</span>
						<span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">a</span>
					<span class="nx">tracer</span> <span class="s">&quot;Trace: </span><span class="si">#{</span><span class="nx">label</span> <span class="o">or</span> <span class="nx">f</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="s"> created.&quot;</span>
					<span class="nv">r.toString = </span><span class="nx">f</span><span class="p">.</span><span class="nx">toString</span>
					<span class="nx">r</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span>
				<span class="nv">trace: </span><span class="nf">(o, label, tracer) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">trace</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">tracer</span><span class="p">)</span>
			<span class="nv">trace: </span><span class="nf">(label, tracer) -&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trace</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span><span class="nx">label</span><span class="p">,</span><span class="nx">tracer</span><span class="p">)</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <h2>Hash plugin</h2>

<p><code>$.hash(o)</code> Reduces any thing to an integer hash code (not secure).</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;hash&quot;</span>
		<span class="nv">depends: </span><span class="s">&quot;type&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">extend</span>
			<span class="nv">unknown: </span><span class="p">{</span> <span class="nv">hash: </span><span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">checksum</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">}</span>
			<span class="nv">object: </span> <span class="p">{</span> <span class="nv">hash: </span><span class="nf">(o) -&gt;</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span> <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">o</span><span class="p">)</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span> <span class="p">}</span>
			<span class="nv">array: </span>  <span class="p">{</span> <span class="nv">hash: </span><span class="nf">(o) -&gt;</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">x</span><span class="p">).</span><span class="nx">reduce</span> <span class="nf">(a,x) -&gt;</span> <span class="nx">a</span><span class="o">+</span><span class="nx">x</span> <span class="p">}</span>
			<span class="nv">bool: </span>   <span class="p">{</span> <span class="nv">hash: </span><span class="nf">(o) -&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">o</span><span class="p">)</span> <span class="p">}</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span>
				<span class="nv">hash: </span><span class="nf">(x) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">hash</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
			<span class="nv">hash: </span><span class="nf">() -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <h2>Publish/Subscribe plugin</h2>

<p>Publish messages to a named channel, those messages invoke each
function subscribed to that channel.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;pubsub&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">subscribers = </span><span class="p">{}</span> <span class="c1"># a mapping of channel name to a list of subscribers</span>
		<span class="nv">publish = </span><span class="nf">(e, args...) -&gt;</span>
			<span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">args</span> <span class="k">for</span> <span class="nx">f</span> <span class="k">in</span> <span class="p">(</span><span class="nx">subscribers</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[])</span>
			<span class="nx">@</span>
		<span class="nv">subscribe = </span><span class="nf">(e, func) -&gt;</span>
			<span class="p">(</span><span class="nx">subscribers</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[]).</span><span class="nx">push</span> <span class="nx">func</span>
			<span class="nx">func</span>
		<span class="nv">unsubscribe = </span><span class="nf">(e, func) -&gt;</span>
			<span class="k">if</span> <span class="o">not</span> <span class="nx">func</span><span class="o">?</span>
				<span class="nx">subscribers</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">else</span>
				<span class="nv">a = </span><span class="p">(</span><span class="nx">subscribers</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[])</span>
				<span class="k">if</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">a</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">func</span><span class="p">)</span>  <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
					<span class="nx">a</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span>
				<span class="nv">publish: </span><span class="nx">publish</span>
				<span class="nv">subscribe: </span><span class="nx">subscribe</span>
				<span class="nv">unsubscribe: </span><span class="nx">unsubscribe</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <h2>Throttle Plugin</h2>

<p><code>$.throttle</code> and <code>$.debounce</code> are two different ways to rate limit
a function.  Both are function decorators.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;throttle&quot;</span>
		<span class="nv">depends: </span><span class="s">&quot;core&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">$:</span>
			<span class="nv">throttle: </span><span class="nf">(f,n=250,last=0) -&gt;</span>
				<span class="nf">(a...) -&gt;</span>
					<span class="nv">gap = </span><span class="nx">$</span><span class="p">.</span><span class="nx">now</span> <span class="o">-</span> <span class="nx">last</span>
					<span class="k">if</span> <span class="nx">gap</span> <span class="o">&gt;</span> <span class="nx">n</span>
						<span class="nx">last</span> <span class="o">+=</span> <span class="nx">gap</span>
						<span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span><span class="nx">a</span>
					<span class="kc">null</span>
			<span class="nv">debounce: </span><span class="nf">(f,n=250,last=0) -&gt;</span> <span class="c1"># must be a silence of n ms before f is called again</span>
				<span class="nf">(a...) -&gt;</span>
					<span class="nx">last</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">gap = </span><span class="nx">$</span><span class="p">.</span><span class="nx">now</span> <span class="o">-</span> <span class="nx">last</span><span class="p">)</span>
					<span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span><span class="nx">a</span> <span class="k">if</span> <span class="nx">gap</span> <span class="o">&gt;</span> <span class="nx">n</span> <span class="k">else</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <h2>EventEmitter Plugin</h2>

<p>The EventEmitter interface that NodeJS uses is much simpler (and faster) than the DOM event model.
Example: <code>$.inherit new EventEmitter(), { myCode: () -&gt; "..." }</code></p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">provides: </span><span class="s">&quot;EventEmitter&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">$: EventEmitter: </span><span class="k">class</span> <span class="nx">EventEmitter</span>
			<span class="nv">constructor: </span>       <span class="o">-&gt;</span> <span class="vi">@__event = </span><span class="p">{}</span>
			<span class="nv">addListener: </span>       <span class="nf">(e, h) -&gt;</span> <span class="p">(</span><span class="nx">@__event</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[]).</span><span class="nx">push</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span> <span class="nx">@emit</span><span class="p">(</span><span class="s">&#39;newListener&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
			<span class="kc">on</span><span class="o">:</span>                 <span class="nf">(e, h) -&gt;</span> <span class="nx">@addListener</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">h</span>
			<span class="nv">once: </span>              <span class="nf">(e,h) -&gt;</span> <span class="nx">@addListener</span> <span class="nx">e</span><span class="p">,</span> <span class="p">(</span><span class="nv">f = </span><span class="nf">(a...) -&gt;</span> <span class="nx">@removeListener</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span> <span class="nx">h</span><span class="p">(</span><span class="nx">a</span><span class="p">...))</span>
			<span class="nv">removeListener: </span>    <span class="nf">(e, h) -&gt;</span> <span class="p">(</span><span class="nx">@__event</span><span class="p">[</span><span class="nx">e</span><span class="p">].</span><span class="nx">splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">i = </span><span class="p">(</span><span class="nx">@__event</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[]).</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">h</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
			<span class="nv">removeAllListeners: </span><span class="nf">(e) -&gt;</span> <span class="nx">@__event</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="nv">setMaxListeners: </span>   <span class="nf">(n) -&gt;</span> <span class="c1"># nop for now... who really needs this in the core API?</span>
			<span class="nv">listeners: </span>         <span class="nf">(e) -&gt;</span> <span class="nx">@__event</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span>
			<span class="nv">emit: </span>              <span class="nf">(e, a...) -&gt;</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="k">for</span> <span class="nx">f</span> <span class="k">in</span> <span class="p">(</span><span class="nx">@__event</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">[]));</span> <span class="kc">null</span>

	
	<span class="k">if</span> <span class="nx">glob</span><span class="p">.</span><span class="nb">document</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <h2>DOM Plugin</h2>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
			<span class="nv">depends: </span><span class="s">&quot;function&quot;</span>
			<span class="nv">provides: </span><span class="s">&quot;dom&quot;</span>
		<span class="p">,</span> <span class="o">-&gt;</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">register</span> <span class="s">&quot;nodelist&quot;</span><span class="p">,</span>
				<span class="nv">match: </span> <span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="o">?</span> <span class="o">and</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isType</span> <span class="s">&quot;NodeList&quot;</span><span class="p">,</span> <span class="nx">o</span>
				<span class="nv">hash: </span>  <span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">x</span><span class="p">).</span><span class="nx">sum</span><span class="p">()</span>
				<span class="nv">array: </span> <span class="nx">$</span><span class="p">.</span><span class="nx">identity</span>
				<span class="nv">string: </span><span class="nf">(o) -&gt;</span> <span class="s">&quot;{nodelist:&quot;</span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s">&#39;nodeName&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;}&quot;</span>
				<span class="nv">node: </span>  <span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">toFragment</span><span class="p">()</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">register</span> <span class="s">&quot;node&quot;</span><span class="p">,</span>
				<span class="nv">match: </span> <span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="o">?</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">&gt;</span> <span class="mi">0</span>
				<span class="nv">hash: </span>  <span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">checksum</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">)</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">checksum</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">)</span>
				<span class="nv">string: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
				<span class="nv">node: </span>  <span class="nx">$</span><span class="p">.</span><span class="nx">identity</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">register</span> <span class="s">&quot;fragment&quot;</span><span class="p">,</span>
				<span class="nv">match: </span> <span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="o">?</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">is</span> <span class="mi">11</span>
				<span class="nv">hash: </span>  <span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">for</span> <span class="nx">x</span> <span class="k">in</span> <span class="nx">o</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">).</span><span class="nx">sum</span><span class="p">()</span>
				<span class="nv">string: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
				<span class="nv">node: </span>  <span class="nx">$</span><span class="p">.</span><span class="nx">identity</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">register</span> <span class="s">&quot;html&quot;</span><span class="p">,</span>
				<span class="nv">match: </span> <span class="nf">(o) -&gt;</span> <span class="k">typeof</span> <span class="nx">o</span> <span class="o">is</span> <span class="s">&quot;string&quot;</span> <span class="o">and</span> <span class="p">(</span><span class="nx">s</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">trimLeft</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&lt;&quot;</span> <span class="o">and</span> <span class="nx">s</span><span class="p">[</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&gt;&quot;</span>
				<span class="nv">node: </span>  <span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nv">h = </span><span class="nx">Bling</span><span class="p">.</span><span class="nx">HTML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">o</span><span class="p">)).</span><span class="nx">node</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
				<span class="nv">array: </span> <span class="nf">(o,c) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nv">h = </span><span class="nx">Bling</span><span class="p">.</span><span class="nx">HTML</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">o</span><span class="p">)).</span><span class="nx">array</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">extend</span>
				<span class="nv">unknown: </span> <span class="p">{</span> <span class="nv">node: </span><span class="o">-&gt;</span> <span class="kc">null</span> <span class="p">}</span>
				<span class="nv">bling: </span>   <span class="p">{</span> <span class="nv">node: </span><span class="nf">(o) -&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toFragment</span><span class="p">()</span> <span class="p">}</span>
				<span class="nv">string:</span>
					<span class="nv">node: </span> <span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">toFragment</span><span class="p">()</span>
					<span class="nv">array: </span><span class="nf">(o,c) -&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="o">?</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span>
				<span class="nv">function: </span><span class="p">{</span> <span class="nv">node: </span><span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">toString</span><span class="p">()).</span><span class="nx">toFragment</span><span class="p">()</span> <span class="p">}</span>

			<span class="nv">toFrag = </span><span class="nf">(a) -&gt;</span>
				<span class="k">if</span> <span class="o">not</span> <span class="nx">a</span><span class="p">.</span><span class="nx">parentNode</span><span class="o">?</span>
					<span class="nv">df = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">()</span>
					<span class="nx">df</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
				<span class="nx">a</span>
			<span class="nv">before = </span><span class="nf">(a,b) -&gt;</span> <span class="nx">toFrag</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span>
			<span class="nv">after = </span><span class="nf">(a,b) -&gt;</span> <span class="nx">toFrag</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">nextSibling</span>
			<span class="nv">toNode = </span><span class="nf">(x) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">node</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
			<span class="nv">escaper = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>window.getComputedStyle is not a normal function
(it doesnt support .call() so we can't use it with .map())
so define something that does work properly for use in .css</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">computeCSSProperty = </span><span class="nf">(k) -&gt;</span> <span class="o">-&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="kc">null</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span>

			<span class="nv">getOrSetRect = </span><span class="nf">(p) -&gt;</span> <span class="nf">(x) -&gt;</span> <span class="k">if</span> <span class="nx">x</span><span class="o">?</span> <span class="k">then</span> <span class="nx">@css</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@rect</span><span class="p">().</span><span class="nx">select</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>

			<span class="k">return</span> <span class="p">{</span>
				<span class="nv">$:</span></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p><code>$.HTML</code> provides methods similar to the global JSON
object, for parsing from and to HTML.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nv">HTML:</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>Parse the html in string h into a node or fragment.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nv">parse: </span><span class="nf">(h) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>Put the html into a new div.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="p">(</span><span class="nv">node = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">)).</span><span class="nv">innerHTML = </span><span class="nx">h</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>If there's only one resulting child, return that Node.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="k">if</span> <span class="nv">n = </span><span class="p">(</span><span class="nv">childNodes = </span><span class="nx">node</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">).</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
								<span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>Otherwise, copy all the div's children into a new
fragment.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nv">df = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">()</span>
							<span class="nx">df</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">n</span><span class="p">]</span>
							<span class="nx">df</span></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>Convert a node or fragment to an HTML string.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nv">stringify: </span><span class="nf">(n) -&gt;</span>
							<span class="k">switch</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span> <span class="nx">n</span>
								<span class="k">when</span> <span class="s">&quot;string&quot;</span><span class="p">,</span><span class="s">&quot;html&quot;</span> <span class="k">then</span> <span class="nx">n</span>
								<span class="k">when</span> <span class="s">&quot;node&quot;</span><span class="p">,</span><span class="s">&quot;fragment&quot;</span>
									<span class="nv">d = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span> <span class="s">&quot;div&quot;</span>
									<span class="nx">d</span><span class="p">.</span><span class="nx">appendChild</span> <span class="p">(</span><span class="nv">n = </span><span class="nx">n</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>Uses .innerHTML to render the HTML.</p>             </td>             <td class="code">               <div class="highlight"><pre>									<span class="nv">ret = </span><span class="nx">d</span><span class="p">.</span><span class="nx">innerHTML</span>
									<span class="nx">d</span><span class="p">.</span><span class="nx">removeChild</span> <span class="nx">n</span> <span class="c1"># break links to prevent leaks</span>
									<span class="nx">ret</span>
								<span class="k">else</span> <span class="s">&quot;HTML.stringify of unknown type: &quot;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>Escape html characters in <em>h</em>, so "&lt;" becomes "&lt;",
etc.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nv">escape: </span><span class="nf">(h) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>Create a singleton div with a text node within it.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">escaper</span> <span class="o">or=</span> <span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&quot;</span><span class="p">).</span><span class="nx">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>Insert <em>h</em> using the text node's .data property,
then get escaped html from the <em>parent's</em> innerHTML.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nv">ret = </span><span class="nx">escaper</span><span class="p">.</span><span class="nx">zap</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="nx">h</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s">&quot;parentNode.innerHTML&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>Clean up so content doesn't litter.</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nx">escaper</span><span class="p">.</span><span class="nx">zap</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
							<span class="nx">ret</span></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>Get [or set] innerHTML for each node.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">html: </span><span class="nf">(h) -&gt;</span>
					<span class="k">return</span> <span class="k">switch</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span> <span class="nx">h</span>
						<span class="k">when</span> <span class="s">&quot;undefined&quot;</span><span class="p">,</span><span class="s">&quot;null&quot;</span> <span class="k">then</span> <span class="nx">@select</span> <span class="s">&#39;innerHTML&#39;</span>
						<span class="k">when</span> <span class="s">&quot;string&quot;</span> <span class="k">then</span> <span class="nx">@zap</span> <span class="s">&#39;innerHTML&#39;</span><span class="p">,</span> <span class="nx">h</span>
						<span class="k">when</span> <span class="s">&quot;bling&quot;</span> <span class="k">then</span> <span class="nx">@html</span> <span class="nx">h</span><span class="p">.</span><span class="nx">toFragment</span><span class="p">()</span>
						<span class="k">when</span> <span class="s">&quot;node&quot;</span>
							<span class="nx">@each</span> <span class="o">-&gt;</span> <span class="c1"># replace all our children with the new child</span>
								<span class="nx">@replaceChild</span> <span class="nx">@childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">h</span>
								<span class="k">while</span> <span class="nx">@childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
									<span class="nx">@removeChild</span> <span class="nx">@childNodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

				<span class="nv">append: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .append(/n/) - insert /n/ [or a clone] as the last child of each node</span>
					<span class="nv">x = </span><span class="nx">toNode</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="c1"># parse, cast, do whatever it takes to get a Node or Fragment</span>
					<span class="nx">@each</span> <span class="o">-&gt;</span> <span class="nx">@appendChild</span> <span class="nx">x</span><span class="p">.</span><span class="nx">cloneNode</span> <span class="kc">true</span>

				<span class="nv">appendTo: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .appendTo(/n/) - each node [or fragment] will become the last child of x</span>
					<span class="nv">clones = </span><span class="nx">@map</span><span class="p">(</span> <span class="o">-&gt;</span> <span class="nx">@cloneNode</span> <span class="kc">true</span><span class="p">)</span>
					<span class="nv">i = </span><span class="mi">0</span>
					<span class="nx">$</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="nx">@appendChild</span> <span class="nx">clones</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span>
					<span class="nx">clones</span>

				<span class="nv">prepend: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .prepend(/n/) - insert n [or a clone] as the first child of each node</span>
					<span class="k">if</span> <span class="nx">x</span><span class="o">?</span>
						<span class="nv">x = </span><span class="nx">toNode</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
						<span class="nx">@take</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
							<span class="nx">before</span> <span class="nx">@childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">x</span>
						<span class="nx">@skip</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
							<span class="nx">before</span> <span class="nx">@childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">x</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
					<span class="nx">@</span>

				<span class="nv">prependTo: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .prependTo(/n/) - each node [or a fragment] will become the first child of x</span>
					<span class="k">if</span> <span class="nx">x</span><span class="o">?</span>
						<span class="nx">$</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>
					<span class="nx">@</span>

				<span class="nv">before: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .before(/x/) - insert content x before each node</span>
					<span class="k">if</span> <span class="nx">x</span><span class="o">?</span>
						<span class="nv">x = </span><span class="nx">toNode</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
						<span class="nx">@take</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="nx">before</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">x</span>
						<span class="nx">@skip</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="nx">before</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
					<span class="nx">@</span>

				<span class="nv">after: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .after(/n/) - insert content n after each node</span>
					<span class="k">if</span> <span class="nx">x</span><span class="o">?</span>
						<span class="nv">x = </span><span class="nx">toNode</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
						<span class="nx">@take</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="nx">after</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">x</span>
						<span class="nx">@skip</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="nx">after</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
					<span class="nx">@</span>

				<span class="nv">wrap: </span><span class="nf">(parent) -&gt;</span> <span class="c1"># .wrap(/p/) - p becomes the new .parentNode of each node</span></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>all items of @ will become children of parent
parent will take each child's position in the DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nv">parent = </span><span class="nx">toNode</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;fragment&quot;</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span>
						<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;cannot wrap with a fragment&quot;</span><span class="p">)</span>
					<span class="nx">@each</span> <span class="nf">(child) -&gt;</span>
						<span class="k">switch</span> <span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span>
							<span class="k">when</span> <span class="s">&quot;fragment&quot;</span>
								<span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span>
							<span class="k">when</span> <span class="s">&quot;node&quot;</span>
								<span class="nv">p = </span><span class="nx">child</span><span class="p">.</span><span class="nx">parentNode</span>
								<span class="k">if</span> <span class="o">not</span> <span class="nx">p</span>
									<span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span>
								<span class="k">else</span> <span class="c1"># swap out the DOM nodes using a placeholder element</span>
									<span class="nv">marker = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;dummy&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>put a marker in the DOM, put removed node in new parent</p>             </td>             <td class="code">               <div class="highlight"><pre>									<span class="nx">parent</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">p</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">marker</span><span class="p">,</span> <span class="nx">child</span><span class="p">)</span> <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>replace marker with new parent</p>             </td>             <td class="code">               <div class="highlight"><pre>									<span class="nx">p</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">marker</span><span class="p">)</span>

				<span class="nv">unwrap: </span><span class="o">-&gt;</span> <span class="c1"># .unwrap() - replace each node&#39;s parent with itself</span>
					<span class="nx">@each</span> <span class="o">-&gt;</span>
						<span class="k">if</span> <span class="nx">@parentNode</span> <span class="o">and</span> <span class="nx">@parentNode</span><span class="p">.</span><span class="nx">parentNode</span>
							<span class="nx">@parentNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">@parentNode</span><span class="p">)</span>
						<span class="k">else</span> <span class="k">if</span> <span class="nx">@parentNode</span>
							<span class="nx">@parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span>

				<span class="nv">replace: </span><span class="nf">(n) -&gt;</span> <span class="c1"># .replace(/n/) - replace each node with n [or a clone]</span>
					<span class="nv">n = </span><span class="nx">toNode</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
					<span class="nv">b = </span><span class="nx">$</span><span class="p">()</span>
					<span class="nv">j = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>first node gets the real n</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">@take</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
						<span class="nx">@parentNode</span><span class="o">?</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
						<span class="nx">b</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">n</span></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>the rest get clones of n</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">@skip</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
						<span class="nv">c = </span><span class="nx">n</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
						<span class="nx">@parentNode</span><span class="o">?</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span>
						<span class="nx">b</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>the set of inserted nodes</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">b</span>

				<span class="nv">attr: </span><span class="nf">(a,v) -&gt;</span> <span class="c1"># .attr(a, [v]) - get [or set] an /a/ttribute [/v/alue]</span>
					<span class="k">switch</span> <span class="nx">v</span>
						<span class="k">when</span> <span class="kc">undefined</span>
							<span class="k">return</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&quot;getAttribute&quot;</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
						<span class="k">when</span> <span class="kc">null</span>
							<span class="k">return</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&quot;removeAttribute&quot;</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
						<span class="k">else</span>
							<span class="nx">@select</span><span class="p">(</span><span class="s">&quot;setAttribute&quot;</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
							<span class="k">return</span> <span class="nx">@</span>

				<span class="nv">data: </span><span class="nf">(k, v) -&gt;</span>
					<span class="nv">k = </span><span class="s">&quot;data-</span><span class="si">#{</span><span class="nx">$</span><span class="p">.</span><span class="nx">dashize</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
					<span class="nx">@attr</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>

				<span class="nv">addClass: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .addClass(/x/) - add x to each node&#39;s .className</span>
					<span class="nx">@removeClass</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
						<span class="nv">c = </span><span class="nx">@className</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">).</span><span class="nx">filter</span> <span class="nf">(y) -&gt;</span>
							<span class="nx">y</span> <span class="o">isnt</span> <span class="s">&quot;&quot;</span>
						<span class="nx">c</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="c1"># since we dont know the len, its still faster to push, rather than insert at len()</span>
						<span class="vi">@className = </span><span class="nx">c</span><span class="p">.</span><span class="nx">join</span> <span class="s">&quot; &quot;</span>

				<span class="nv">removeClass: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .removeClass(/x/) - remove class x from each node&#39;s .className</span>
					<span class="nv">notx = </span><span class="nf">(y)-&gt;</span> <span class="nx">y</span> <span class="o">!=</span> <span class="nx">x</span>
					<span class="nx">@each</span> <span class="o">-&gt;</span>
						<span class="nv">c = </span><span class="nx">@className</span><span class="o">?</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">notx</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
						<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
							<span class="nx">@removeAttribute</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">)</span>

				<span class="nv">toggleClass: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .toggleClass(/x/) - add, or remove if present, class x from each node</span>
					<span class="nv">notx = </span><span class="nf">(y) -&gt;</span> <span class="nx">y</span> <span class="o">isnt</span> <span class="nx">x</span>
					<span class="nx">@each</span> <span class="o">-&gt;</span>
						<span class="nv">cls = </span><span class="nx">@className</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
						<span class="nv">filter = </span><span class="nx">$</span><span class="p">.</span><span class="o">not</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isEmpty</span>
						<span class="k">if</span><span class="p">(</span> <span class="nx">cls</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
							<span class="nv">filter = </span><span class="nx">$</span><span class="p">.</span><span class="o">and</span> <span class="nx">notx</span><span class="p">,</span> <span class="nx">filter</span>
						<span class="k">else</span>
							<span class="nx">cls</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
						<span class="nv">c = </span><span class="nx">cls</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filter</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
						<span class="vi">@className = </span><span class="nx">c</span>
						<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span>
							<span class="nx">@removeAttribute</span><span class="p">(</span><span class="s">&#39;class&#39;</span><span class="p">)</span>

				<span class="nv">hasClass: </span><span class="nf">(x) -&gt;</span> <span class="c1"># .hasClass(/x/) - true/false for each node: whether .className contains x</span>
					<span class="nx">@select</span><span class="p">(</span><span class="s">&#39;className.split&#39;</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s">&#39;indexOf&#39;</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">x</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(x) -&gt;</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>

				<span class="nv">text: </span><span class="nf">(t) -&gt;</span> <span class="c1"># .text([t]) - get [or set] each node&#39;s .textContent</span>
					<span class="k">return</span> <span class="nx">@zap</span><span class="p">(</span><span class="s">&#39;textContent&#39;</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="k">if</span> <span class="nx">t</span><span class="o">?</span>
					<span class="k">return</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&#39;textContent&#39;</span><span class="p">)</span>

				<span class="nv">val: </span><span class="nf">(v) -&gt;</span> <span class="c1"># .val([v]) - get [or set] each node&#39;s .value</span>
					<span class="k">return</span> <span class="nx">@zap</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="nx">v</span><span class="o">?</span>
					<span class="k">return</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>Get [or set] css properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">css: </span><span class="nf">(k,v) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>If we are doing assignment.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span> <span class="nx">v</span><span class="o">?</span> <span class="o">or</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="nx">k</span></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>Use a bound-method to do the assignment for us.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nv">setter = </span><span class="nx">@select</span> <span class="s">&#39;style.setProperty&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>If you give an object as a key, then use every k:v pair.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="nx">k</span> <span class="k">then</span> <span class="nx">setter</span><span class="p">.</span><span class="nx">call</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">k</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">k</span></pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>So, the key is simple, and if the value is a string,
just do simple assignment (using setProperty).</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">else</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="nx">v</span> <span class="k">then</span> <span class="nx">setter</span><span class="p">.</span><span class="nx">call</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>If the value was actually an array of values, then
stripe the values across each item.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">else</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;array&quot;</span><span class="p">,</span> <span class="nx">v</span>
							<span class="nx">setter</span><span class="p">[</span><span class="nx">i</span><span class="o">%</span><span class="nx">nn</span><span class="p">]</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span><span class="p">[</span><span class="nx">i</span><span class="o">%</span><span class="nx">n</span><span class="p">],</span> <span class="s">&quot;&quot;</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nv">n = </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nv">nn = </span><span class="nx">setter</span><span class="p">.</span><span class="nx">len</span><span class="p">()]</span>
						<span class="k">return</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>Else, we are reading CSS properties.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>So, collect the full computed values.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nv">cv = </span><span class="nx">@map</span> <span class="nx">computeCSSProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>Then, collect the values specified directly on the node.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nv">ov = </span><span class="nx">@select</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">).</span><span class="nx">select</span> <span class="nx">k</span></pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>Weave and fold them so that object values override
computed values.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">ov</span><span class="p">.</span><span class="nx">weave</span><span class="p">(</span><span class="nx">cv</span><span class="p">).</span><span class="nx">fold</span> <span class="nf">(x,y) -&gt;</span> <span class="nx">x</span> <span class="o">or</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>Set css properties by injecting a style element in the the
head. If <em>k</em> is an object of k:v pairs, then no second argument is needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">defaultCss: </span><span class="nf">(k, v) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>@selector need not match any nodes at the time of the call.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nv">sel = </span><span class="nx">@selector</span>
					<span class="nv">style = </span><span class="s">&quot;&quot;</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="nx">k</span>
						<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="nx">v</span>
							<span class="nx">style</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">sel</span><span class="si">}</span><span class="s"> { </span><span class="si">#{</span><span class="nx">k</span><span class="si">}</span><span class="s">: </span><span class="si">#{</span><span class="nx">v</span><span class="si">}</span><span class="s"> } &quot;</span>
						<span class="k">else</span> <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;defaultCss requires a value with a string key&quot;</span><span class="p">)</span>
					<span class="k">else</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="nx">k</span>
						<span class="nx">style</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">sel</span><span class="si">}</span><span class="s"> { &quot;</span> <span class="o">+</span>
							<span class="s">&quot;</span><span class="si">#{</span><span class="nx">i</span><span class="si">}</span><span class="s">: </span><span class="si">#{</span><span class="nx">k</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="si">}</span><span class="s">; &quot;</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">k</span> <span class="o">+</span>
						<span class="s">&quot;} &quot;</span>
					<span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;style&gt;&lt;/style&gt;&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">style</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s">&quot;head&quot;</span><span class="p">)</span>
					<span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>Get a bounding-box for each item.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">rect: </span><span class="o">-&gt;</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&#39;getBoundingClientRect&#39;</span><span class="p">).</span><span class="nx">call</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>Get [or set] each item's width.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">width: </span><span class="nx">getOrSetRect</span><span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>Get [or set] each item's height.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">height: </span><span class="nx">getOrSetRect</span><span class="p">(</span><span class="s">&quot;height&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>Get [or set] each item's top.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">top: </span><span class="nx">getOrSetRect</span><span class="p">(</span><span class="s">&quot;top&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>Get [or set] each item's left.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">left: </span><span class="nx">getOrSetRect</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>Get [or set] each item's bottom.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">bottom: </span><span class="nx">getOrSetRect</span><span class="p">(</span><span class="s">&quot;bottom&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>Get [or set] each item's right.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">right: </span><span class="nx">getOrSetRect</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>Get [or set] each item's position.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">position: </span><span class="nf">(left, top) -&gt;</span>
					<span class="k">switch</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>If called with no arguments, just return the position.</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">when</span> <span class="o">not</span> <span class="nx">left</span><span class="o">?</span> <span class="k">then</span> <span class="nx">@rect</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>If called with only one argument, only set "left".</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">when</span> <span class="o">not</span> <span class="nx">top</span><span class="o">?</span> <span class="k">then</span> <span class="nx">@css</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">px</span><span class="p">(</span><span class="nx">left</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>If called with both arguments, set "top" and "left".</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">else</span> <span class="nx">@css</span><span class="p">({</span><span class="nv">top: </span><span class="nx">$</span><span class="p">.</span><span class="nx">px</span><span class="p">(</span><span class="nx">top</span><span class="p">),</span> <span class="nv">left: </span><span class="nx">$</span><span class="p">.</span><span class="nx">px</span><span class="p">(</span><span class="nx">left</span><span class="p">)})</span></pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>Adjust the document's scroll position so the first node in
<em>this</em> is centered in the viewport.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">scrollToCenter: </span><span class="o">-&gt;</span>
					<span class="nb">document</span><span class="p">.</span><span class="nv">body.scrollTop = </span><span class="nx">@</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetTop</span> <span class="o">-</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
					<span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>Get the <em>n-th</em> child from each node in <em>this</em>.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">child: </span><span class="nf">(n) -&gt;</span> <span class="nx">@select</span><span class="p">(</span><span class="s">&#39;childNodes&#39;</span><span class="p">).</span><span class="nx">map</span> <span class="o">-&gt;</span> <span class="nx">@</span><span class="p">[</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">then</span> <span class="p">(</span><span class="nx">n</span><span class="o">+</span><span class="nx">@length</span><span class="p">)</span> <span class="k">else</span> <span class="nx">n</span> <span class="p">]</span>

				<span class="nv">parents: </span><span class="o">-&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nv">p = </span><span class="nx">@</span><span class="p">;</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">p</span> <span class="k">while</span> <span class="nv">p = </span><span class="nx">p</span><span class="o">?</span><span class="p">.</span><span class="nx">parentNode</span> <span class="p">)</span> <span class="c1"># .parents() - collects the full ancestry up to the owner</span>

				<span class="nv">prev: </span><span class="o">-&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nv">p = </span><span class="nx">@</span><span class="p">;</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">p</span> <span class="k">while</span> <span class="nv">p = </span><span class="nx">p</span><span class="o">?</span><span class="p">.</span><span class="nx">previousSibling</span> <span class="p">)</span> <span class="c1"># .prev() - collects the chain of .previousSibling nodes</span>

				<span class="nv">next: </span><span class="o">-&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="nv">p = </span><span class="nx">@</span><span class="p">;</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">p</span> <span class="k">while</span> <span class="nv">p = </span><span class="nx">p</span><span class="o">?</span><span class="p">.</span><span class="nx">nextSibling</span> <span class="p">)</span> <span class="c1"># .next() - collect the chain of .nextSibling nodes</span>

				<span class="nv">remove: </span><span class="o">-&gt;</span> <span class="nx">@each</span> <span class="o">-&gt;</span> <span class="nx">@parentNode</span><span class="o">?</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span> <span class="c1"># .remove() - removes each node in _this_ from the DOM</span>

				<span class="nv">find: </span><span class="nf">(css) -&gt;</span> <span class="c1"># .find(/css/) - collect nodes matching /css/</span>
					<span class="nx">@filter</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">)</span> <span class="c1"># limit to only DOM nodes</span>
						<span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="o">-&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">css</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span> <span class="p">)</span>
						<span class="p">.</span><span class="nx">flatten</span><span class="p">()</span>

				<span class="nv">clone: </span><span class="nf">(deep=true) -&gt;</span> <span class="nx">@map</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">@cloneNode</span> <span class="nx">deep</span><span class="p">)</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;node&quot;</span><span class="p">,</span> <span class="nx">@</span> <span class="c1"># .clone(deep=true) - copies a set of DOM nodes</span>

				<span class="nv">toFragment: </span><span class="o">-&gt;</span>
					<span class="k">if</span> <span class="nx">@length</span> <span class="o">&gt;</span> <span class="mi">1</span>
						<span class="nv">df = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">()</span>
						<span class="nx">@map</span><span class="p">(</span><span class="nx">toNode</span><span class="p">).</span><span class="nx">map</span> <span class="nx">$</span><span class="p">.</span><span class="nx">bound</span> <span class="nx">df</span><span class="p">,</span> <span class="nx">df</span><span class="p">.</span><span class="nx">appendChild</span>
						<span class="k">return</span> <span class="nx">df</span>
					<span class="k">return</span> <span class="nx">toNode</span><span class="p">(</span><span class="nx">@</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <h2>Transform plugin</h2>

<p>For accelerated animations.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">depends: </span><span class="s">&quot;dom&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">COMMASEP = </span><span class="s">&quot;, &quot;</span>
		<span class="nv">speeds = </span><span class="c1"># constant speed names</span>
			<span class="s">&quot;slow&quot;</span><span class="o">:</span> <span class="mi">700</span>
			<span class="s">&quot;medium&quot;</span><span class="o">:</span> <span class="mi">500</span>
			<span class="s">&quot;normal&quot;</span><span class="o">:</span> <span class="mi">300</span>
			<span class="s">&quot;fast&quot;</span><span class="o">:</span> <span class="mi">100</span>
			<span class="s">&quot;instant&quot;</span><span class="o">:</span> <span class="mi">0</span>
			<span class="s">&quot;now&quot;</span><span class="o">:</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>               <p>matches all the accelerated css property names</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">accel_props_re = </span><span class="sr">/(?:scale(?:3d)*|translate(?:[XYZ]|3d)*|rotate(?:[XYZ]|3d)*)/</span>
		<span class="nv">updateDelay = </span><span class="mi">30</span> <span class="c1"># ms to wait for DOM changes to apply</span>
		<span class="nv">testStyle = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">).</span><span class="nx">style</span>

		<span class="nv">transformProperty = </span><span class="s">&quot;transform&quot;</span>
		<span class="nv">transitionProperty = </span><span class="s">&quot;transition-property&quot;</span>
		<span class="nv">transitionDuration = </span><span class="s">&quot;transition-duration&quot;</span>
		<span class="nv">transitionTiming = </span><span class="s">&quot;transition-timing-function&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <p>detect which browser's transform properties to use</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="s">&quot;WebkitTransform&quot;</span> <span class="k">of</span> <span class="nx">testStyle</span>
			<span class="nv">transformProperty = </span><span class="s">&quot;-webkit-transform&quot;</span>
			<span class="nv">transitionProperty = </span><span class="s">&quot;-webkit-transition-property&quot;</span>
			<span class="nv">transitionDuration = </span><span class="s">&quot;-webkit-transition-duration&quot;</span>
			<span class="nv">transitionTiming = </span><span class="s">&quot;-webkit-transition-timing-function&quot;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="s">&quot;MozTransform&quot;</span> <span class="k">of</span> <span class="nx">testStyle</span>
			<span class="nv">transformProperty = </span><span class="s">&quot;-moz-transform&quot;</span>
			<span class="nv">transitionProperty = </span><span class="s">&quot;-moz-transition-property&quot;</span>
			<span class="nv">transitionDuration = </span><span class="s">&quot;-moz-transition-duration&quot;</span>
			<span class="nv">transitionTiming = </span><span class="s">&quot;-moz-transition-timing-function&quot;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="s">&quot;OTransform&quot;</span> <span class="k">of</span> <span class="nx">testStyle</span>
			<span class="nv">transformProperty = </span><span class="s">&quot;-o-transform&quot;</span>
			<span class="nv">transitionProperty = </span><span class="s">&quot;-o-transition-property&quot;</span>
			<span class="nv">transitionDuration = </span><span class="s">&quot;-o-transition-duration&quot;</span>
			<span class="nv">transitionTiming = </span><span class="s">&quot;-o-transition-timing-function&quot;</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span></pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>$.duration(/s/) - given a speed description (string|number), return a number in milliseconds</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">duration: </span><span class="nf">(speed) -&gt;</span>
					<span class="nv">d = </span><span class="nx">speeds</span><span class="p">[</span><span class="nx">speed</span><span class="p">]</span>
					<span class="k">return</span> <span class="nx">d</span> <span class="k">if</span> <span class="nx">d</span><span class="o">?</span>
					<span class="k">return</span> <span class="nb">parseFloat</span> <span class="nx">speed</span></pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <p>.transform(css, [/speed/], [/callback/]) - animate css properties on each node</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nv">transform: </span><span class="nf">(end_css, speed, easing, callback) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>animate css properties over a duration
accelerated: scale, translate, rotate, scale3d,
... translateX, translateY, translateZ, translate3d,
... rotateX, rotateY, rotateZ, rotate3d
easing values (strings): ease | linear | ease-in | ease-out
| ease-in-out | step-start | step-end | steps(number[, start | end ])
| cubic-bezier(number, number, number, number)</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nx">speed</span><span class="p">)</span>
					<span class="nv">callback = </span><span class="nx">speed</span>
					<span class="nv">speed = easing = </span><span class="kc">null</span>
				<span class="k">else</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nx">easing</span><span class="p">)</span>
					<span class="nv">callback = </span><span class="nx">easing</span>
					<span class="nv">easing = </span><span class="kc">null</span>
				<span class="nx">speed</span> <span class="o">?=</span> <span class="s">&quot;normal&quot;</span>
				<span class="nx">easing</span> <span class="o">or=</span> <span class="s">&quot;ease&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>duration is always in milliseconds</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">duration = </span><span class="nx">$</span><span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="nx">speed</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;ms&quot;</span>
				<span class="nv">props = </span><span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <p><code>trans</code> is what will be assigned to -webkit-transform</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">trans = </span><span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <p>real css values to be set (end_css without the transform values)</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">css = </span><span class="p">{}</span>
				<span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">end_css</span></pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <p>pull all the accelerated values out of end_css</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span> <span class="nx">accel_props_re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
						<span class="nv">ii = </span><span class="nx">end_css</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
						<span class="k">if</span> <span class="nx">ii</span><span class="p">.</span><span class="nx">join</span>
							<span class="nv">ii = </span><span class="nx">$</span><span class="p">(</span><span class="nx">ii</span><span class="p">).</span><span class="nx">px</span><span class="p">().</span><span class="nx">join</span> <span class="nx">COMMASEP</span>
						<span class="k">else</span> <span class="k">if</span> <span class="nx">ii</span><span class="p">.</span><span class="nx">toString</span>
							<span class="nv">ii = </span><span class="nx">ii</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
						<span class="nx">trans</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="nx">ii</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>stick real css values in the css dict</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">else</span> <span class="nx">css</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">end_css</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>make a list of the properties to be modified</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">push</span> <span class="nx">i</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">css</span></pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>and include -webkit-transform if we have transform values to set</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="nx">trans</span>
					<span class="nx">props</span><span class="p">.</span><span class="nx">push</span> <span class="nx">transformProperty</span></pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>sets a list of properties to apply a duration to</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">css</span><span class="p">[</span><span class="nx">transitionProperty</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">join</span> <span class="nx">COMMASEP</span></pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>apply the same duration to each property</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">css</span><span class="p">[</span><span class="nx">transitionDuration</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="o">-&gt;</span> <span class="nx">duration</span><span class="p">).</span><span class="nx">join</span> <span class="nx">COMMASEP</span></pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>               <p>apply an easing function to each property</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">css</span><span class="p">[</span><span class="nx">transitionTiming</span><span class="p">]</span> <span class="o">=</span> <span class="nx">props</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="o">-&gt;</span> <span class="nx">easing</span><span class="p">).</span><span class="nx">join</span> <span class="nx">COMMASEP</span></pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>               <p>apply the transformation</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="nx">trans</span>
					<span class="nx">css</span><span class="p">[</span><span class="nx">transformProperty</span><span class="p">]</span> <span class="o">=</span> <span class="nx">trans</span></pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <p>apply the css to the actual node</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">@css</span> <span class="nx">css</span></pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>queue the callback to be executed at the end of the animation
WARNING: NOT EXACT!</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">@delay</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">callback</span>

			<span class="nv">hide: </span><span class="nf">(callback) -&gt;</span> <span class="c1"># .hide() - each node gets display:none</span>
				<span class="nx">@each</span> <span class="o">-&gt;</span>
					<span class="k">if</span> <span class="nx">@style</span>
						<span class="vi">@_display = </span><span class="s">&quot;&quot;</span> <span class="c1"># stash the old display</span>
						<span class="k">if</span> <span class="nx">@style</span><span class="p">.</span><span class="nx">display</span> <span class="o">is</span> <span class="o">not</span> <span class="s">&quot;none&quot;</span>
							<span class="vi">@_display = </span><span class="nx">@syle</span><span class="p">.</span><span class="nx">display</span>
						<span class="vi">@style.display = </span><span class="s">&quot;none&quot;</span>
				<span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;hide&quot;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">delay</span> <span class="nx">updateDelay</span><span class="p">,</span> <span class="nx">callback</span>

			<span class="nv">show: </span><span class="nf">(callback) -&gt;</span> <span class="c1"># .show() - show each node</span>
				<span class="nx">@each</span> <span class="o">-&gt;</span>
					<span class="k">if</span> <span class="nx">@style</span>
						<span class="vi">@style.display = </span><span class="nx">@_display</span>
						<span class="k">delete</span> <span class="nx">@_display</span>
				<span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">delay</span> <span class="nx">updateDelay</span><span class="p">,</span> <span class="nx">callback</span>

			<span class="nv">toggle: </span><span class="nf">(callback) -&gt;</span> <span class="c1"># .toggle() - show each hidden node, hide each visible one</span>
				<span class="nx">@weave</span><span class="p">(</span><span class="nx">@css</span><span class="p">(</span><span class="s">&quot;display&quot;</span><span class="p">))</span>
					<span class="p">.</span><span class="nx">fold</span> <span class="nf">(display, node) -&gt;</span>
						<span class="k">if</span> <span class="nx">display</span> <span class="o">is</span> <span class="s">&quot;none&quot;</span>
							<span class="nv">node.style.display = </span><span class="nx">node</span><span class="p">.</span><span class="nx">_display</span> <span class="o">or</span> <span class="s">&quot;&quot;</span>
							<span class="k">delete</span> <span class="nx">node</span><span class="p">.</span><span class="nx">_display</span>
							<span class="nx">$</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&quot;show&quot;</span>
						<span class="k">else</span>
							<span class="nv">node._display = </span><span class="nx">display</span>
							<span class="nv">node.style.display = </span><span class="s">&quot;none&quot;</span>
							<span class="nx">$</span><span class="p">(</span><span class="nx">node</span><span class="p">).</span><span class="nx">trigger</span> <span class="s">&quot;hide&quot;</span>
						<span class="nx">node</span>
					<span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="nx">updateDelay</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>

			<span class="nv">fadeIn: </span><span class="nf">(speed, callback) -&gt;</span> <span class="c1"># .fadeIn() - fade each node to opacity 1.0</span>
				<span class="nx">@</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s">&#39;opacity&#39;</span><span class="p">,</span><span class="s">&#39;0.0&#39;</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">show</span> <span class="o">-&gt;</span>
						<span class="nx">@transform</span> <span class="p">{</span>
							<span class="nx">opacity</span><span class="o">:</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span>
							<span class="nv">translate3d: </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
						<span class="p">},</span> <span class="nx">speed</span><span class="p">,</span> <span class="nx">callback</span>
			<span class="nv">fadeOut: </span><span class="nf">(speed, callback, x = 0.0, y = 0.0) -&gt;</span> <span class="c1"># .fadeOut() - fade each node to opacity:0.0</span>
				<span class="nx">@transform</span> <span class="p">{</span>
					<span class="nx">opacity</span><span class="o">:</span><span class="s">&quot;0.0&quot;</span><span class="p">,</span>
					<span class="nx">translate3d</span><span class="o">:</span><span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
				<span class="p">},</span> <span class="nx">speed</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="nx">@hide</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span>
			<span class="nv">fadeLeft: </span><span class="nf">(speed, callback) -&gt;</span> <span class="nx">@fadeOut</span> <span class="nx">speed</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="o">+</span><span class="nx">@width</span><span class="p">().</span><span class="nx">first</span><span class="p">(),</span> <span class="mf">0.0</span>
			<span class="nv">fadeRight: </span><span class="nf">(speed, callback) -&gt;</span> <span class="nx">@fadeOut</span> <span class="nx">speed</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">@width</span><span class="p">().</span><span class="nx">first</span><span class="p">(),</span> <span class="mf">0.0</span>
			<span class="nv">fadeUp: </span><span class="nf">(speed, callback) -&gt;</span> <span class="nx">@fadeOut</span> <span class="nx">speed</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="o">+</span><span class="nx">@height</span><span class="p">().</span><span class="nx">first</span><span class="p">()</span>
			<span class="nv">fadeDown: </span><span class="nf">(speed, callback)  -&gt;</span> <span class="nx">@fadeOut</span> <span class="nx">speed</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nx">@height</span><span class="p">().</span><span class="nx">first</span><span class="p">()</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <h2>HTTP Plugin</h2>

<p>Things like <code>.ajax()</code>, <code>.get()</code>, <code>$.post()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">depends: </span><span class="s">&quot;dom&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">formencode = </span><span class="nf">(obj) -&gt;</span> <span class="c1"># create &amp;foo=bar strings from object properties</span>
			<span class="nv">o = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj</span><span class="p">))</span> <span class="c1"># quickly remove all non-stringable items</span>
			<span class="p">(</span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">i</span><span class="si">}</span><span class="s">=</span><span class="si">#{</span><span class="nx">escape</span> <span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">o</span><span class="p">).</span><span class="nx">join</span> <span class="s">&quot;&amp;&quot;</span>

		<span class="nx">$</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">register</span> <span class="s">&quot;http&quot;</span><span class="p">,</span>
			<span class="nv">match: </span><span class="nf">(o) -&gt;</span> <span class="nx">$</span><span class="p">.</span><span class="nx">isType</span> <span class="s">&#39;XMLHttpRequest&#39;</span><span class="p">,</span> <span class="nx">o</span>
			<span class="nv">array: </span><span class="nf">(o) -&gt;</span> <span class="p">[</span><span class="nx">o</span><span class="p">]</span>

		<span class="k">return</span> <span class="p">{</span>
			<span class="nv">$:</span></pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>$.http(/url/, [/opts/]) - fetch /url/ using HTTP (method in /opts/)</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">http: </span><span class="nf">(url, opts = {}) -&gt;</span>
					<span class="nv">xhr = </span><span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nx">opts</span><span class="p">)</span>
						<span class="nv">opts = success: </span><span class="nx">$</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span>
					<span class="nv">opts = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span>
						<span class="nv">method: </span><span class="s">&quot;GET&quot;</span>
						<span class="nv">data: </span><span class="kc">null</span>
						<span class="nv">state: </span><span class="nx">$</span><span class="p">.</span><span class="nx">identity</span> <span class="c1"># onreadystatechange</span>
						<span class="nv">success: </span><span class="nx">$</span><span class="p">.</span><span class="nx">identity</span> <span class="c1"># onload</span>
						<span class="nv">error: </span><span class="nx">$</span><span class="p">.</span><span class="nx">identity</span> <span class="c1"># onerror</span>
						<span class="nv">async: </span><span class="kc">true</span>
						<span class="nv">asBlob: </span><span class="kc">false</span>
						<span class="nv">timeout: </span><span class="mi">0</span> <span class="c1"># milliseconds, 0 is forever</span>
						<span class="nv">followRedirects: </span><span class="kc">false</span>
						<span class="nv">withCredentials: </span><span class="kc">false</span>
					<span class="p">},</span> <span class="nx">opts</span>
					<span class="nv">opts.state = </span><span class="nx">$</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>
					<span class="nv">opts.success = </span><span class="nx">$</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span>
					<span class="nv">opts.error = </span><span class="nx">$</span><span class="p">.</span><span class="nx">bound</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
					<span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">data</span> <span class="o">and</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">method</span> <span class="o">is</span> <span class="s">&quot;GET&quot;</span>
						<span class="nx">url</span> <span class="o">+=</span> <span class="s">&quot;?&quot;</span> <span class="o">+</span> <span class="nx">formencode</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
					<span class="k">else</span> <span class="k">if</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">data</span> <span class="o">and</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">method</span> <span class="o">is</span> <span class="s">&quot;POST&quot;</span>
						<span class="nv">opts.data = </span><span class="nx">formencode</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
					<span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">method</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">async</span><span class="p">)</span>
					<span class="nv">xhr = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">xhr</span><span class="p">,</span>
						<span class="nv">asBlob: </span><span class="nx">opts</span><span class="p">.</span><span class="nx">asBlob</span>
						<span class="nv">timeout: </span><span class="nx">opts</span><span class="p">.</span><span class="nx">timeout</span>
						<span class="nv">followRedirects: </span><span class="nx">opts</span><span class="p">.</span><span class="nx">followRedirects</span>
						<span class="nv">withCredentials: </span><span class="nx">opts</span><span class="p">.</span><span class="nx">withCredentials</span>
						<span class="nv">onreadystatechange: </span><span class="o">-&gt;</span>
							<span class="nx">opts</span><span class="p">.</span><span class="nx">state</span><span class="o">?</span><span class="p">()</span>
							<span class="k">if</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">is</span> <span class="mi">4</span>
								<span class="k">if</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">is</span> <span class="mi">200</span>
									<span class="nx">opts</span><span class="p">.</span><span class="nx">success</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span>
								<span class="k">else</span>
									<span class="nx">opts</span><span class="p">.</span><span class="nx">error</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span>
					<span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">data</span>
					<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>$.post(/url/, [/opts/]) - fetch /url/ with a POST request</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">post: </span><span class="nf">(url, opts = {}) -&gt;</span>
					<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nx">opts</span><span class="p">)</span>
						<span class="nv">opts = success: </span><span class="nx">opts</span>
					<span class="nv">opts.method = </span><span class="s">&quot;POST&quot;</span>
					<span class="nx">$</span><span class="p">.</span><span class="nx">http</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>$.get(/url/, [/opts/]) - fetch /url/ with a GET request</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">get: </span><span class="nf">(url, opts = {}) -&gt;</span>
					<span class="k">if</span><span class="p">(</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">,</span><span class="nx">opts</span><span class="p">)</span> <span class="p">)</span>
						<span class="nv">opts = success: </span><span class="nx">opts</span>
					<span class="nv">opts.method = </span><span class="s">&quot;GET&quot;</span>
					<span class="nx">$</span><span class="p">.</span><span class="nx">http</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <h2>Events plugin</h2>

<p>Things like <code>.bind()</code>, <code>.trigger()</code>, etc.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">depends: </span><span class="s">&quot;dom,function,core&quot;</span>
		<span class="nv">provides: </span><span class="s">&quot;event&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">EVENTSEP_RE = </span><span class="sr">/,* +/</span>
		<span class="nv">events = </span><span class="p">[</span><span class="s">&#39;mousemove&#39;</span><span class="p">,</span><span class="s">&#39;mousedown&#39;</span><span class="p">,</span><span class="s">&#39;mouseup&#39;</span><span class="p">,</span><span class="s">&#39;mouseover&#39;</span><span class="p">,</span><span class="s">&#39;mouseout&#39;</span><span class="p">,</span><span class="s">&#39;blur&#39;</span><span class="p">,</span><span class="s">&#39;focus&#39;</span><span class="p">,</span>
			<span class="s">&#39;load&#39;</span><span class="p">,</span><span class="s">&#39;unload&#39;</span><span class="p">,</span><span class="s">&#39;reset&#39;</span><span class="p">,</span><span class="s">&#39;submit&#39;</span><span class="p">,</span><span class="s">&#39;keyup&#39;</span><span class="p">,</span><span class="s">&#39;keydown&#39;</span><span class="p">,</span><span class="s">&#39;change&#39;</span><span class="p">,</span>
			<span class="s">&#39;abort&#39;</span><span class="p">,</span><span class="s">&#39;cut&#39;</span><span class="p">,</span><span class="s">&#39;copy&#39;</span><span class="p">,</span><span class="s">&#39;paste&#39;</span><span class="p">,</span><span class="s">&#39;selection&#39;</span><span class="p">,</span><span class="s">&#39;drag&#39;</span><span class="p">,</span><span class="s">&#39;drop&#39;</span><span class="p">,</span><span class="s">&#39;orientationchange&#39;</span><span class="p">,</span>
			<span class="s">&#39;touchstart&#39;</span><span class="p">,</span><span class="s">&#39;touchmove&#39;</span><span class="p">,</span><span class="s">&#39;touchend&#39;</span><span class="p">,</span><span class="s">&#39;touchcancel&#39;</span><span class="p">,</span>
			<span class="s">&#39;gesturestart&#39;</span><span class="p">,</span><span class="s">&#39;gestureend&#39;</span><span class="p">,</span><span class="s">&#39;gesturecancel&#39;</span><span class="p">,</span>
			<span class="s">&#39;hashchange&#39;</span>
		<span class="p">]</span> <span class="c1"># &#39;click&#39; is handled specially</span>

		<span class="nv">binder = </span><span class="nf">(e) -&gt;</span> <span class="nf">(f) -&gt;</span> <span class="nx">@bind</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;function&quot;</span><span class="p">,</span> <span class="nx">f</span> <span class="k">else</span> <span class="nx">@trigger</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>

		<span class="nv">register_live = </span><span class="nf">(selector, context, evt, f, h) -&gt;</span>
			<span class="nx">$</span><span class="p">(</span><span class="nx">context</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>set/create all of @<strong>alive</strong>[selector][evt][f]</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="p">(((</span><span class="nx">@__alive__</span> <span class="o">or=</span> <span class="p">{})[</span><span class="nx">selector</span><span class="p">]</span> <span class="o">or=</span> <span class="p">{})[</span><span class="nx">evt</span><span class="p">]</span> <span class="o">or=</span> <span class="p">{})[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="nx">h</span>

		<span class="nv">unregister_live = </span><span class="nf">(selector, context, e, f) -&gt;</span>
			<span class="nv">$c = </span><span class="nx">$</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span>
			<span class="nx">$c</span><span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span>
				<span class="nv">a = </span><span class="p">(</span><span class="nx">@__alive__</span> <span class="o">or=</span> <span class="p">{})</span>
				<span class="nv">b = </span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">selector</span><span class="p">]</span> <span class="o">or=</span> <span class="p">{})</span>
				<span class="nv">c = </span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">or=</span> <span class="p">{})</span>
				<span class="nx">$c</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">])</span>
				<span class="k">delete</span> <span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>detect and fire the document.ready event</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">triggerReady = </span><span class="nx">$</span><span class="p">.</span><span class="nx">once</span> <span class="o">-&gt;</span>
			<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&quot;ready&quot;</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s">&quot;ready&quot;</span><span class="p">)</span>
			<span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="o">?</span><span class="p">(</span><span class="s">&quot;DOMContentLoaded&quot;</span><span class="p">,</span> <span class="nx">triggerReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="o">?</span><span class="p">(</span><span class="s">&quot;load&quot;</span><span class="p">,</span> <span class="nx">triggerReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
		<span class="nv">bindReady = </span><span class="nx">$</span><span class="p">.</span><span class="nx">once</span> <span class="o">-&gt;</span>
			<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="o">?</span><span class="p">(</span><span class="s">&quot;DOMContentLoaded&quot;</span><span class="p">,</span> <span class="nx">triggerReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="o">?</span><span class="p">(</span><span class="s">&quot;load&quot;</span><span class="p">,</span> <span class="nx">triggerReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
		<span class="nx">bindReady</span><span class="p">()</span>

		<span class="nv">ret = </span><span class="p">{</span>
			<span class="nv">bind: </span><span class="nf">(e, f) -&gt;</span> <span class="c1"># .bind(e, f) - adds handler f for event type e</span>
				<span class="nv">c = </span><span class="p">(</span><span class="nx">e</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="nx">EVENTSEP_RE</span><span class="p">)</span>
				<span class="nv">h = </span><span class="nf">(evt) -&gt;</span>
					<span class="nv">ret = </span><span class="nx">f</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">arguments</span>
					<span class="k">if</span> <span class="nx">ret</span> <span class="o">is</span> <span class="kc">false</span>
						<span class="nx">evt</span><span class="p">.</span><span class="nx">preventAll</span><span class="p">()</span>
					<span class="nx">ret</span>
				<span class="nx">@each</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">@addEventListener</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">c</span>

			<span class="nv">unbind: </span><span class="nf">(e, f) -&gt;</span> <span class="c1"># .unbind(e, [f]) - removes handler f from event e</span>
				<span class="nv">c = </span><span class="p">(</span><span class="nx">e</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="nx">EVENTSEP_RE</span><span class="p">)</span>
				<span class="nx">@each</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">@removeEventListener</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">c</span>

			<span class="nv">once: </span><span class="nf">(e, f) -&gt;</span> <span class="c1"># .once(e, f) - adds a handler f that will only fire once (per node)</span>
				<span class="nv">c = </span><span class="p">(</span><span class="nx">e</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="nx">EVENTSEP_RE</span><span class="p">)</span>
				<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">c</span>
					<span class="nx">@bind</span> <span class="nx">i</span><span class="p">,</span> <span class="nf">(evt) -&gt;</span>
						<span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span>
						<span class="nx">@removeEventListener</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>

			<span class="nv">cycle: </span><span class="nf">(e, funcs...) -&gt;</span> <span class="c1"># .cycle(e, ...) - bind handlers for e that trigger in a cycle</span>
				<span class="nv">c = </span><span class="p">(</span><span class="nx">e</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="nx">EVENTSEP_RE</span><span class="p">)</span>
				<span class="nv">nf = </span><span class="nx">funcs</span><span class="p">.</span><span class="nx">length</span>
				<span class="nv">cycler = </span><span class="nf">(i = -1) -&gt;</span>
					<span class="nf">(evt) -&gt;</span> <span class="nx">funcs</span><span class="p">[</span><span class="nv">i = </span><span class="o">++</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">nf</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="nx">@</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span>
				<span class="nx">@bind</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">cycler</span><span class="p">()</span> <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">c</span>
				<span class="nx">@</span>

			<span class="nv">trigger: </span><span class="nf">(evt, args = {}) -&gt;</span> <span class="c1"># .trigger(e, a) - initiates a fake event</span>
				<span class="nv">args = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span>
					<span class="nv">bubbles: </span><span class="kc">true</span>
					<span class="nv">cancelable: </span><span class="kc">true</span>
				<span class="p">,</span> <span class="nx">args</span>

				<span class="k">for</span> <span class="nx">evt_i</span> <span class="k">in</span> <span class="p">(</span><span class="nx">evt</span> <span class="o">or</span> <span class="s">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="nx">EVENTSEP_RE</span><span class="p">)</span>
					<span class="k">if</span> <span class="nx">evt_i</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;click&quot;</span><span class="p">,</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="s">&quot;mousedown&quot;</span><span class="p">,</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="s">&quot;mouseover&quot;</span><span class="p">,</span> <span class="s">&quot;mouseout&quot;</span><span class="p">]</span> <span class="c1"># mouse events</span>
						<span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span> <span class="s">&quot;MouseEvents&quot;</span>
						<span class="nv">args = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span>
							<span class="nv">detail: </span><span class="mi">1</span><span class="p">,</span>
							<span class="nv">screenX: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">screenY: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">clientX: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">clientY: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">ctrlKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">altKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">shiftKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">metaKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">button: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">relatedTarget: </span><span class="kc">null</span>
						<span class="p">,</span> <span class="nx">args</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">initMouseEvent</span> <span class="nx">evt_i</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">cancelable</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">detail</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span>
							<span class="nx">args</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">altKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">,</span>
							<span class="nx">args</span><span class="p">.</span><span class="nx">button</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">relatedTarget</span>

					<span class="k">else</span> <span class="k">if</span> <span class="nx">evt_i</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;blur&quot;</span><span class="p">,</span> <span class="s">&quot;focus&quot;</span><span class="p">,</span> <span class="s">&quot;reset&quot;</span><span class="p">,</span> <span class="s">&quot;submit&quot;</span><span class="p">,</span> <span class="s">&quot;abort&quot;</span><span class="p">,</span> <span class="s">&quot;change&quot;</span><span class="p">,</span> <span class="s">&quot;load&quot;</span><span class="p">,</span> <span class="s">&quot;unload&quot;</span><span class="p">]</span> <span class="c1"># UI events</span>
						<span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span> <span class="s">&quot;UIEvents&quot;</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">initUIEvent</span> <span class="nx">evt_i</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">cancelable</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="mi">1</span>

					<span class="k">else</span> <span class="k">if</span> <span class="nx">evt_i</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;touchstart&quot;</span><span class="p">,</span> <span class="s">&quot;touchmove&quot;</span><span class="p">,</span> <span class="s">&quot;touchend&quot;</span><span class="p">,</span> <span class="s">&quot;touchcancel&quot;</span><span class="p">]</span> <span class="c1"># touch events</span>
						<span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span> <span class="s">&quot;TouchEvents&quot;</span>
						<span class="nv">args = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span>
							<span class="nv">detail: </span><span class="mi">1</span><span class="p">,</span>
							<span class="nv">screenX: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">screenY: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">clientX: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">clientY: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">ctrlKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">altKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">shiftKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">metaKey: </span><span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>touch values:</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nv">touches: </span><span class="p">[],</span>
							<span class="nv">targetTouches: </span><span class="p">[],</span>
							<span class="nv">changedTouches: </span><span class="p">[],</span>
							<span class="nv">scale: </span><span class="mf">1.0</span><span class="p">,</span>
							<span class="nv">rotation: </span><span class="mf">0.0</span>
						<span class="p">,</span> <span class="nx">args</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">initTouchEvent</span><span class="p">(</span><span class="nx">evt_i</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">cancelable</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">detail</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span>
							<span class="nx">args</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">altKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">,</span>
							<span class="nx">args</span><span class="p">.</span><span class="nx">touches</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">rotation</span><span class="p">)</span>

					<span class="k">else</span> <span class="k">if</span> <span class="nx">evt_i</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;gesturestart&quot;</span><span class="p">,</span> <span class="s">&quot;gestureend&quot;</span><span class="p">,</span> <span class="s">&quot;gesturecancel&quot;</span><span class="p">]</span> <span class="c1"># gesture events</span>
						<span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span> <span class="s">&quot;GestureEvents&quot;</span>
						<span class="nv">args = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="p">{</span>
							<span class="nv">detail: </span><span class="mi">1</span><span class="p">,</span>
							<span class="nv">screenX: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">screenY: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">clientX: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">clientY: </span><span class="mi">0</span><span class="p">,</span>
							<span class="nv">ctrlKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">altKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">shiftKey: </span><span class="kc">false</span><span class="p">,</span>
							<span class="nv">metaKey: </span><span class="kc">false</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>gesture values:</p>             </td>             <td class="code">               <div class="highlight"><pre>							<span class="nv">target: </span><span class="kc">null</span><span class="p">,</span>
							<span class="nv">scale: </span><span class="mf">1.0</span><span class="p">,</span>
							<span class="nv">rotation: </span><span class="mf">0.0</span>
						<span class="p">},</span> <span class="nx">args</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">initGestureEvent</span> <span class="nx">evt_i</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">cancelable</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">detail</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span>
							<span class="nx">args</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">ctrlKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">altKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">metaKey</span><span class="p">,</span>
							<span class="nx">args</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">scale</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">rotation</span></pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>iphone events that are not supported yet (dont know how to create yet, needs research)
iphone events that we cant properly emulate (because we cant create our own Clipboard objects)
iphone events that are just plain events
and general events
else if evt_i in ["drag", "drop", "selection", "cut", "copy", "paste", "orientationchange"]</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">else</span>
						<span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span> <span class="s">&quot;Events&quot;</span>
						<span class="nx">e</span><span class="p">.</span><span class="nx">initEvent</span> <span class="nx">evt_i</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">bubbles</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">cancelable</span>
						<span class="k">try</span>
							<span class="nv">e = </span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">args</span>
						<span class="k">catch</span> <span class="nx">err</span>

					<span class="k">if</span> <span class="o">not</span> <span class="nx">e</span>
						<span class="k">continue</span>
					<span class="k">else</span>
						<span class="k">try</span>
							<span class="nx">@each</span> <span class="o">-&gt;</span> <span class="nx">@dispatchEvent</span> <span class="nx">e</span>
						<span class="k">catch</span> <span class="nx">err</span>
							<span class="nx">log</span><span class="p">(</span><span class="s">&quot;dispatchEvent error:&quot;</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span>
				<span class="nx">@</span>

			<span class="nv">live: </span><span class="nf">(e, f) -&gt;</span> <span class="c1"># .live(e, f) - handle events for nodes that will exist in the future</span>
				<span class="nv">selector = </span><span class="nx">@selector</span>
				<span class="nv">context = </span><span class="nx">@context</span></pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>wrap f</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nv">handler = </span><span class="nf">(evt) -&gt;</span> <span class="c1"># later, when event &#39;e&#39; is fired</span>
					<span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="c1"># re-execute the selector in the original context</span>
						<span class="p">.</span><span class="nx">intersect</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parents</span><span class="p">().</span><span class="nx">first</span><span class="p">().</span><span class="nx">union</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">evt</span><span class="p">.</span><span class="nx">target</span><span class="p">)))</span> <span class="c1"># see if the event would bubble into a match</span>
						<span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nv">evt.target = </span><span class="nx">@</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="c1"># then fire the real handler &#39;f&#39; on the matched nodes</span></pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>record f so we can 'die' it if needed</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">register_live</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">handler</span>
				<span class="nx">@</span>

			<span class="nv">die: </span><span class="nf">(e, f) -&gt;</span> <span class="c1"># die(e, [f]) - stop f [or all] from living for event e</span>
				<span class="nx">$</span><span class="p">(</span><span class="nx">@context</span><span class="p">).</span><span class="nx">unbind</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">unregister_live</span><span class="p">(</span><span class="nx">@selector</span><span class="p">,</span> <span class="nx">@context</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
				<span class="nx">@</span>

			<span class="nv">liveCycle: </span><span class="nf">(e, funcs...) -&gt;</span> <span class="c1"># .liveCycle(e, ...) - bind each /f/ in /funcs/ to handle /e/</span>
				<span class="nv">i = </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nv">nf = </span><span class="nx">funcs</span><span class="p">.</span><span class="nx">length</span>
				<span class="nx">@live</span> <span class="nx">e</span><span class="p">,</span> <span class="nf">(evt) -&gt;</span> <span class="nx">funcs</span><span class="p">[</span><span class="nv">i = </span><span class="o">++</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">nf</span><span class="p">].</span><span class="nx">call</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">evt</span>

			<span class="nv">click: </span><span class="nf">(f = {}) -&gt;</span> <span class="c1"># .click([f]) - trigger [or bind] the &#39;click&#39; event</span>
				<span class="k">if</span> <span class="nx">@css</span><span class="p">(</span><span class="s">&quot;cursor&quot;</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;auto&quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">]</span> <span class="c1"># if the cursor is default</span>
					<span class="nx">@css</span> <span class="s">&quot;cursor&quot;</span><span class="p">,</span> <span class="s">&quot;pointer&quot;</span> <span class="c1"># then make it look clickable</span>
				<span class="k">if</span> <span class="nx">$</span><span class="p">.</span><span class="o">is</span> <span class="s">&quot;function&quot;</span><span class="p">,</span> <span class="nx">f</span> <span class="k">then</span> <span class="nx">@bind</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="nx">f</span>
				<span class="k">else</span> <span class="nx">@trigger</span> <span class="s">&#39;click&#39;</span><span class="p">,</span> <span class="nx">f</span>

			<span class="nv">ready: </span><span class="nf">(f) -&gt;</span>
				<span class="k">return</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span> <span class="nx">@</span><span class="p">)</span> <span class="k">if</span> <span class="nx">triggerReady</span><span class="p">.</span><span class="nx">n</span> <span class="o">&lt;=</span> <span class="mi">0</span>
				<span class="nx">@bind</span> <span class="s">&quot;ready&quot;</span><span class="p">,</span> <span class="nx">f</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>add event binding/triggering shortcuts for the generic events</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">events</span><span class="p">.</span><span class="nx">forEach</span> <span class="nf">(x) -&gt;</span> <span class="nx">ret</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">=</span> <span class="nx">binder</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
		<span class="k">return</span> <span class="nx">ret</span>

	<span class="nx">$</span><span class="p">.</span><span class="nx">plugin</span>
		<span class="nv">depends: </span><span class="s">&quot;dom&quot;</span>
		<span class="nv">provides: </span><span class="s">&quot;lazy&quot;</span>
	<span class="p">,</span> <span class="o">-&gt;</span>
		<span class="nv">lazy_load = </span><span class="nf">(elementName, props) -&gt;</span>
			<span class="nx">$</span><span class="p">(</span><span class="s">&quot;head&quot;</span><span class="p">).</span><span class="nx">append</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">elementName</span><span class="p">),</span> <span class="nx">props</span>
		<span class="nv">$:</span>
			<span class="nv">script: </span><span class="nf">(src) -&gt;</span>
				<span class="nx">lazy_load</span> <span class="s">&quot;script&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nv">src: </span><span class="nx">src</span> <span class="p">}</span>
			<span class="nv">style: </span><span class="nf">(src) -&gt;</span>
				<span class="nx">lazy_load</span> <span class="s">&quot;link&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nv">href: </span><span class="nx">src</span><span class="p">,</span> <span class="nv">rel: </span><span class="s">&quot;stylesheet&quot;</span> <span class="p">}</span>


<span class="p">)(</span><span class="nx">Bling</span><span class="p">,</span> <span class="nx">@</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>vim: ft=coffee sw=2 ts=2</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 