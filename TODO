Rework plugins/http to return Promises
